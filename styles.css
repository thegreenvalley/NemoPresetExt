/* styles.css for NemoPresetExt */

/* === TUTORIAL SYSTEM STYLES === */
@import url('./features/onboarding/vn-dialog.css');
@import url('./features/onboarding/tutorial-launcher.css');

/* === WIDE PANELS CSS MOVED TO DYNAMIC LOADING IN content.js === */
/* The wide panels feature is now conditionally applied based on user settings */
/* See applyWidePanelsStyles() in content.js for the implementation */

/* === ACCESSIBILITY: Focus Indicators === */
*:focus-visible {
    outline: 3px solid var(--SmartThemeQuoteColor, #4a9eff) !important;
    outline-offset: 2px !important;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    *:focus-visible {
        outline: 4px solid currentColor !important;
        outline-offset: 3px !important;
    }
}

/* === COLOR VARIABLES WITH IMPROVED CONTRAST === */
:root {
    /* Ensure minimum WCAG AA contrast ratio (4.5:1) */
    --nemo-text-high-contrast: #ffffff;
    --nemo-text-medium-contrast: #e0e0e0;
    --nemo-text-low-contrast: #b0b0b0;
    --nemo-bg-overlay: rgba(0, 0, 0, 0.85);
}

/* High contrast mode overrides */
@media (prefers-contrast: high) {
    :root {
        --nemo-text-high-contrast: #ffffff;
        --nemo-text-medium-contrast: #ffffff;
        --nemo-text-low-contrast: #ffffff;
    }
}

/* === Z-INDEX LAYERING SYSTEM === */
:root {
    /* Base content layer */
    --z-base: 1;
    --z-content: 10;

    /* UI Controls */
    --z-controls: 100;
    --z-buttons: 100;
    --z-headers: 200;

    /* Interactive overlays */
    --z-selection: 500;
    --z-highlights: 600;

    /* Directive system */
    --z-directive-toast: 9999;
    --z-directive-modal: 10000;

    /* Panels and navigation */
    --z-sidebar: 1000;
    --z-panel-toggle: 1001;
    --z-navigation: 1500;

    /* Dropdowns and menus */
    --z-dropdown: 5000;
    --z-context-menu: 8000;
    --z-tooltip: 8500;

    /* Modals and overlays */
    --z-modal-backdrop: 9000;
    --z-modal: 9999;
    --z-popup: 10000;

    /* Critical UI elements */
    --z-notification: 15000;
    --z-drag: 20000;
}

/* === ENHANCED VISUAL DESIGN SYSTEM === */
:root {
    /* Semantic Colors */
    --nemo-success: #51cf66;
    --nemo-warning: #ffd43b;
    --nemo-error: #ff6b6b;
    --nemo-info: var(--SmartThemeQuoteColor, #4a9eff);

    /* Interactive States */
    --nemo-hover-lift: translateY(-2px);
    --nemo-active-scale: scale(0.98);

    /* Shadows */
    --nemo-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
    --nemo-shadow-md: 0 4px 6px rgba(0, 0, 0, 0.16);
    --nemo-shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.20);
    --nemo-shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.30);

    /* Spacing Scale */
    --nemo-space-xs: 4px;
    --nemo-space-sm: 8px;
    --nemo-space-md: 16px;
    --nemo-space-lg: 24px;
    --nemo-space-xl: 32px;

    /* Border Radius */
    --nemo-radius-sm: 4px;
    --nemo-radius-md: 8px;
    --nemo-radius-lg: 12px;
    --nemo-radius-xl: 16px;
    --nemo-radius-full: 9999px;

    /* Typography Scale */
    --nemo-text-xs: 0.75rem;
    --nemo-text-sm: 0.875rem;
    --nemo-text-base: 1rem;
    --nemo-text-lg: 1.125rem;
    --nemo-text-xl: 1.25rem;
    --nemo-text-2xl: 1.5rem;
}

/* === ENHANCED INTERACTIVE STATES === */
/* Buttons with improved hover/active states */
.menu_button,
button:not(.nemo-toast-close) {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.menu_button:hover,
button:not(.nemo-toast-close):hover:not(:disabled) {
    transform: var(--nemo-hover-lift);
    box-shadow: var(--nemo-shadow-md);
}

.menu_button:active,
button:not(.nemo-toast-close):active:not(:disabled) {
    transform: var(--nemo-active-scale);
}

/* Ripple effect on click */
.menu_button::after,
button:not(.nemo-toast-close)::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.menu_button:active::after,
button:not(.nemo-toast-close):active::after {
    width: 300px;
    height: 300px;
}

/* Card hover effects */
.grid-item,
.list-item,
.nemo-extension-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.grid-item:hover,
.list-item:hover,
.nemo-extension-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--nemo-shadow-lg);
}

/* Input focus effects */
input[type="text"]:focus,
input[type="search"]:focus,
textarea:focus,
select:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.3);
    border-color: var(--nemo-info);
}

/* Smooth scrolling for containers */
#navigator-grid-view,
#completion_prompt_manager_list {
    scroll-behavior: smooth;
}

/* === VISUAL FEEDBACK INDICATORS === */
/* Status badges for enabled/disabled states */
.nemo-status-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--nemo-space-xs);
    padding: var(--nemo-space-xs) var(--nemo-space-sm);
    border-radius: var(--nemo-radius-full);
    font-size: var(--nemo-text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nemo-status-badge.success,
.nemo-status-badge.enabled {
    background: rgba(81, 207, 102, 0.2);
    color: var(--nemo-success);
    border: 1px solid var(--nemo-success);
}

.nemo-status-badge.warning {
    background: rgba(255, 212, 59, 0.2);
    color: var(--nemo-warning);
    border: 1px solid var(--nemo-warning);
}

.nemo-status-badge.error,
.nemo-status-badge.disabled {
    background: rgba(255, 107, 107, 0.2);
    color: var(--nemo-error);
    border: 1px solid var(--nemo-error);
}

.nemo-status-badge.info {
    background: rgba(74, 158, 255, 0.2);
    color: var(--nemo-info);
    border: 1px solid var(--nemo-info);
}

/* Token count progress visualization */
.nemo-token-progress {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-full);
    overflow: hidden;
    position: relative;
}

.nemo-token-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--nemo-info), var(--nemo-success));
    border-radius: var(--nemo-radius-full);
    transition: width 0.3s ease;
}

.nemo-token-progress-bar.warning {
    background: linear-gradient(90deg, var(--nemo-warning), var(--nemo-error));
}

.nemo-token-progress-bar.error {
    background: var(--nemo-error);
}

/* Loading indicators */
.nemo-loading-indicator {
    display: inline-flex;
    align-items: center;
    gap: var(--nemo-space-sm);
    padding: var(--nemo-space-sm) var(--nemo-space-md);
    background: rgba(74, 158, 255, 0.1);
    border-radius: var(--nemo-radius-md);
    border-left: 3px solid var(--nemo-info);
}

/* === IMPROVED GRID LAYOUTS === */
/* Enhanced grid spacing and alignment */
#navigator-grid-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--nemo-space-lg);
    padding: var(--nemo-space-lg);
}

.grid-item {
    display: flex;
    flex-direction: column;
    padding: var(--nemo-space-md);
    background: rgba(255, 255, 255, 0.05);
    border-radius: var(--nemo-radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
    cursor: pointer;
}

.grid-item.folder {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.15), rgba(74, 158, 255, 0.05));
    border-color: rgba(74, 158, 255, 0.3);
}

.grid-item.preset {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
}

.grid-item.favorite::before {
    content: '★';
    position: absolute;
    top: var(--nemo-space-sm);
    right: var(--nemo-space-sm);
    font-size: var(--nemo-text-lg);
    color: var(--nemo-warning);
    filter: drop-shadow(0 0 4px rgba(255, 212, 59, 0.5));
}

/* === ENHANCED SECTION DESIGNS === */
/* Improved section headers with visual hierarchy */
.nemo-engine-section,
.inline-drawer {
    margin-bottom: 4px;
}

/* Only target completion prompt sections, not reasoning blocks */
#openai_settings .inline-drawer details,
#completion_prompt_manager details,
#advanced_format_settings details {
    margin-bottom: 4px;
}

.nemo-engine-section summary,
.inline-drawer summary {
    padding: var(--nemo-space-md) var(--nemo-space-lg);
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.15) 0%, rgba(74, 158, 255, 0.05) 100%);
    border-left: 4px solid var(--nemo-info);
    border-radius: var(--nemo-radius-md);
    box-shadow: var(--nemo-shadow-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 600;
    font-size: var(--nemo-text-lg);
}

.nemo-engine-section summary:hover,
.inline-drawer summary:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.25) 0%, rgba(74, 158, 255, 0.1) 100%);
    box-shadow: var(--nemo-shadow-md);
    transform: translateX(4px);
}

.nemo-engine-section[open] summary,
.inline-drawer[open] summary {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    margin-bottom: var(--nemo-space-md);
}

/* Section content spacing */
.nemo-engine-section > *:not(summary),
.inline-drawer > *:not(summary) {
    padding: var(--nemo-space-md) var(--nemo-space-lg);
}

/* === SUB-SECTION STYLING === */
/* Sub-sections nested within main sections */
.nemo-sub-section {
    margin-bottom: 0px !important;
    margin-top: 0px !important;
    padding: 0;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    margin-left: var(--nemo-space-md);
}

.nemo-sub-section summary {
    padding: 2px 12px;
    margin: 0 !important;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);
    border-left: 3px solid rgba(74, 158, 255, 0.6);
    font-size: var(--nemo-text-base);
    font-weight: 500;
    display: flex;
    align-items: center;
    min-height: 32px;
}

.nemo-sub-section summary > li {
    margin: 0 !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    list-style: none !important;
    width: 100%;
    min-height: unset !important;
}

.nemo-sub-section summary:hover {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%);
    transform: translateX(2px);
}

.nemo-sub-section > .nemo-section-content {
    padding: 0 8px;
    gap: 0 !important;
    margin-top: 0 !important;
    padding-top: 0 !important;
    border-left: none !important;
}

/* When sub-section is closed, completely hide content div */
.nemo-sub-section:not([open]) > .nemo-section-content {
    display: none !important;
    height: 0 !important;
    min-height: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    overflow: hidden !important;
}

/* Nested sub-section items have reduced padding */
.nemo-sub-section .completion_prompt_manager_prompt {
    padding: 5px 12px !important;
}

/* Reduce gap between consecutive sub-sections */
.nemo-sub-section + .nemo-sub-section {
    margin-top: 0px !important;
}

/* === ICON SYSTEM CONSISTENCY === */
/* Standardized icon sizing and spacing */
.fa,
.fas,
.far,
.material-icons,
[class*="icon-"] {
    width: 1.25em;
    height: 1.25em;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* Icon buttons */
.nemo-icon-button {
    width: 36px;
    height: 36px;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--nemo-radius-md);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-icon-button:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    transform: var(--nemo-hover-lift);
}

.nemo-icon-button:active {
    transform: var(--nemo-active-scale);
}

.nemo-icon-button.primary {
    background: rgba(74, 158, 255, 0.2);
    border-color: var(--nemo-info);
}

.nemo-icon-button.success {
    background: rgba(81, 207, 102, 0.2);
    border-color: var(--nemo-success);
}

.nemo-icon-button.danger {
    background: rgba(255, 107, 107, 0.2);
    border-color: var(--nemo-error);
}

/* === IMPROVED CARD DESIGNS === */
/* Enhanced card styling with better shadows and spacing */
.nemo-card,
.nemo-extension-card,
.nemo-preset-card {
    padding: var(--nemo-space-lg);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-lg);
    box-shadow: var(--nemo-shadow-sm);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nemo-card:hover,
.nemo-extension-card:hover,
.nemo-preset-card:hover {
    box-shadow: var(--nemo-shadow-lg);
    border-color: rgba(74, 158, 255, 0.3);
    transform: translateY(-4px);
}

/* Card headers */
.nemo-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--nemo-space-md);
    padding-bottom: var(--nemo-space-md);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.nemo-card-title {
    font-size: var(--nemo-text-xl);
    font-weight: 700;
    margin: 0;
}

.nemo-card-subtitle {
    font-size: var(--nemo-text-sm);
    color: var(--nemo-text-low-contrast);
    margin-top: var(--nemo-space-xs);
}

/* Card actions */
.nemo-card-actions {
    display: flex;
    gap: var(--nemo-space-sm);
    padding-top: var(--nemo-space-sm);
    align-items: center;
}

/* === IMPROVED VISUAL SEPARATION === */
/* Better dividers and separators */
.nemo-divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    margin: var(--nemo-space-lg) 0;
}

.nemo-divider-vertical {
    width: 1px;
    background: linear-gradient(180deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    margin: 0 var(--nemo-space-md);
}

/* Section spacing */
.nemo-section {
    margin-bottom: var(--nemo-space-xl);
}

.nemo-section + .nemo-section {
    margin-top: var(--nemo-space-xl);
}

/* === SCREENSHOT-SPECIFIC UI ENHANCEMENTS === */

/* COLOR-CODED CATEGORY BORDERS */
/* Note: :contains() is not valid CSS - use data-category attributes instead */
.inline-drawer[data-category="sampling"],
#openai_settings_pane .inline-drawer:first-child {
    border-left-color: #ff6b6b !important;
}

.inline-drawer[data-category="settings"] {
    border-left-color: #ffd43b !important;
}

.inline-drawer[data-category="reasoning"] {
    border-left-color: #a78bfa !important;
}

.inline-drawer[data-category="lorebook"] {
    border-left-color: #51cf66 !important;
}

/* ENHANCED TOKEN COUNTER */
.token_counter,
[id*="token"],
.tokens_count {
    display: inline-flex !important;
    align-items: center;
    padding: 4px 12px !important;
    border-radius: var(--nemo-radius-full) !important;
    font-weight: 700 !important;
    font-variant-numeric: tabular-nums;
    font-size: var(--nemo-text-sm) !important;
    min-width: 60px;
    justify-content: center;
    transition: all 0.2s ease;
}

/* Token counter color states based on value */
.token_counter.safe,
.token_counter[data-state="safe"] {
    background: rgba(81, 207, 102, 0.2) !important;
    color: var(--nemo-success) !important;
    border: 1px solid var(--nemo-success);
}

.token_counter.warning,
.token_counter[data-state="warning"] {
    background: rgba(255, 212, 59, 0.2) !important;
    color: var(--nemo-warning) !important;
    border: 1px solid var(--nemo-warning);
}

.token_counter.danger,
.token_counter[data-state="danger"] {
    background: rgba(255, 107, 107, 0.2) !important;
    color: var(--nemo-error) !important;
    border: 1px solid var(--nemo-error);
}

/* IMPROVED TAB NAVIGATION */
.tabs-navigation,
.nav-tabs,
.tab-group {
    display: flex;
    gap: var(--nemo-space-sm);
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    margin-bottom: var(--nemo-space-lg);
}

.tab-button,
.nav-tab,
button[role="tab"] {
    position: relative;
    padding: 12px 24px !important;
    border: none;
    background: transparent;
    color: var(--nemo-text-medium-contrast);
    font-weight: 500;
    transition: all 0.2s ease;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
}

.tab-button:hover,
.nav-tab:hover,
button[role="tab"]:hover {
    color: var(--nemo-text-high-contrast);
    background: rgba(255, 255, 255, 0.05);
}

.tab-button.active,
.tab-button.selected,
.nav-tab.active,
button[role="tab"][aria-selected="true"] {
    color: var(--nemo-info) !important;
    border-bottom-color: var(--nemo-info) !important;
    font-weight: 600 !important;
}

.tab-button.active::after,
button[role="tab"][aria-selected="true"]::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--nemo-info);
    box-shadow: 0 0 8px rgba(74, 158, 255, 0.6);
    animation: tabGlow 2s ease-in-out infinite;
}

@keyframes tabGlow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

/* PROMPT LIST IMPROVEMENTS */
#completion_prompt_manager_list {
    display: flex;
    flex-direction: column;
    gap: 2px !important;
    padding: var(--nemo-space-md);
}

.completion_prompt_manager_prompt,
.prompt-manager-prompt {
    padding: 6px 8px !important;
    margin-bottom: 0 !important;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
    font-size: 0.95rem;
    overflow: hidden;
    line-height: 1.2;
}

.completion_prompt_manager_prompt:hover,
.prompt-manager-prompt:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateX(4px);
}

/* Better icon alignment in prompts */
.completion_prompt_manager_prompt .prompt-manager-icon,
.prompt-manager-prompt .icon {
    width: 20px;
    height: 20px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-right: var(--nemo-space-xs);
}

/* Reduce button sizes in prompt controls */
.completion_prompt_manager_prompt_controls button,
.prompt_manager_prompt_controls button,
.nemo-right-controls-wrapper button {
    padding: 4px 8px !important;
    font-size: 0.85rem !important;
    min-width: auto !important;
}

.completion_prompt_manager_prompt_controls,
.prompt_manager_prompt_controls,
.nemo-right-controls-wrapper {
    gap: 4px !important;
}

/* Keep section headers (like "Vex personality") at a good size */
.nemo-engine-section summary > li.completion_prompt_manager_prompt,
li.completion_prompt_manager_prompt.nemo-section-header {
    padding: 8px 12px !important;
}

/* LOREBOOK IMPROVEMENTS */
.world_entry,
.worldinfo-entry {
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    margin-bottom: 4px;
}

/* Lorebook empty state */
.world_entries_list:empty::before,
#world_entries_list:empty::before {
    content: 'No entries yet. Click the + button to create your first lorebook entry.';
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--nemo-space-xl);
    color: var(--nemo-text-low-contrast);
    font-style: italic;
    text-align: center;
}

/* Lorebook toolbar grouping */
.world_entries_top_bar,
.lorebook-toolbar {
    display: flex;
    gap: var(--nemo-space-sm);
    padding: var(--nemo-space-md);
    background: rgba(255, 255, 255, 0.03);
    border-radius: var(--nemo-radius-md);
    margin-bottom: var(--nemo-space-md);
}

/* ADVANCED FORMATTING IMPROVEMENTS */
.context-template-block,
.formatting-block {
    padding: var(--nemo-space-lg);
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-lg);
    margin-bottom: var(--nemo-space-lg);
}

/* Form field improvements */
.form-group,
.setting-group {
    margin-bottom: var(--nemo-space-lg);
}

.form-group label,
.setting-group label {
    display: block;
    margin-bottom: var(--nemo-space-sm);
    font-weight: 600;
    color: var(--nemo-text-high-contrast);
}

/* Checkbox list styling */
.checkbox-list {
    display: flex;
    flex-direction: column;
    gap: var(--nemo-space-sm);
    padding: var(--nemo-space-md);
    background: rgba(255, 255, 255, 0.02);
    border-radius: var(--nemo-radius-md);
}

.checkbox-list label {
    display: flex;
    align-items: center;
    gap: var(--nemo-space-sm);
    padding: var(--nemo-space-xs) 0;
    cursor: pointer;
    transition: color 0.2s ease;
}

.checkbox-list label:hover {
    color: var(--nemo-info);
}

/* Code textarea styling */
textarea[name*="template"],
textarea.code-input,
.story-string-textarea {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
    font-size: var(--nemo-text-sm) !important;
    line-height: 1.6 !important;
    background: rgba(0, 0, 0, 0.3) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: var(--nemo-radius-md) !important;
    padding: var(--nemo-space-md) !important;
}

/* SLIDER IMPROVEMENTS */
.slider-wrapper,
input[type="range"] {
    position: relative;
    width: 100%;
}

/* Slider value label */
.slider-value,
.range-value {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--nemo-info);
    color: white;
    padding: 4px 12px;
    border-radius: var(--nemo-radius-full);
    font-size: var(--nemo-text-xs);
    font-weight: 700;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}

input[type="range"]:hover + .slider-value,
input[type="range"]:focus + .slider-value {
    opacity: 1;
}

/* Enhanced range input */
input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 6px;
    border-radius: var(--nemo-radius-full);
    background: rgba(255, 255, 255, 0.1);
    outline: none;
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--nemo-info);
    cursor: pointer;
    box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
    transition: all 0.2s ease;
}

input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 0 0 6px rgba(74, 158, 255, 0.3);
}

input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--nemo-info);
    cursor: pointer;
    border: none;
    box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
    transition: all 0.2s ease;
}

input[type="range"]::-moz-range-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 0 0 6px rgba(74, 158, 255, 0.3);
}

/* BACKGROUND GRID IMPROVEMENTS */
.bg_grid,
.backgrounds-grid,
#bg_grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--nemo-space-lg);
    padding: var(--nemo-space-lg);
}

.bg_grid_item,
.background-item {
    position: relative;
    aspect-ratio: 16/9;
    border-radius: var(--nemo-radius-lg);
    overflow: hidden;
    cursor: pointer;
    border: 2px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.bg_grid_item:hover,
.background-item:hover {
    transform: scale(1.05);
    border-color: var(--nemo-info);
    box-shadow: 0 8px 24px rgba(74, 158, 255, 0.3);
}

.bg_grid_item.selected,
.background-item.selected {
    border-color: var(--nemo-info);
    border-width: 3px;
    box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
}

/* Background hover overlay */
.bg_grid_item::after,
.background-item::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--nemo-info);
    border-radius: 50%;
    font-size: 24px;
    color: white;
    opacity: 0;
    transition: all 0.3s ease;
}

.bg_grid_item:hover::after,
.background-item.selected::after {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

/* EXTENSION CARDS IMPROVEMENTS */
.extensions_block,
.extension-section {
    margin-bottom: var(--nemo-space-xl);
}

.extensions_block h3,
.extension-section h3 {
    display: flex;
    align-items: center;
    gap: var(--nemo-space-sm);
    padding: var(--nemo-space-md);
    background: rgba(255, 255, 255, 0.05);
    border-radius: var(--nemo-radius-md);
    border-left: 4px solid var(--nemo-info);
    margin-bottom: var(--nemo-space-md);
    font-size: var(--nemo-text-lg);
}

/* Category-specific colors */
.extensions_block.core h3 { border-left-color: #ff6b6b; }
.extensions_block.audio h3 { border-left-color: #a78bfa; }
.extensions_block.utilities h3 { border-left-color: #ffd43b; }
.extensions_block.image h3 { border-left-color: #51cf66; }
.extensions_block.memory h3 { border-left-color: #4a9eff; }

.extension-card,
.extension_block {
    padding: var(--nemo-space-md);
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-md);
    margin-bottom: var(--nemo-space-sm);
    transition: all 0.2s ease;
}

.extension-card:hover,
.extension_block:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(74, 158, 255, 0.3);
    transform: translateX(4px);
}

/* Extension toggle button */
.extension-toggle {
    width: 48px;
    height: 24px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-full);
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
}

.extension-toggle.enabled {
    background: var(--nemo-success);
}

.extension-toggle::before {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: white;
    top: 2px;
    left: 2px;
    transition: all 0.3s ease;
}

.extension-toggle.enabled::before {
    left: 26px;
}

/* === REDUCED MOTION SUPPORT === */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }

    /* Disable animations on specific elements */
    .nemo-loading-spinner::before,
    button.loading::after,
    .grid-item.folder.drag-over,
    .grid-item,
    .nemo-toast {
        animation: none !important;
    }

    /* Keep essential transforms but remove animation */
    .grid-item.dragging {
        transform: none !important;
    }

    /* Disable hover transforms */
    .menu_button:hover,
    button:hover,
    .grid-item:hover,
    .list-item:hover {
        transform: none !important;
    }
}

/* === LOADING STATES === */
.nemo-loading-spinner {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 20px;
    color: var(--nemo-text-color, #ccc);
    font-size: 1em;
}

.nemo-loading-spinner::before {
    content: "";
    display: inline-block;
    width: 24px;
    height: 24px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: var(--SmartThemeQuoteColor, #4a9eff);
    border-radius: 50%;
    animation: nemo-spinner-rotate 0.8s linear infinite;
}

@keyframes nemo-spinner-rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Loading overlay for containers */
.nemo-loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal-backdrop);
    backdrop-filter: blur(2px);
}

/* Button loading state */
button.loading {
    position: relative;
    color: transparent !important;
    pointer-events: none;
}

button.loading::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: currentColor;
    border-radius: 50%;
    animation: nemo-spinner-rotate 0.6s linear infinite;
}

/* === TOAST NOTIFICATIONS === */
.nemo-toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    min-width: 300px;
    max-width: 500px;
    padding: 16px 20px;
    background: var(--SmartThemeBotMesBlurTintColor, #2a2a2a);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
    z-index: var(--z-popup);
    opacity: 0;
    transform: translateX(400px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    backdrop-filter: blur(10px);
}

.nemo-toast.show {
    opacity: 1;
    transform: translateX(0);
}

.nemo-toast.hide {
    opacity: 0;
    transform: translateX(400px);
}

.nemo-toast-icon {
    font-size: 1.5em;
    flex-shrink: 0;
}

.nemo-toast.success {
    border-left: 4px solid #51cf66;
}

.nemo-toast.success .nemo-toast-icon {
    color: #51cf66;
}

.nemo-toast.error {
    border-left: 4px solid #ff6b6b;
}

.nemo-toast.error .nemo-toast-icon {
    color: #ff6b6b;
}

.nemo-toast.info {
    border-left: 4px solid var(--SmartThemeQuoteColor, #4a9eff);
}

.nemo-toast.info .nemo-toast-icon {
    color: var(--SmartThemeQuoteColor, #4a9eff);
}

.nemo-toast.warning {
    border-left: 4px solid #ffd43b;
}

.nemo-toast.warning .nemo-toast-icon {
    color: #ffd43b;
}

.nemo-toast-content {
    flex: 1;
    color: var(--nemo-text-high-contrast, #fff);
}

.nemo-toast-close {
    background: none;
    border: none;
    color: var(--nemo-text-medium-contrast, #e0e0e0);
    cursor: pointer;
    padding: 4px;
    font-size: 1.2em;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.nemo-toast-close:hover {
    opacity: 1;
}

/* Mobile responsive toast */
@media (max-width: 768px) {
    .nemo-toast {
        bottom: 10px;
        right: 10px;
        left: 10px;
        min-width: auto;
        transform: translateY(200px);
    }

    .nemo-toast.show {
        transform: translateY(0);
    }

    .nemo-toast.hide {
        transform: translateY(200px);
    }
}

/* === FIX FOR OPENROUTER DROPDOWN ISSUE === */
/* Prevent world_editor_select from affecting other select2 dropdowns when moved to hidden container */
/* Override SillyTavern core CSS rule: #world_editor_select ~ .select2-container { overflow: hidden; } */

/* Ensure all select2 dropdowns work properly when world info overhaul is enabled */
.select2-container {
    overflow: visible !important;
}

/* More specific fixes for API connection dropdowns that were being broken */
#api_connection_profile_block .select2-container,
#completion_source_block .select2-container,
#openrouter_model_block .select2-container,
#model_openrouter_select.select2-container,
.select2-container--default {
    overflow: visible !important;
}

/* Ensure dropdown appears above other elements */
.select2-dropdown {
    z-index: var(--z-dropdown) !important;
}

/* === EXTENSIONS TAB OVERHAUL === */
.nemo-extensions-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    align-items: start;
    width: 100%;
    max-width: 100%;
}

.nemo-extensions-column {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.nemo-extension-category-drawer {
    break-inside: avoid;
    margin-bottom: 10px;
    width: 100%;
}

.nemo-extensions-search {
    grid-column: 1 / -1; /* Span both columns */
    margin-bottom: 15px;
    width: 100%;
}

/* Ensure the extensions settings container uses full width */
.nemo-extension #extensions_settings {
    width: 100%;
    max-width: 100%;
}

@media (max-width: 768px) {
    .nemo-extensions-layout {
        grid-template-columns: 1fr;
    }
}

/* === TAB-CONTAINED EXTENSION VIEW === */
.nemo-tab-extension-view {
    position: relative;
    top: 0;
    left: 0;
    width: 100%;
    height: auto;
    min-height: 500px;
    background: transparent;
    border-radius: 8px;
    z-index: var(--z-controls);
    display: none;
    flex-direction: column;
    overflow: visible;
}

.nemo-tab-extension-view.active {
    display: flex;
}

.nemo-extension-view-header {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    background: var(--SmartThemeQuoteColor);
    color: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    flex-shrink: 0;
    border-radius: 8px 8px 0 0;
}

.nemo-back-button {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    transition: all 0.2s ease;
    margin-right: 20px;
}

.nemo-back-button:hover {
    background: rgba(255,255,255,0.3);
    transform: translateX(-2px);
}

.nemo-extension-title {
    font-size: 18px;
    font-weight: bold;
    flex-grow: 1;
}

.nemo-extension-view-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: var(--SmartThemeBlurTintColor);
}

/* Make the extensions tab container relative for positioning */
#extensions_settings {
    position: relative;
    overflow: hidden;
}

/* Style the extension content inside the view */
/* Exclude NemoPreset settings from these overrides to preserve custom layouts */
.nemo-extension-view-content .inline-drawer-content:not(.nemo-preset-enhancer-settings *) {
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    margin: 0;
}

/* Preserve NemoPreset settings layout */
.nemo-extension-view-content .nemo-preset-enhancer-settings .inline-drawer-content {
    background: inherit;
    border: inherit;
    border-radius: inherit;
    padding: inherit;
    margin: inherit;
}

/* Exclude NemoPreset settings from form styling */
.nemo-extension-view-content .form-group:not(.nemo-preset-enhancer-settings *) {
    margin-bottom: 20px;
}

.nemo-extension-view-content label:not(.nemo-preset-enhancer-settings *):not(.nemo-toggle-switch) {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: var(--SmartThemeBodyColor);
}

.nemo-extension-view-content input[type="text"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content input[type="number"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content input[type="email"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content input[type="password"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content input[type="url"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content select:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content textarea:not(.nemo-preset-enhancer-settings *) {
    width: 100%;
    max-width: 100%;
}

/* Preserve original button styling - don't stretch buttons */
.nemo-extension-view-content .menu_button:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content button:not(.nemo-preset-enhancer-settings *):not(.nemo-settings-tab),
.nemo-extension-view-content input[type="button"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content input[type="submit"]:not(.nemo-preset-enhancer-settings *) {
    width: auto !important;
    max-width: none !important;
    margin: 10px 5px 10px 0;
}

/* Keep checkboxes and radios at normal size */
.nemo-extension-view-content input[type="checkbox"]:not(.nemo-preset-enhancer-settings *),
.nemo-extension-view-content input[type="radio"]:not(.nemo-preset-enhancer-settings *) {
    width: auto !important;
    max-width: none !important;
}

/* Preserve NemoPreset settings structure within extension view */
.nemo-extension-view-content .nemo-preset-enhancer-settings {
    background: transparent !important;
    padding: 0 !important;
    margin: 0 !important;
}

/* Force NemoPreset card styles to apply even within extension view */
.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-settings-card {
    background: rgba(0, 0, 0, 0.3) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 12px !important;
    padding: 0 !important;
    margin-bottom: 20px !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-card-header-full {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.25) 100%) !important;
    border-left: 4px solid var(--SmartThemeQuoteColor) !important;
    padding: 15px 20px !important;
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    border-radius: 12px 12px 0 0 !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-card-header-full i {
    color: var(--SmartThemeQuoteColor) !important;
    font-size: 20px !important;
    display: inline-block !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-card-header-full h3 {
    margin: 0 !important;
    flex: 1 !important;
    font-size: 18px !important;
    color: var(--SmartThemeBodyColor) !important;
    display: inline-block !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-card-badge {
    background: var(--SmartThemeQuoteColor) !important;
    color: white !important;
    padding: 4px 12px !important;
    border-radius: 12px !important;
    font-size: 11px !important;
    font-weight: bold !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    display: inline-block !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-features-grid {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 20px !important;
    margin: 0 !important;
    padding: 20px !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-feature-group {
    display: block !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-group-title {
    font-size: 14px !important;
    font-weight: bold !important;
    color: var(--SmartThemeQuoteColor) !important;
    margin-bottom: 15px !important;
    padding-bottom: 8px !important;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1) !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-setting-row {
    display: flex !important;
    align-items: flex-start !important;
    gap: 15px !important;
    padding: 15px !important;
    background: rgba(0, 0, 0, 0.2) !important;
    border-radius: 8px !important;
    margin-bottom: 12px !important;
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
    transition: all 0.2s ease !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-setting-row:hover {
    background: rgba(0, 0, 0, 0.3) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-setting-control {
    flex-shrink: 0 !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-setting-info {
    flex: 1 !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-setting-title {
    font-weight: 600 !important;
    color: var(--SmartThemeBodyColor) !important;
    margin-bottom: 4px !important;
    font-size: 14px !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-setting-description {
    color: rgba(255, 255, 255, 0.6) !important;
    font-size: 12px !important;
    line-height: 1.4 !important;
}

.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-section-description {
    color: rgba(255, 255, 255, 0.7) !important;
    margin-bottom: 20px !important;
    font-size: 13px !important;
}

/* === PROMPT ARCHIVE STYLES === */
#nemo-prompt-archive-section {
    margin-bottom: 15px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    background: var(--nemo-primary-bg);
}

#nemo-prompt-archive-section > summary {
    padding: 12px 15px;
    background: var(--nemo-secondary-bg);
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    user-select: none;
}

#nemo-prompt-archive-section[open] > summary {
    border-radius: 8px 8px 0 0;
    border-bottom: 1px solid var(--nemo-border-color);
}

.nemo-archive-item {
    background: var(--nemo-secondary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    margin-bottom: 10px;
    padding: 15px;
    transition: all 0.2s ease;
}

.nemo-archive-item:hover {
    background: var(--nemo-tertiary-bg);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.nemo-archive-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.nemo-archive-title {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.nemo-archive-title strong {
    font-size: 1.1em;
    color: var(--nemo-text-color);
}

.nemo-archive-date {
    font-size: 0.85em;
    color: var(--nemo-text-muted);
    font-style: italic;
}

.nemo-archive-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.nemo-archive-actions .menu_button {
    padding: 6px 10px;
    font-size: 0.85em;
    border-radius: 4px;
    white-space: nowrap;
}

.nemo-archive-info {
    padding-top: 10px;
    border-top: 1px solid var(--nemo-border-color);
}

.nemo-archive-description {
    margin-bottom: 8px;
    color: var(--nemo-text-color);
    font-style: italic;
}

.nemo-archive-stats {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.nemo-stat {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9em;
    color: var(--nemo-text-muted);
}

.nemo-stat i {
    color: var(--nemo-primary-accent);
}

/* Archive contents */
.nemo-archive-contents {
    padding: 15px 0 0 0;
    border-top: 1px solid var(--nemo-border-color);
    background: var(--nemo-primary-bg);
}

.nemo-prompts-section, .nemo-system-prompts-section {
    margin-bottom: 20px;
    padding: 0 15px;
}

.nemo-prompts-section h4, .nemo-system-prompts-section h4 {
    color: var(--nemo-primary-accent);
    margin: 15px 0 10px 0;
    font-size: 1.1em;
    display: flex;
    align-items: center;
    gap: 8px;
}

.nemo-prompts-list, .nemo-system-prompts-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.nemo-prompt-item, .nemo-system-prompt-item {
    padding: 12px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    background: var(--nemo-secondary-bg);
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
}

.nemo-prompt-item:hover, .nemo-system-prompt-item:hover {
    border-color: var(--nemo-primary-accent);
    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
    transform: translateY(-1px);
}

.nemo-prompt-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.nemo-prompt-name {
    font-weight: bold;
    color: var(--nemo-text-color);
}

.nemo-prompt-role {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: bold;
    text-transform: uppercase;
}

.nemo-prompt-item .nemo-prompt-role {
    background: var(--nemo-primary-accent);
    color: white;
}

.nemo-system-prompt-item .nemo-prompt-role {
    background: #ff9800;
    color: white;
}

.nemo-prompt-preview {
    font-size: 0.9em;
    color: var(--nemo-text-muted);
    line-height: 1.4;
    font-style: italic;
}

/* Context menu */
.nemo-context-menu {
    font-family: inherit;
}

.nemo-context-menu-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.nemo-context-menu-item i {
    width: 16px;
    text-align: center;
}

/* Archive stats styling */
#nemo-archive-stats {
    background: var(--nemo-tertiary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
}

#nemo-archive-stats-content {
    color: var(--nemo-text-color);
}

#nemo-archive-stats-content small {
    color: var(--nemo-text-muted);
    font-size: 0.8em;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .nemo-archive-header {
        flex-direction: column;
        gap: 10px;
    }
    
    .nemo-archive-actions {
        justify-content: flex-start;
    }
    
    .nemo-archive-stats {
        flex-direction: column;
        gap: 8px;
    }
}

/* === EXTENSION CARDS === */
.nemo-extension-card {
    background: var(--SmartThemeBotMesBlurTintColor);
    border: 1px solid var(--SmartThemeBorderColor);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    min-height: 108.61px;
}

.nemo-extension-card:hover {
    background: var(--SmartThemeUserMesBlurTintColor);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transform: translateY(-1px);
}

.nemo-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.nemo-card-title {
    font-weight: bold;
    font-size: 16px;
    color: var(--SmartThemeBodyColor);
}

.nemo-tag-button, .nemo-options-button {
    background: var(--SmartThemeQuoteColor);
    border: none;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.nemo-extension-card:hover .nemo-tag-button,
.nemo-extension-card:hover .nemo-options-button {
    opacity: 1;
}

.nemo-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 8px;
}

.nemo-tag {
    background: var(--SmartThemeQuoteColor);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    white-space: nowrap;
}

.nemo-custom-tag {
    background: var(--SmartThemeEmColor);
}

/* === FOLDER MANAGEMENT === */
.nemo-folder-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px;
    background: var(--SmartThemeBotMesBlurTintColor);
    border-radius: 8px;
}

.nemo-add-folder-button {
    background: var(--SmartThemeQuoteColor);
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* === CONTEXT MENU === */
.nemo-context-menu {
    position: fixed;
    background: var(--SmartThemeBlurTintColor);
    border: 1px solid var(--SmartThemeBorderColor);
    border-radius: 6px;
    padding: 8px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: var(--z-popup);
    min-width: 150px;
    display: none;
}

.nemo-context-menu-item {
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--SmartThemeBodyColor);
}

.nemo-context-menu-item:hover {
    background: var(--SmartThemeQuoteColor);
    color: white;
}

.nemo-context-menu-separator {
    height: 1px;
    background: var(--SmartThemeBorderColor);
    margin: 4px 0;
}

/* --- CSS Variables --- */
:root {
    --nemo-primary-accent: var(--SmartThemeQuoteColor);
    --nemo-secondary-accent: var(--SmartThemeQuoteColor);
    --nemo-primary-bg: var(--SmartThemeBlurTintColor);
    --nemo-secondary-bg: var(--SmartThemeBotMesBlurTintColor);
    --nemo-tertiary-bg: var(--SmartThemeUserMesBlurTintColor);
    --nemo-item-hover-bg: var(--white20a);
    --nemo-text-color: var(--SmartThemeBodyColor);
    --nemo-text-muted: var(--SmartThemeEmColor);
    --nemo-border-color: var(--SmartThemeBorderColor);
    --nemo-shadow-color: var(--black30a);
    --nemo-glow-color: var(--SmartThemeQuoteColor);
    --nemo-folder-color: var(--SmartThemeQuoteColor);
}

/* === NEMO PRESET MANAGER & PROMPT UI ENHANCEMENTS === */

/* --- Collapsible Sections & Core Prompt UI --- */
.nemo-engine-section summary { cursor: pointer; display: flex; align-items: center; list-style: none; position: relative; }
.nemo-engine-section summary > li.completion_prompt_manager_prompt, li.completion_prompt_manager_prompt { display: flex; align-items: flex-start; width: 100%; justify-content: space-between; flex-wrap: wrap; padding: 4px 0; gap: 4px; }
.nemo-engine-section summary::-webkit-details-marker, .nemo-engine-section summary::marker { display: none; }
.nemo-engine-section summary::before { content: '▶'; font-size: 0.75em; position: absolute; left: -15px; top: 50%; transform: translateY(-50%); color: var(--nemo-text-muted); pointer-events: none; transition: transform 0.2s ease; }
.nemo-engine-section[open] > summary::before { transform: translateY(-50%) rotate(90deg); }
.nemo-engine-section summary > li.completion_prompt_manager_prompt > span.completion_prompt_manager_prompt_name { margin-left: 18px; }
.nemo-engine-section .nemo-section-content { padding-left: 15px; border-left: 1px solid var(--nemo-border-color); margin-left: 5px; display: flex; flex-direction: column; gap: 2px; }
span.completion_prompt_manager_prompt_name { flex-grow: 1; flex-shrink: 1; min-width: 50px; white-space: normal; word-break: break-word; margin-right: 6px; display: flex; align-items: center; padding-right: 4px; flex-wrap: wrap; }
span.completion_prompt_manager_prompt_name a.prompt-manager-inspect-action { white-space: normal; word-break: break-word; display: inline; }
.nemo-right-controls-wrapper { display: flex; align-items: center; flex-shrink: 0; gap: 8px; }
.nemo-enabled-count { font-weight: normal; font-size: 0.9em; color: var(--nemo-primary-accent); white-space: nowrap; line-height: 1; margin-left: 5px;}

/* Section Progress Bar */
.nemo-section-progress {
    display: inline-block;
    width: 60px;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-left: 8px;
    position: relative;
    overflow: hidden;
    vertical-align: middle;
}

.nemo-section-progress::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: var(--progress-width, 0%);
    border-radius: 3px;
    transition: width 0.3s ease, background-color 0.3s ease;
}

.nemo-section-progress.nemo-progress-none::after {
    background: linear-gradient(90deg, rgba(150, 150, 150, 0.3), rgba(150, 150, 150, 0.5));
    width: 100%;
    opacity: 0.3;
}

.nemo-section-progress.nemo-progress-partial::after {
    background: linear-gradient(90deg, var(--nemo-primary-accent, #4a9eff), rgba(74, 158, 255, 0.7));
}

.nemo-section-progress.nemo-progress-full::after {
    background: linear-gradient(90deg, #51cf66, #40c057);
}

/* Category Tray System */

/* Hide original content when in tray mode */
.nemo-tray-section > .nemo-section-content.nemo-tray-hidden-content {
    display: none !important;
}

/* Hide individual prompts in tray mode (preserves DOM for mode switching) */
.nemo-tray-hidden-prompt {
    display: none !important;
}

/* Sub-section headers in tray mode get a folder indicator */
.nemo-tray-section > summary::after {
    content: '📁';
    margin-left: 8px;
    font-size: 12px;
    opacity: 0.7;
}

.nemo-tray-section.nemo-tray-open > summary::after {
    content: '📂';
}

/* Category Tray Panel */
.nemo-category-tray {
    background: linear-gradient(135deg, rgba(25, 25, 40, 0.98) 0%, rgba(15, 15, 30, 0.98) 100%);
    border: 1px solid rgba(74, 158, 255, 0.3);
    border-radius: 8px;
    margin: 8px 0 8px 20px;
    padding: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    animation: nemo-tray-open 0.25s ease-out;
    position: relative;
    z-index: 10;
    overflow: visible; /* Allow drag clone to escape */
}

@keyframes nemo-tray-open {
    from {
        opacity: 0;
        transform: translateY(-10px) scaleY(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scaleY(1);
    }
}

.nemo-category-tray.nemo-tray-closing {
    animation: nemo-tray-close 0.2s ease-out forwards;
}

@keyframes nemo-tray-close {
    from {
        opacity: 1;
        transform: translateY(0) scaleY(1);
    }
    to {
        opacity: 0;
        transform: translateY(-10px) scaleY(0.9);
    }
}

.nemo-tray-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.nemo-tray-title {
    font-weight: 600;
    color: var(--nemo-text-high-contrast, #fff);
    font-size: 14px;
}

.nemo-tray-close {
    background: none;
    border: none;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    font-size: 20px;
    padding: 0 4px;
    transition: color 0.2s;
    line-height: 1;
}

.nemo-tray-close:hover {
    color: #ff6b6b;
}

/* Header controls container */
.nemo-tray-header-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Toggle all button */
.nemo-tray-toggle-all {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    font-size: 12px;
    padding: 4px 8px;
    transition: all 0.2s;
}

.nemo-tray-toggle-all:hover {
    background: rgba(74, 158, 255, 0.2);
    border-color: rgba(74, 158, 255, 0.4);
    color: #fff;
}

.nemo-tray-toggle-all.nemo-all-enabled {
    background: rgba(81, 207, 102, 0.2);
    border-color: rgba(81, 207, 102, 0.4);
    color: #51cf66;
}

.nemo-tray-toggle-all.nemo-all-enabled:hover {
    background: rgba(255, 107, 107, 0.2);
    border-color: rgba(255, 107, 107, 0.4);
    color: #ff6b6b;
}

/* Grid of prompt cards */
.nemo-tray-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 8px;
    max-height: 400px;
    overflow-y: auto;
    padding-right: 4px;
}

/* Individual prompt card - use consistent border widths to prevent layout shift */
.nemo-prompt-card {
    background: rgba(255, 255, 255, 0.03);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-left: 4px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    padding: 8px 10px;
    cursor: pointer;
    transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
    display: flex;
    gap: 8px;
    overflow: hidden;
    align-items: stretch;
}

.nemo-prompt-card:hover {
    background: rgba(74, 158, 255, 0.1);
    border-color: rgba(74, 158, 255, 0.4);
    border-left-color: rgba(74, 158, 255, 0.6);
}

/* Drag handle */
.nemo-prompt-card-drag-handle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    min-width: 20px;
    color: rgba(255, 255, 255, 0.3);
    cursor: grab;
    font-size: 12px;
    transition: color 0.2s ease;
    flex-shrink: 0;
}

.nemo-prompt-card-drag-handle:hover {
    color: rgba(255, 255, 255, 0.7);
}

.nemo-prompt-card-drag-handle:active {
    cursor: grabbing;
}

.nemo-prompt-card-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Drag states for tray cards - kept minimal for performance */
.nemo-tray-card-ghost {
    opacity: 0.3 !important;
    visibility: hidden !important; /* Hide ghost to reduce visual clutter */
}

/* Style for the card being dragged (native drag) */
.nemo-prompt-card.sortable-chosen {
    opacity: 0.5;
    cursor: grabbing !important;
}

/* Sortable drag class */
.nemo-prompt-card.sortable-drag {
    opacity: 0.9;
    z-index: 99999 !important;
}

/* Prevent tray layout from shifting during drag */
.nemo-tray-grid {
    min-height: 50px;
}

/* Sub-section divider in tray view */
.nemo-tray-subsection-divider {
    width: 100%;
    padding: 6px 8px 4px;
    margin-top: 4px;
    font-size: 0.85em;
    opacity: 0.7;
    border-left: 2px solid var(--SmartThemeQuoteColor, #888);
    grid-column: 1 / -1;
}

.nemo-tray-subsection-name {
    font-weight: 500;
}

/* Drop target indicator for section headers */
.nemo-drop-target-active {
    background: rgba(74, 158, 255, 0.2) !important;
    outline: 2px dashed rgba(74, 158, 255, 0.7) !important;
    outline-offset: -2px;
}

.nemo-drop-target-active::after {
    content: ' (drop here)';
    color: rgba(74, 158, 255, 0.9);
    font-size: 0.8em;
    font-style: italic;
}

/* Top-level prompts section */
.nemo-top-level-section {
    border-left: 3px solid #f39c12 !important;
    margin-bottom: 8px;
}

.nemo-top-level-section > summary {
    background: linear-gradient(90deg, rgba(243, 156, 18, 0.1) 0%, transparent 50%);
}

.nemo-top-level-section > summary .completion_prompt_manager_prompt_name a {
    color: #f39c12 !important;
    font-weight: 600;
}

/* Top-level drop zone for moving prompts outside sections */
.nemo-top-level-drop-zone {
    padding: 12px 16px;
    margin: 8px 0;
    border: 2px dashed rgba(74, 158, 255, 0.4);
    border-radius: 8px;
    background: rgba(74, 158, 255, 0.05);
    text-align: center;
    cursor: pointer;
}

.nemo-top-level-drop-zone .nemo-drop-zone-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    color: rgba(74, 158, 255, 0.7);
    font-size: 0.9rem;
}

.nemo-top-level-drop-zone .nemo-drop-zone-content i {
    font-size: 1rem;
}

.nemo-top-level-drop-zone.nemo-drop-zone-active {
    border-color: rgba(74, 158, 255, 0.8);
    background: rgba(74, 158, 255, 0.15);
}

.nemo-top-level-drop-zone.nemo-drop-zone-active .nemo-drop-zone-content {
    color: rgba(74, 158, 255, 1);
}

/* Enabled card - only change colors, not sizes to prevent layout shift */
.nemo-prompt-card-enabled {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.18), rgba(39, 174, 96, 0.12));
    border-color: #2ecc71;
    border-left-color: #2ecc71;
    box-shadow: 0 2px 8px rgba(46, 204, 113, 0.2);
    opacity: 1;
}

/* Enabled card title gets green tint */
.nemo-prompt-card-enabled .nemo-prompt-card-name {
    color: #5ddb8a !important;
}

/* Style the existing status checkmark */
.nemo-prompt-card-enabled .nemo-prompt-card-status {
    color: #2ecc71 !important;
    font-size: 18px;
}

.nemo-prompt-card-enabled:hover {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.25), rgba(39, 174, 96, 0.18));
    border-color: #3de07d;
    box-shadow: 0 4px 12px rgba(46, 204, 113, 0.25);
}

/* Disabled card styling - dimmed but same size */
.nemo-prompt-card:not(.nemo-prompt-card-enabled) {
    opacity: 0.55;
}

.nemo-prompt-card:not(.nemo-prompt-card-enabled):hover {
    opacity: 0.85;
}

.nemo-prompt-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 6px;
    min-height: 20px;
}

.nemo-prompt-card-name {
    font-weight: 600;
    font-size: 13px;
    color: var(--nemo-text-high-contrast, #fff);
    white-space: normal;
    word-break: break-word;
    line-height: 1.3;
    flex: 1;
    min-width: 0;
}

.nemo-prompt-card-status {
    color: #51cf66;
    font-size: 16px;
    flex-shrink: 0;
}

/* Legacy class - keep for backwards compatibility */
.nemo-prompt-card-tooltip {
    font-size: 13px;
    color: var(--nemo-text-muted, #bbb);
    line-height: 1.5;
    margin-top: 6px;
    display: block;
    white-space: normal;
    word-break: break-word;
}

/* Card badge (from directive) */
.nemo-prompt-card-badge {
    display: inline-block;
    margin-left: 8px;
    padding: 2px 8px;
    color: white;
    border-radius: 3px;
    font-size: 10px;
    font-weight: bold;
    text-transform: uppercase;
    vertical-align: middle;
    flex-shrink: 0;
}

/* Card icon (from directive) */
.nemo-prompt-card-icon {
    margin-right: 6px;
    font-size: 14px;
}

/* Highlighted/glow card (from directive) */
.nemo-prompt-card-highlighted {
    animation: nemo-card-glow 2s ease-in-out infinite;
    box-shadow: 0 0 8px var(--nemo-card-color, rgba(74, 158, 255, 0.5));
}

@keyframes nemo-card-glow {
    0%, 100% {
        box-shadow: 0 0 5px var(--nemo-card-color, rgba(74, 158, 255, 0.4)),
                    0 0 10px var(--nemo-card-color, rgba(74, 158, 255, 0.2));
    }
    50% {
        box-shadow: 0 0 10px var(--nemo-card-color, rgba(74, 158, 255, 0.6)),
                    0 0 20px var(--nemo-card-color, rgba(74, 158, 255, 0.4));
    }
}

/* Card with color - subtle background tint */
.nemo-prompt-card[style*="--nemo-card-color"] {
    background: linear-gradient(135deg,
        rgba(255, 255, 255, 0.03) 0%,
        color-mix(in srgb, var(--nemo-card-color) 10%, transparent) 100%
    );
}

.nemo-prompt-card[style*="--nemo-card-color"]:hover {
    background: linear-gradient(135deg,
        rgba(255, 255, 255, 0.05) 0%,
        color-mix(in srgb, var(--nemo-card-color) 20%, transparent) 100%
    );
}

/* Tray footer */
.nemo-tray-footer {
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.nemo-tray-hint {
    font-size: 11px;
    color: var(--nemo-text-muted, #888);
}

/* Scrollbar styling for tray grid */
.nemo-tray-grid::-webkit-scrollbar {
    width: 6px;
}

.nemo-tray-grid::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 3px;
}

.nemo-tray-grid::-webkit-scrollbar-thumb {
    background: rgba(74, 158, 255, 0.3);
    border-radius: 3px;
}

.nemo-tray-grid::-webkit-scrollbar-thumb:hover {
    background: rgba(74, 158, 255, 0.5);
}

.nemo-prompt-card-actions {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}

.nemo-prompt-card-edit,
.nemo-prompt-card-move {
    color: var(--nemo-text-muted, #888);
    cursor: pointer;
    padding: 3px 5px;
    border-radius: 3px;
    transition: all 0.15s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.nemo-prompt-card-edit:hover {
    color: #4a9eff;
    background: rgba(74, 158, 255, 0.15);
}

.nemo-prompt-card-move:hover {
    color: #f39c12;
    background: rgba(243, 156, 18, 0.15);
}

/* Prompt card meta section (tokens, tooltip) */
.nemo-prompt-card-meta {
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 11px;
    color: var(--nemo-text-muted, #888);
    margin-top: 6px;
}

.nemo-prompt-card-tokens {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    background: rgba(255, 255, 255, 0.08);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: var(--monoFontFamily, monospace);
    font-size: 10px;
    white-space: nowrap;
    width: fit-content;
}

.nemo-prompt-card-tokens i {
    color: #f1c40f;
    opacity: 0.8;
    font-size: 9px;
}

.nemo-token-value {
    min-width: 20px;
}

.nemo-prompt-card-tooltip-text {
    font-size: 11px;
    line-height: 1.4;
    opacity: 0.75;
    color: var(--nemo-text-muted, #aaa);
    word-wrap: break-word;
    overflow-wrap: break-word;
}

/* Compact mode adjustments for meta */
.nemo-tray-compact .nemo-prompt-card-meta {
    margin-top: 2px;
}

.nemo-tray-compact .nemo-prompt-card-tokens {
    padding: 1px 4px;
    font-size: 9px;
}

/* ========================================
   COMPACT VIEW MODE
   ======================================== */

.nemo-tray-compact .nemo-tray-grid {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.nemo-tray-compact .nemo-prompt-card {
    padding: 8px 12px;
    border-radius: 4px;
}

.nemo-tray-compact .nemo-prompt-card-header {
    margin-bottom: 0;
}

.nemo-tray-compact .nemo-prompt-card-name {
    font-size: 13px;
}

.nemo-tray-compact .nemo-prompt-card-tooltip,
.nemo-tray-compact .nemo-prompt-card-tooltip-text {
    display: none;
}

.nemo-tray-compact-toggle {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    font-size: 12px;
    padding: 4px 8px;
    transition: all 0.2s;
}

.nemo-tray-compact-toggle:hover {
    background: rgba(74, 158, 255, 0.2);
    border-color: rgba(74, 158, 255, 0.4);
    color: #fff;
}

.nemo-tray-compact-toggle.nemo-compact-active {
    background: rgba(74, 158, 255, 0.3);
    border-color: rgba(74, 158, 255, 0.5);
    color: #4a9eff;
}

/* ========================================
   PRESETS DROPDOWN
   ======================================== */

.nemo-tray-presets-dropdown {
    position: relative;
}

.nemo-tray-presets-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    font-size: 12px;
    padding: 4px 8px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
}

.nemo-tray-presets-btn:hover {
    background: rgba(255, 193, 7, 0.2);
    border-color: rgba(255, 193, 7, 0.4);
    color: #ffc107;
}

.nemo-preset-count {
    background: rgba(255, 193, 7, 0.8);
    color: #000;
    font-size: 10px;
    font-weight: bold;
    padding: 1px 5px;
    border-radius: 8px;
    min-width: 14px;
    text-align: center;
}

.nemo-presets-menu {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 4px;
    background: linear-gradient(135deg, rgba(35, 35, 50, 0.98) 0%, rgba(25, 25, 40, 0.98) 100%);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 8px;
    min-width: 200px;
    max-width: 280px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
}

.nemo-presets-menu.nemo-presets-open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.nemo-presets-header {
    font-weight: 600;
    color: #ffc107;
    padding: 10px 12px 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nemo-preset-save {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 10px 12px;
    background: none;
    border: none;
    color: #51cf66;
    cursor: pointer;
    font-size: 13px;
    text-align: left;
    transition: background 0.2s;
}

.nemo-preset-save:hover {
    background: rgba(81, 207, 102, 0.15);
}

.nemo-presets-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 4px 0;
}

.nemo-presets-list {
    max-height: 200px;
    overflow-y: auto;
}

.nemo-preset-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    cursor: pointer;
    transition: background 0.2s;
}

.nemo-preset-item:hover {
    background: rgba(74, 158, 255, 0.15);
}

.nemo-preset-name {
    flex: 1;
    font-size: 13px;
    color: var(--nemo-text-high-contrast, #fff);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.nemo-preset-info {
    font-size: 11px;
    color: var(--nemo-text-muted, #888);
}

.nemo-preset-delete {
    background: none;
    border: none;
    color: var(--nemo-text-muted, #666);
    cursor: pointer;
    padding: 4px;
    border-radius: 3px;
    transition: all 0.2s;
    opacity: 0.5;
}

.nemo-preset-item:hover .nemo-preset-delete {
    opacity: 1;
}

.nemo-preset-delete:hover {
    color: #ff6b6b;
    background: rgba(255, 107, 107, 0.15);
}

.nemo-presets-empty {
    padding: 12px;
    text-align: center;
    color: var(--nemo-text-muted, #666);
    font-size: 12px;
    font-style: italic;
}

/* Preset Name Modal */
.nemo-preset-name-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nemo-preset-modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
}

.nemo-preset-modal-container {
    position: relative;
    background: linear-gradient(135deg, rgba(35, 35, 55, 0.98) 0%, rgba(25, 25, 40, 0.98) 100%);
    border: 1px solid rgba(255, 193, 7, 0.4);
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 30px rgba(255, 193, 7, 0.1);
    animation: nemo-modal-appear 0.25s ease-out;
    overflow: hidden;
}

@keyframes nemo-modal-appear {
    from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.nemo-preset-modal-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 16px 20px;
    background: linear-gradient(90deg, rgba(255, 193, 7, 0.15) 0%, transparent 100%);
    border-bottom: 1px solid rgba(255, 193, 7, 0.2);
    font-size: 16px;
    font-weight: 600;
    color: #ffc107;
}

.nemo-preset-modal-header i {
    font-size: 18px;
}

.nemo-preset-modal-body {
    padding: 20px;
}

.nemo-preset-modal-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
}

.nemo-preset-modal-section {
    font-weight: 500;
    color: var(--nemo-text-high-contrast, #fff);
}

.nemo-preset-modal-count {
    font-size: 12px;
    color: #51cf66;
    background: rgba(81, 207, 102, 0.15);
    padding: 3px 8px;
    border-radius: 10px;
}

.nemo-preset-modal-label {
    display: block;
    font-size: 12px;
    font-weight: 500;
    color: var(--nemo-text-medium-contrast, #aaa);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nemo-preset-modal-input {
    width: 100%;
    padding: 12px 14px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: var(--nemo-text-high-contrast, #fff);
    font-size: 14px;
    outline: none;
    transition: all 0.2s;
}

.nemo-preset-modal-input:focus {
    border-color: rgba(255, 193, 7, 0.5);
    box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
}

.nemo-preset-modal-input::placeholder {
    color: var(--nemo-text-muted, #666);
}

.nemo-preset-modal-suggestions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
}

.nemo-preset-suggestion {
    padding: 5px 12px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    font-size: 12px;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    transition: all 0.2s;
}

.nemo-preset-suggestion:hover {
    background: rgba(255, 193, 7, 0.15);
    border-color: rgba(255, 193, 7, 0.3);
    color: #ffc107;
}

.nemo-preset-modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 16px 20px;
    background: rgba(0, 0, 0, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.nemo-preset-modal-cancel {
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 6px;
    color: var(--nemo-text-medium-contrast, #aaa);
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
}

.nemo-preset-modal-cancel:hover {
    background: rgba(255, 255, 255, 0.15);
    color: #fff;
}

.nemo-preset-modal-save {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.8) 0%, rgba(255, 152, 0, 0.8) 100%);
    border: none;
    border-radius: 6px;
    color: #000;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.nemo-preset-modal-save:hover:not(:disabled) {
    background: linear-gradient(135deg, rgba(255, 193, 7, 1) 0%, rgba(255, 152, 0, 1) 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
}

.nemo-preset-modal-save:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* ========================================
   DEPENDENCY INDICATORS
   ======================================== */

.nemo-prompt-card-deps {
    display: flex;
    gap: 4px;
    margin-right: 4px;
}

.nemo-dep-requires,
.nemo-dep-exclusive,
.nemo-dep-conflicts {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    border-radius: 3px;
    font-size: 10px;
    cursor: help;
}

.nemo-dep-requires {
    background: rgba(74, 158, 255, 0.2);
    color: #4a9eff;
}

.nemo-dep-exclusive {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
}

.nemo-dep-conflicts {
    background: rgba(255, 107, 107, 0.2);
    color: #ff6b6b;
}

/* Related prompt highlighting on hover */
.nemo-related-required {
    outline: 2px solid rgba(74, 158, 255, 0.6) !important;
    outline-offset: 2px;
    box-shadow: 0 0 12px rgba(74, 158, 255, 0.4);
}

.nemo-related-exclusive {
    outline: 2px solid rgba(255, 193, 7, 0.6) !important;
    outline-offset: 2px;
    box-shadow: 0 0 12px rgba(255, 193, 7, 0.4);
}

.nemo-related-conflict {
    outline: 2px solid rgba(255, 107, 107, 0.6) !important;
    outline-offset: 2px;
    box-shadow: 0 0 12px rgba(255, 107, 107, 0.4);
}

/* ========================================
   KEYBOARD NAVIGATION
   ======================================== */

.nemo-category-tray:focus {
    outline: none;
}

.nemo-prompt-card.nemo-card-focused {
    outline: 2px solid rgba(74, 158, 255, 0.8);
    outline-offset: 2px;
    box-shadow: 0 0 15px rgba(74, 158, 255, 0.5);
}

.nemo-tray-compact .nemo-prompt-card.nemo-card-focused {
    outline-offset: 1px;
}

/* ========================================
   IMPROVED SUB-SECTION STYLING
   ======================================== */

/* Sub-section differentiation */
details.nemo-engine-section.nemo-sub-section {
    margin-left: 16px;
    border-left: 2px solid rgba(74, 158, 255, 0.3);
    padding-left: 8px;
}

details.nemo-engine-section.nemo-sub-section > summary {
    font-size: 0.95em;
}

details.nemo-engine-section.nemo-sub-section > summary::before {
    content: '└─';
    margin-right: 6px;
    color: rgba(74, 158, 255, 0.5);
    font-family: monospace;
}

/* Nested sub-section visual hierarchy */
details.nemo-engine-section.nemo-sub-section details.nemo-engine-section.nemo-sub-section {
    margin-left: 12px;
    border-left-color: rgba(255, 193, 7, 0.3);
}

details.nemo-engine-section.nemo-sub-section details.nemo-engine-section.nemo-sub-section > summary::before {
    color: rgba(255, 193, 7, 0.5);
}

/* Section hover effect */
details.nemo-engine-section > summary:hover {
    background: rgba(74, 158, 255, 0.08);
}

details.nemo-engine-section.nemo-sub-section > summary:hover {
    background: rgba(74, 158, 255, 0.12);
}

/* Tray mode section folder icon improvements */
.nemo-tray-section > summary::after {
    transition: all 0.2s ease;
}

.nemo-tray-section:hover > summary::after {
    transform: scale(1.1);
}

/* Section with open tray indicator */
.nemo-tray-section.nemo-tray-open > summary {
    background: rgba(74, 158, 255, 0.15);
    border-radius: 4px;
}

/* Keyboard focus for section summaries */
.nemo-tray-section > summary:focus {
    outline: 2px solid rgba(74, 158, 255, 0.6);
    outline-offset: 2px;
    border-radius: 4px;
}

.nemo-tray-section > summary:focus:not(:focus-visible) {
    outline: none;
}

.nemo-tray-section > summary:focus-visible {
    outline: 2px solid rgba(74, 158, 255, 0.8);
    outline-offset: 2px;
}

/* Sub-section tray positioning */
details.nemo-engine-section.nemo-sub-section + .nemo-category-tray {
    margin-left: 24px;
    border-left: 2px solid rgba(74, 158, 255, 0.2);
}

/* Progress bar improvements for sub-sections */
details.nemo-engine-section.nemo-sub-section .nemo-section-progress {
    height: 3px;
}

/* Alternating sub-section colors for better hierarchy */
details.nemo-engine-section.nemo-sub-section:nth-child(odd) {
    border-left-color: rgba(147, 112, 219, 0.3);
}

details.nemo-engine-section.nemo-sub-section:nth-child(odd) > summary::before {
    color: rgba(147, 112, 219, 0.5);
}

/* Improved section header styling */
details.nemo-engine-section > summary {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    border-radius: 6px;
    transition: all 0.2s ease;
    cursor: pointer;
}

details.nemo-engine-section > summary .completion_prompt_manager_prompt_name {
    flex: 1;
}

/* Section count badge styling */
details.nemo-engine-section .nemo-enabled-count {
    font-size: 12px;
    color: var(--nemo-text-muted, #888);
    margin-left: 8px;
    font-weight: normal;
}

/* ============================================
   ACCORDION MODE STYLES
   ============================================ */

/* Accordion section styling */
.nemo-accordion-section {
    margin-bottom: 4px;
}

.nemo-accordion-section > summary {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.08), rgba(147, 112, 219, 0.05));
    border: 1px solid rgba(74, 158, 255, 0.15);
    border-radius: 8px;
    transition: all 0.2s ease;
}

.nemo-accordion-section > summary:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.15), rgba(147, 112, 219, 0.1));
    border-color: rgba(74, 158, 255, 0.3);
}

.nemo-accordion-section[open] > summary {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-bottom-color: transparent;
}

.nemo-accordion-section[open] > .nemo-section-content {
    border: 1px solid rgba(74, 158, 255, 0.15);
    border-top: none;
    border-radius: 0 0 8px 8px;
    padding: 8px;
    background: rgba(0, 0, 0, 0.15);
    animation: nemo-accordion-expand 0.2s ease-out;
}

@keyframes nemo-accordion-expand {
    from {
        opacity: 0;
        max-height: 0;
    }
    to {
        opacity: 1;
        max-height: 1000px;
    }
}

/* Accordion prompt item styling */
.nemo-accordion-prompt {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    margin: 4px 0;
    border-radius: 6px;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    position: relative;
}

.nemo-accordion-prompt .drag-handle {
    cursor: grab;
    opacity: 0.5;
    margin-right: 8px;
    font-size: 14px;
    transition: opacity 0.2s ease;
}

.nemo-accordion-prompt:hover .drag-handle {
    opacity: 1;
}

.nemo-accordion-prompt .drag-handle:active {
    cursor: grabbing;
}

/* ENABLED state - prominent visual indication */
.nemo-accordion-prompt-enabled {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.18), rgba(39, 174, 96, 0.12));
    border: 2px solid rgba(46, 204, 113, 0.5);
    border-left: 5px solid #2ecc71;
    box-shadow: 0 2px 6px rgba(46, 204, 113, 0.15);
}

.nemo-accordion-prompt-enabled:hover {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.25), rgba(39, 174, 96, 0.18));
    border-color: rgba(46, 204, 113, 0.7);
}

.nemo-accordion-prompt-enabled .prompt-manager-toggle-action {
    color: #2ecc71 !important;
}

.nemo-accordion-prompt-enabled .completion_prompt_manager_prompt_name a {
    color: #5ddb8a !important;
}

/* DISABLED state - subtle but clear */
.nemo-accordion-prompt-disabled {
    background: rgba(0, 0, 0, 0.12);
    border-color: rgba(255, 255, 255, 0.05);
    opacity: 0.55;
}

.nemo-accordion-prompt-disabled:hover {
    opacity: 0.85;
    background: rgba(0, 0, 0, 0.18);
    border-color: rgba(255, 255, 255, 0.1);
}

.nemo-accordion-prompt-disabled .prompt-manager-toggle-action {
    color: #888 !important;
}

/*
 * INSTANT STATE STYLING - Uses :has() to directly match SillyTavern's toggle state.
 * This prevents the flash/flicker when toggling because it doesn't rely on JS adding classes.
 * The styling is always in sync with ST's actual toggle button state.
 */

/* Enabled state - match when toggle button has fa-toggle-on */
.nemo-accordion-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action.fa-toggle-on) {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.18), rgba(39, 174, 96, 0.12)) !important;
    border: 2px solid rgba(46, 204, 113, 0.5) !important;
    border-left: 5px solid #2ecc71 !important;
    box-shadow: 0 2px 6px rgba(46, 204, 113, 0.15) !important;
}

.nemo-accordion-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action.fa-toggle-on):hover {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.25), rgba(39, 174, 96, 0.18)) !important;
    border-color: rgba(46, 204, 113, 0.7) !important;
}


/* Disabled state - match when toggle button does NOT have fa-toggle-on */
.nemo-accordion-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action:not(.fa-toggle-on)) {
    background: rgba(0, 0, 0, 0.12) !important;
    border-color: rgba(255, 255, 255, 0.05) !important;
    opacity: 0.55;
}

.nemo-accordion-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action:not(.fa-toggle-on)):hover {
    opacity: 0.85;
    background: rgba(0, 0, 0, 0.18) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
}

/* Also apply to general engine sections (fallback for non-accordion mode) */
.nemo-engine-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action.fa-toggle-on) {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.18), rgba(39, 174, 96, 0.12)) !important;
    border: 2px solid rgba(46, 204, 113, 0.5) !important;
    border-left: 5px solid #2ecc71 !important;
    box-shadow: 0 2px 6px rgba(46, 204, 113, 0.15) !important;
}

.nemo-engine-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action.fa-toggle-on):hover {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.25), rgba(39, 174, 96, 0.18)) !important;
    border-color: rgba(46, 204, 113, 0.7) !important;
}



.nemo-engine-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action:not(.fa-toggle-on)) {
    background: rgba(0, 0, 0, 0.12) !important;
    border-color: rgba(255, 255, 255, 0.05) !important;
    opacity: 0.55;
}

.nemo-engine-section li.completion_prompt_manager_prompt:has(.prompt-manager-toggle-action:not(.fa-toggle-on)):hover {
    opacity: 0.85;
    background: rgba(0, 0, 0, 0.18) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
}

/* Drag and drop styles for accordion - kept minimal for performance */
.nemo-accordion-drag-ghost {
    opacity: 0.3;
}

.nemo-accordion-drag-active {
    cursor: grabbing !important;
}

/* Select control styling in settings */
.nemo-select-control {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
    color: inherit;
    font-size: 13px;
    cursor: pointer;
    min-width: 140px;
}

.nemo-select-control:hover {
    border-color: rgba(74, 158, 255, 0.3);
}

.nemo-select-control:focus {
    outline: none;
    border-color: rgba(74, 158, 255, 0.5);
    box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
}

/* Prompt Preview Modal */
.nemo-prompt-preview-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 2147483647; /* Ensure it's on top of everything */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px; /* Prevent touching edges on small screens */
}

.nemo-preview-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(4px);
    z-index: -1;
}

.nemo-preview-container {
    position: relative;
    background: linear-gradient(135deg, rgba(30, 30, 45, 0.98) 0%, rgba(20, 20, 35, 0.98) 100%);
    border: 1px solid rgba(74, 158, 255, 0.3);
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 85vh; /* Increased slightly */
    display: flex;
    flex-direction: column;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    animation: nemo-preview-appear 0.2s ease-out;
    margin: auto; /* Ensure centering works even if flex has issues */
}

@keyframes nemo-preview-appear {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.nemo-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.nemo-preview-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--nemo-text-high-contrast, #fff);
}

.nemo-preview-header-actions {
    display: flex;
    align-items: center;
    gap: 10px;
}

.nemo-preview-edit-btn {
    background: rgba(74, 158, 255, 0.2);
    border: 1px solid rgba(74, 158, 255, 0.4);
    border-radius: 6px;
    color: #4a9eff;
    cursor: pointer;
    font-size: 13px;
    padding: 6px 12px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.nemo-preview-edit-btn:hover {
    background: rgba(74, 158, 255, 0.3);
    border-color: rgba(74, 158, 255, 0.6);
}

.nemo-preview-close {
    background: none;
    border: none;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    font-size: 24px;
    padding: 0 8px;
    transition: color 0.2s;
    line-height: 1;
}

.nemo-preview-close:hover {
    color: #ff6b6b;
}

.nemo-preview-legend {
    display: flex;
    gap: 20px;
    padding: 10px 20px;
    background: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    font-size: 11px;
}

.nemo-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--nemo-text-muted, #888);
}

.nemo-var-resolved-sample {
    display: inline-block;
    width: 12px;
    height: 12px;
    background: rgba(81, 207, 102, 0.3);
    border: 1px dashed #51cf66;
    border-radius: 2px;
}

.nemo-macro-unresolved-sample {
    display: inline-block;
    width: 12px;
    height: 12px;
    background: rgba(255, 193, 7, 0.2);
    border: 1px solid rgba(255, 193, 7, 0.5);
    border-radius: 2px;
}

.nemo-preview-content {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 13px;
    line-height: 1.6;
    color: var(--nemo-text-high-contrast, #ddd);
    white-space: pre-wrap;
    word-break: break-word;
}

/* Resolved variable highlighting */
.nemo-var-resolved {
    background: rgba(81, 207, 102, 0.2);
    border: 1px dashed rgba(81, 207, 102, 0.6);
    border-radius: 3px;
    padding: 1px 6px;
    color: #51cf66;
    font-weight: 500;
    cursor: help;
    position: relative;
}

.nemo-var-resolved::before {
    content: '📌 ';
    font-size: 10px;
}

/* Unset variable styling */
.nemo-var-resolved.nemo-var-unset {
    background: rgba(255, 107, 107, 0.2);
    border-color: rgba(255, 107, 107, 0.6);
    color: #ff6b6b;
}

.nemo-var-resolved.nemo-var-unset::before {
    content: '⚠️ ';
}

/* Unresolved macro highlighting */
.nemo-macro-unresolved {
    background: rgba(255, 193, 7, 0.15);
    border: 1px solid rgba(255, 193, 7, 0.4);
    border-radius: 3px;
    padding: 1px 4px;
    color: #ffc107;
    font-size: 12px;
}

.nemo-preview-footer {
    padding: 12px 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
}

.nemo-preview-hint {
    font-size: 11px;
    color: var(--nemo-text-muted, #888);
    font-style: italic;
}

/* Preview content scrollbar */
.nemo-preview-content::-webkit-scrollbar {
    width: 8px;
}

.nemo-preview-content::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

.nemo-preview-content::-webkit-scrollbar-thumb {
    background: rgba(74, 158, 255, 0.3);
    border-radius: 4px;
}

.nemo-preview-content::-webkit-scrollbar-thumb:hover {
    background: rgba(74, 158, 255, 0.5);
}

/* ============================================
   BASE MOBILE STYLES - Always Applied
   ============================================
   These basic mobile fixes apply to all users regardless of
   the mobile enhancements setting.
*/

@media (max-width: 768px) {
    /* Ensure prompt card names are always visible on mobile */
    .nemo-prompt-card-header {
        flex-direction: column;
        align-items: center;
        gap: 6px;
    }

    .nemo-prompt-card-name {
        white-space: normal;
        text-align: center;
        width: 100%;
        overflow: visible;
        word-wrap: break-word;
    }

    .nemo-prompt-card-actions {
        justify-content: center;
    }

    .nemo-prompt-card-meta {
        align-items: center;
        text-align: center;
    }

    .nemo-prompt-card-tokens {
        margin: 0 auto;
    }

    .nemo-prompt-card-tooltip-text {
        text-align: center;
    }

    .nemo-prompt-card-content {
        align-items: center;
        text-align: center;
    }

    /* Fix: Ensure Preview Modal is visible and centered on mobile */
    .nemo-prompt-preview-modal {
        padding: 10px !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 2147483647 !important;
    }

    .nemo-preview-container {
        width: 100% !important;
        max-width: 100% !important;
        max-height: 85vh !important;
        margin: auto !important;
        animation: none !important;
    }
}

/* ============================================
   MOBILE STYLES - Category Tray & Preview
   ============================================

   These styles only apply when:
   1. The screen is small enough (media query)
   2. AND the mobile enhancements setting is enabled (.nemo-mobile-enhanced class on body)

   Users can disable mobile enhancements in extension settings.
*/

/* Tablet breakpoint - Enhanced mobile styles (optional) */
@media (max-width: 768px) {
    /* Category Tray - Full width on tablet */
    .nemo-mobile-enhanced .nemo-category-tray {
        margin: 8px 0;
        padding: 14px;
        border-radius: 8px;
    }

    /* Single column grid for readability on mobile */
    .nemo-mobile-enhanced .nemo-tray-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: 60vh;
    }

    /* Bigger touch targets for cards */
    .nemo-mobile-enhanced .nemo-prompt-card {
        padding: 16px;
        min-height: 80px;
    }

    /* Large, readable title */
    .nemo-mobile-enhanced .nemo-prompt-card-name {
        font-size: 17px;
        font-weight: 600;
        white-space: normal;
        word-break: break-word;
        line-height: 1.4;
        color: #fff;
        text-align: center;
        width: 100%;
        overflow: visible;
    }

    /* Show full tooltip without truncation */
    .nemo-mobile-enhanced .nemo-prompt-card-tooltip-text {
        font-size: 14px;
        line-height: 1.5;
        color: rgba(255, 255, 255, 0.8);
        -webkit-line-clamp: unset;
        display: block;
        margin-top: 8px;
        text-align: center;
    }

    /* Center card content on tablet */
    .nemo-mobile-enhanced .nemo-prompt-card-content {
        align-items: center;
        text-align: center;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-header {
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-meta {
        align-items: center;
        text-align: center;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-tokens {
        margin: 0 auto;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-actions {
        justify-content: center;
    }

    /* Larger edit button for touch */
    .nemo-mobile-enhanced .nemo-prompt-card-edit {
        padding: 8px 10px;
        font-size: 18px;
    }

    /* Larger status checkmark */
    .nemo-mobile-enhanced .nemo-prompt-card-status {
        font-size: 20px;
    }

    /* Larger toggle-all button */
    .nemo-mobile-enhanced .nemo-tray-toggle-all {
        padding: 10px 14px;
        font-size: 15px;
    }

    .nemo-mobile-enhanced .nemo-tray-close {
        font-size: 28px;
        padding: 4px 8px;
    }

    /* Tray header improvements */
    .nemo-mobile-enhanced .nemo-tray-header {
        margin-bottom: 14px;
        padding-bottom: 12px;
    }

    .nemo-mobile-enhanced .nemo-tray-title {
        font-size: 18px;
        font-weight: 700;
    }

    /* Footer text more readable */
    .nemo-mobile-enhanced .nemo-tray-hint {
        font-size: 13px;
    }

    /* Preview Modal - More screen space */
    .nemo-mobile-enhanced .nemo-preview-container {
        width: 95%;
        max-height: 85vh;
        border-radius: 8px;
    }

    .nemo-mobile-enhanced .nemo-preview-header {
        padding: 12px 16px;
    }

    .nemo-mobile-enhanced .nemo-preview-title {
        font-size: 15px;
    }

    .nemo-mobile-enhanced .nemo-preview-content {
        padding: 16px;
        font-size: 14px;
    }

    .nemo-mobile-enhanced .nemo-preview-legend {
        flex-wrap: wrap;
        gap: 10px;
        padding: 8px 16px;
    }

    /* Section headers - prevent truncation */
    .nemo-mobile-enhanced .nemo-tray-section > summary .completion_prompt_manager_prompt_name a {
        white-space: normal !important;
        word-break: break-word;
    }
}

/* Mobile phone breakpoint - Enhanced mobile styles (optional) */
@media (max-width: 480px) {
    /* Category Tray - Stack vertically with good padding */
    .nemo-mobile-enhanced .nemo-category-tray {
        margin: 6px 0;
        padding: 12px;
        border-radius: 10px;
    }

    .nemo-mobile-enhanced .nemo-tray-header {
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 12px;
        padding-bottom: 12px;
    }

    .nemo-mobile-enhanced .nemo-tray-title {
        flex: 1 1 100%;
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 6px;
        color: #fff;
    }

    .nemo-mobile-enhanced .nemo-tray-header-controls {
        width: 100%;
        justify-content: space-between;
    }

    /* Single column grid for small phones */
    .nemo-mobile-enhanced .nemo-tray-grid {
        grid-template-columns: 1fr;
        gap: 10px;
        max-height: 55vh;
    }

    /* Cards take full width with generous padding */
    .nemo-mobile-enhanced .nemo-prompt-card {
        padding: 16px;
        min-height: auto;
        border-radius: 8px;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-header {
        flex-direction: column;
        align-items: center;
        margin-bottom: 6px;
        gap: 8px;
    }

    /* Large readable title on phones */
    .nemo-mobile-enhanced .nemo-prompt-card-name {
        font-size: 16px;
        font-weight: 600;
        flex: none;
        width: 100%;
        text-align: center;
        line-height: 1.3;
        color: #fff;
        white-space: normal;
        word-wrap: break-word;
        overflow: visible;
    }

    /* Full tooltip text - no truncation on phones */
    .nemo-mobile-enhanced .nemo-prompt-card-tooltip-text {
        font-size: 14px;
        line-height: 1.5;
        color: rgba(255, 255, 255, 0.75);
        -webkit-line-clamp: unset;
        display: block;
        margin-top: 8px;
        text-align: center;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-actions {
        gap: 12px;
        flex-shrink: 0;
        justify-content: center;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-edit {
        padding: 10px 12px;
        font-size: 18px;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-status {
        font-size: 20px;
        min-width: 28px;
        text-align: center;
    }

    /* Center meta section on mobile */
    .nemo-mobile-enhanced .nemo-prompt-card-meta {
        align-items: center;
        text-align: center;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-tokens {
        margin: 0 auto;
    }

    /* Center card content on mobile */
    .nemo-mobile-enhanced .nemo-prompt-card-content {
        align-items: center;
        text-align: center;
    }

    /* Larger footer text */
    .nemo-mobile-enhanced .nemo-tray-footer {
        padding: 12px 8px;
        margin-top: 12px;
    }

    .nemo-mobile-enhanced .nemo-tray-hint {
        font-size: 13px;
        line-height: 1.4;
    }

    /* Preview Modal - Nearly full screen */
    .nemo-mobile-enhanced .nemo-preview-container {
        width: 100%;
        max-width: 100%;
        max-height: 100vh;
        height: 100vh;
        border-radius: 0;
        margin: 0;
    }

    .nemo-mobile-enhanced .nemo-preview-header {
        padding: 14px;
        position: sticky;
        top: 0;
        background: rgba(30, 30, 45, 0.98);
        z-index: 10;
    }

    .nemo-mobile-enhanced .nemo-preview-title {
        font-size: 16px;
        white-space: normal;
        word-break: break-word;
        flex: 1;
        margin-right: 10px;
    }

    .nemo-mobile-enhanced .nemo-preview-header-actions {
        flex-shrink: 0;
    }

    .nemo-mobile-enhanced .nemo-preview-edit-btn {
        padding: 10px 14px;
        font-size: 14px;
    }

    .nemo-mobile-enhanced .nemo-preview-close {
        font-size: 32px;
        padding: 4px 12px;
    }

    .nemo-mobile-enhanced .nemo-preview-legend {
        flex-direction: column;
        gap: 6px;
        padding: 10px 14px;
    }

    .nemo-mobile-enhanced .nemo-preview-content {
        padding: 14px;
        font-size: 13px;
        line-height: 1.7;
        flex: 1;
    }

    /* Resolved variables - more visible on mobile */
    .nemo-mobile-enhanced .nemo-var-resolved {
        padding: 2px 8px;
        font-size: 13px;
        display: inline-block;
        margin: 2px 0;
    }

    .nemo-mobile-enhanced .nemo-macro-unresolved {
        padding: 2px 6px;
        font-size: 12px;
    }

    .nemo-mobile-enhanced .nemo-preview-footer {
        padding: 12px 14px;
        position: sticky;
        bottom: 0;
        background: rgba(20, 20, 35, 0.98);
    }

    .nemo-mobile-enhanced .nemo-preview-hint {
        font-size: 11px;
        line-height: 1.4;
    }

    /* Section headers on mobile */
    .nemo-mobile-enhanced .nemo-tray-section > summary {
        padding: 10px 8px !important;
    }

    .nemo-mobile-enhanced .nemo-tray-section > summary .completion_prompt_manager_prompt_name {
        flex: 1;
    }

    .nemo-mobile-enhanced .nemo-tray-section > summary .completion_prompt_manager_prompt_name a {
        font-size: 14px !important;
        white-space: normal !important;
        word-break: break-word;
        display: block;
    }

    /* Progress bar more visible */
    .nemo-mobile-enhanced .nemo-section-progress {
        height: 4px !important;
        margin-top: 4px;
    }
}

/* Very small phones - Enhanced mobile styles (optional) */
@media (max-width: 360px) {
    .nemo-mobile-enhanced .nemo-tray-grid {
        max-height: 50vh;
        gap: 8px;
    }

    .nemo-mobile-enhanced .nemo-prompt-card {
        padding: 14px;
    }

    /* Still readable on tiny screens */
    .nemo-mobile-enhanced .nemo-prompt-card-name {
        font-size: 15px;
        font-weight: 600;
        text-align: center;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-tooltip-text {
        font-size: 13px;
        text-align: center;
    }

    .nemo-mobile-enhanced .nemo-tray-title {
        font-size: 16px;
    }

    .nemo-mobile-enhanced .nemo-preview-content {
        font-size: 12px;
    }
}

/* Touch device optimizations - Enhanced mobile styles (optional) */
@media (pointer: coarse) {
    /* Larger touch targets for better accessibility */
    .nemo-mobile-enhanced .nemo-prompt-card {
        min-height: 70px;
    }

    .nemo-mobile-enhanced .nemo-prompt-card-edit {
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .nemo-mobile-enhanced .nemo-tray-toggle-all {
        min-height: 44px;
        min-width: 70px;
    }

    .nemo-mobile-enhanced .nemo-tray-close {
        min-width: 48px;
        min-height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .nemo-mobile-enhanced .nemo-preview-close {
        min-width: 48px;
        min-height: 48px;
    }

    .nemo-mobile-enhanced .nemo-preview-edit-btn {
        min-height: 44px;
    }

    /* Better tap feedback */
    .nemo-mobile-enhanced .nemo-prompt-card:active {
        transform: scale(0.98);
        transition: transform 0.1s;
    }

    .nemo-mobile-enhanced .nemo-tray-toggle-all:active,
    .nemo-mobile-enhanced .nemo-prompt-card-edit:active {
        opacity: 0.7;
    }
}

/* Landscape mobile - use horizontal space (optional) */
@media (orientation: landscape) and (max-height: 500px) {
    .nemo-mobile-enhanced .nemo-category-tray {
        max-height: 70vh;
    }

    .nemo-mobile-enhanced .nemo-tray-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        max-height: 45vh;
    }

    .nemo-mobile-enhanced .nemo-preview-container {
        max-height: 95vh;
        width: 90%;
    }

    .nemo-mobile-enhanced .nemo-preview-content {
        max-height: 50vh;
    }
}

/* ============================================
   MOBILE STYLES - Main Prompt List & Sections
   ============================================ */

@media (max-width: 768px) {
    /* Main section headers - readable names */
    .nemo-mobile-enhanced .nemo-extension .nemo-engine-section > summary {
        padding: 10px 8px;
        flex-wrap: wrap;
    }

    .nemo-mobile-enhanced .nemo-extension .nemo-engine-section > summary .completion_prompt_manager_prompt_name {
        flex: 1 1 auto;
        min-width: 0;
    }

    .nemo-mobile-enhanced .nemo-extension .nemo-engine-section > summary .completion_prompt_manager_prompt_name a {
        white-space: normal !important;
        word-break: break-word;
        font-size: 14px;
        line-height: 1.4;
        display: block;
    }

    /* Prompt items in list - readable names */
    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt {
        padding: 8px 6px;
        flex-wrap: wrap;
        gap: 6px;
    }

    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt .completion_prompt_manager_prompt_name {
        flex: 1 1 60%;
        min-width: 0;
    }

    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt .completion_prompt_manager_prompt_name a {
        white-space: normal !important;
        word-break: break-word;
        font-size: 13px;
        line-height: 1.3;
    }

    /* Controls stay visible but compact */
    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_controls {
        flex-shrink: 0;
        gap: 8px;
    }

    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_controls span {
        font-size: 16px;
        padding: 4px;
        min-width: 28px;
        min-height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Token count - smaller on mobile */
    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_tokens {
        font-size: 11px;
        flex-shrink: 0;
    }

    /* Drag handle - larger touch target */
    .nemo-mobile-enhanced .nemo-extension .drag-handle {
        padding: 8px;
        font-size: 16px;
    }

    /* Enabled count badge */
    .nemo-mobile-enhanced .nemo-extension .nemo-enabled-count {
        font-size: 12px;
    }

    /* Progress bar */
    .nemo-mobile-enhanced .nemo-extension .nemo-section-progress {
        height: 3px;
        margin-top: 4px;
        width: 100%;
    }

    /* Badges - wrap to new line if needed */
    .nemo-mobile-enhanced .nemo-extension .nemo-prompt-badge {
        font-size: 9px !important;
        padding: 2px 6px !important;
        margin-left: 0 !important;
        margin-top: 4px;
    }

    /* Tooltip indicators */
    .nemo-mobile-enhanced .nemo-extension .nemo-has-tooltip::after {
        font-size: 10px;
    }
}

@media (max-width: 480px) {
    /* Even more compact on phones */
    .nemo-mobile-enhanced .nemo-extension .nemo-engine-section > summary .completion_prompt_manager_prompt_name a {
        font-size: 13px;
    }

    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt {
        padding: 10px 6px;
    }

    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt .completion_prompt_manager_prompt_name a {
        font-size: 14px;
        line-height: 1.4;
    }

    /* Stack controls below name on very small screens */
    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt {
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_controls span {
        font-size: 18px;
        min-width: 32px;
        min-height: 32px;
    }

    /* Hide token count on very small screens to save space */
    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_tokens {
        display: none;
    }

    /* Section content padding */
    .nemo-mobile-enhanced .nemo-extension .nemo-section-content {
        padding-left: 8px;
    }
}

/* Touch devices - larger tap targets for prompts */
@media (pointer: coarse) {
    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt {
        min-height: 48px;
    }

    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_controls span {
        min-width: 36px;
        min-height: 36px;
    }

    .nemo-mobile-enhanced .nemo-extension .nemo-engine-section > summary {
        min-height: 44px;
    }

    /* Active state feedback */
    .nemo-mobile-enhanced .nemo-extension .completion_prompt_manager_prompt:active {
        background: rgba(74, 158, 255, 0.1);
    }

    .nemo-mobile-enhanced .nemo-extension .prompt_manager_prompt_controls span:active {
        opacity: 0.6;
        transform: scale(0.95);
    }
}

.nemo-extension .prompt_manager_prompt_controls { display: flex; align-items: center; gap: 6px; line-height: 1; }
.nemo-extension .nemo-section-master-toggle { font-size: 0.9em; padding: 2px 5px; min-width: auto; line-height: 1; background-color: var(--nemo-tertiary-bg); border: 1px solid var(--nemo-border-color); }
.nemo-section-master-toggle.nemo-active { background-color: var(--nemo-primary-accent); border-color: var(--nemo-primary-accent); }

/* --- Preset Selector --- */
.nemo-preset-selector-wrapper { display: flex; align-items: center; gap: 5px; }
.nemo-preset-selector-wrapper > .text_pole, .nemo-preset-selector-wrapper > select { flex-grow: 1; }

/* --- Search Bar & Snapshot Controls --- */
#nemoSearchAndStatusWrapper {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
    width: 100%;
}

#nemoPresetSearchContainer {
    display: flex !important;
    align-items: center !important;
    gap: 10px;
    flex-wrap: wrap !important;
    height: auto !important;
    justify-content: flex-end !important;
}

#nemoPresetSearchContainer .text_pole {
    flex-grow: 1;
    margin-right: 0;
    min-width: 200px;
    height: 36px;
}

.nemo-search-controls {
    display: flex;
    align-items: center;
    flex-shrink: 0;
    gap: 0.25em;
    flex-wrap: nowrap;
}

.nemo-search-controls .menu_button {
    min-width: 36px;
    min-height: 36px;
    padding: 8px;
    font-size: 0.9em;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.nemo-search-divider {
    width: 1px;
    height: 24px;
    background-color: var(--nemo-border-color);
    margin: 0 4px;
}
.nemo-search-controls .menu_button.nemo-active { color: var(--nemo-primary-accent); border-color: var(--nemo-primary-accent); box-shadow: 0 0 5px var(--nemo-glow-color); }

/* --- Snapshot Status Message --- */
.nemo-status-message { text-align: center; padding: 0 8px; margin-top: 0; border-radius: 4px; font-style: italic; font-size: 0.9em; opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.3s ease, max-height 0.3s ease, padding 0.3s ease, margin-top 0.3s ease; }
.nemo-status-message.visible { opacity: 1; max-height: 50px; padding: 8px; margin-top: 8px; }
.nemo-status-message.success { color: var(--green); background-color: var(--green10a); }
.nemo-status-message.info { color: var(--nemo-secondary-accent); background-color: var(--yellow10a); }
.nemo-status-message.error { color: var(--red); background-color: var(--red10a); }

/* --- Contextual Triggers --- */
.nemo-triggers-container { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--nemo-border-color); }
.nemo-triggers-settings { display: flex; gap: 15px; margin-top: 5px; flex-wrap: wrap; }

/* --- Reasoning Section (now uses SillyTavern built-in styling) --- */
/* Most styling is handled by SillyTavern's inline-drawer and range-block classes */
/* Only add minimal custom styling where needed */

#nemoReasoningSection {
    /* Inherits from inline-drawer wide100p nemo-converted-drawer classes */
}

/* Ensure proper spacing for reasoning controls in mobile */
#nemoReasoningSection .flex-container.alignItemsBaseline {
    gap: 10px;
}

#nemoReasoningSection .flex1 {
    flex: 1;
}

/* --- Start Reply With Block (in Chat Completion section) --- */
.nemo-start-reply-block { 
    margin-top: 15px; 
    padding: 10px; 
    background-color: var(--nemo-secondary-bg); 
    border: 1px solid var(--nemo-border-color); 
    border-radius: 4px; 
}

.nemo-start-reply-content { 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
}

.nemo-start-reply-header { 
    color: var(--nemo-secondary-accent); 
    font-weight: 500; 
}

.nemo-start-reply-textarea-container { 
    flex-grow: 1; 
}

.nemo-start-reply-textarea-container textarea { 
    width: 100%; 
    resize: vertical; 
    font-size: 14px; 
    border: 1px solid var(--nemo-border-color); 
    background-color: var(--nemo-primary-bg); 
    color: var(--nemo-text-color); 
    border-radius: 4px; 
    padding: 8px; 
}

.nemo-start-reply-textarea-container textarea:focus { 
    border-color: var(--nemo-primary-accent); 
    outline: none; 
    box-shadow: 0 0 0 2px var(--nemo-glow-color); 
}

.nemo-start-reply-checkbox { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    cursor: pointer; 
    color: var(--nemo-text-color); 
}

.nemo-start-reply-checkbox input[type="checkbox"] { 
    cursor: pointer; 
}

.nemo-start-reply-checkbox small { 
    cursor: pointer; 
    user-select: none; 
}

/* === PRESET NAVIGATOR (UNSTYLED - USES DEFAULT POPUP) === */
/* The outer modal styling has been removed to use the default SillyTavern popup style. */
/* We only style the *content* that we are injecting into the popup. */

.nemo-preset-navigator-content-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
    max-height: 80vh;
    overflow: hidden;
}

.nemo-preset-navigator-content-wrapper .navigator-body {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
    min-height: 0;
}

.nemo-preset-navigator-content-wrapper .navigator-main-panel {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    background-color: var(--nemo-secondary-bg);
    padding: 0;
    border-radius: 8px;
    min-width: 0;
    min-height: 0;
}

/* Grid Header & Search */
#navigator-grid-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px solid var(--nemo-border-color); flex-shrink: 0; gap: 20px; flex-wrap: wrap; }
#navigator-breadcrumbs { font-size: 1.1em; color: var(--nemo-text-color); flex-shrink: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#navigator-breadcrumbs .link { color: var(--nemo-secondary-accent); cursor: pointer; text-decoration: none; border-bottom: 1px dotted var(--nemo-secondary-accent); transition: color 0.2s; }
#navigator-breadcrumbs .link:hover { color: var(--nemo-text-color); }
#navigator-header-controls { display: flex; align-items: center; gap: 15px; flex-shrink: 0; }
#navigator-search-controls { display: flex; align-items: center; position: relative; }
#navigator-search-input { width: 220px; padding-right: 30px; }
#navigator-search-clear { position: absolute; right: 0; top: 0; bottom: 0; background: transparent; border: none; cursor: pointer; color: var(--nemo-text-muted); padding: 0 10px; }
#navigator-search-clear:hover { color: var(--nemo-text-color); }
.nemo-header-buttons { display: flex; gap: 5px; }

/* Main View Area */
@keyframes fadeInItems { from { transform: translateY(10px); } to { transform: translateY(0); } }
#navigator-grid-view.fade-in .grid-item, #navigator-grid-view.fade-in .list-item { animation: fadeInItems 0.4s ease-out both; }
#navigator-grid-view.fade-in .grid-item:nth-child(2), #navigator-grid-view.fade-in .list-item:nth-child(2) { animation-delay: 0.02s; }
#navigator-grid-view.fade-in .grid-item:nth-child(3), #navigator-grid-view.fade-in .list-item:nth-child(3) { animation-delay: 0.04s; }
#navigator-grid-view.fade-in .grid-item:nth-child(n+4) { animation-delay: 0.06s; }

#navigator-grid-view {
    overflow-y: auto;
    flex-grow: 1;
    padding: 10px;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    min-height: 0; /* Critical: allows flex child to shrink and scroll */
    height: 100%; /* Ensures scrollable area */
}

/* Enhanced empty state styling */
.navigator-empty-state {
    text-align: center;
    color: var(--nemo-text-medium-contrast, #e0e0e0);
    padding: 60px 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.navigator-empty-state .empty-state-icon {
    font-size: 4em;
    color: var(--nemo-text-low-contrast, #b0b0b0);
    opacity: 0.5;
}

.navigator-empty-state h3 {
    margin: 0;
    font-size: 1.5em;
    color: var(--nemo-text-high-contrast, #fff);
}

.navigator-empty-state p {
    margin: 0;
    color: var(--nemo-text-medium-contrast, #e0e0e0);
    max-width: 400px;
}

.navigator-empty-state .empty-state-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.navigator-empty-state .menu_button {
    min-height: 44px;
    padding: 12px 24px;
}

/* Grid View Mode */
.view-mode-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    align-content: flex-start;
    width: 100%;
    min-width: 0;
}

/* Preset Navigator specific grid sizing */
.nemo-preset-navigator-content-wrapper .view-mode-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
}

.nemo-preset-navigator-content-wrapper .grid-item {
    min-height: 160px;
    padding: 12px;
}

.nemo-preset-navigator-content-wrapper .grid-item .item-name {
    /* This rule is intentionally left specific to override any theme issues. */
    flex-grow: 1;
    padding: 8px;
    text-align: center;
    font-size: 0.9em;
    background-color: rgba(0,0,0,0.2);
    border-bottom-left-radius: 6px;
    border-bottom-right-radius: 6px;
    white-space: normal;
    word-break: break-word;
    line-height: 1.3;
    color: #ffffff !important;
    opacity: 1 !important;
    visibility: visible !important;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.8) !important;
    min-height: 3.6em;
}

.nemo-preset-navigator-content-wrapper .grid-item .item-icon {
    height: 100px;
    flex-shrink: 0;
    font-size: 2.5em;
    margin-bottom: 8px;
}

/* Prompt Navigator specific container and grid */
.nemo-prompt-navigator-content-wrapper .navigator-main-panel { 
    width: 100%; 
    min-width: 0; 
}

.nemo-prompt-navigator-content-wrapper #prompt-navigator-grid-view {
    padding: 10px;
    overflow-y: auto;
    flex-grow: 1;
    width: 100%;
    box-sizing: border-box;
    min-height: 0; /* Critical: allows flex child to shrink and scroll */
    height: 100%; /* Ensures scrollable area */
}

.nemo-prompt-navigator-content-wrapper .view-mode-grid { 
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
    gap: 12px; 
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

.nemo-prompt-navigator-content-wrapper .grid-item { 
    min-height: 140px; 
    width: 100%;
}

.nemo-prompt-navigator-content-wrapper .grid-item .item-icon { 
    height: 85px; 
    font-size: 2.8em; 
}

.nemo-prompt-navigator-content-wrapper .grid-item .item-name { 
    font-size: 0.85em; 
    padding: 6px; 
}

/* Prompt Navigator responsive breakpoints - using auto-fit for better width utilization */
@media (min-width: 1200px) {
    .nemo-prompt-navigator-content-wrapper .view-mode-grid { 
        grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); 
        gap: 10px; 
    }
}

@media (min-width: 1400px) {
    .nemo-prompt-navigator-content-wrapper .view-mode-grid { 
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
        gap: 10px; 
    }
}

@media (min-width: 1600px) {
    .nemo-prompt-navigator-content-wrapper .view-mode-grid { 
        grid-template-columns: repeat(auto-fit, minmax(95px, 1fr)); 
        gap: 8px; 
    }
}

/* For very wide screens, ensure better utilization */
@media (min-width: 1920px) {
    .nemo-prompt-navigator-content-wrapper .view-mode-grid { 
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); 
        gap: 8px; 
    }
}

/* Prompt Navigator Button Sizing */
.nemo-prompt-navigator-content-wrapper .menu_button {
    min-height: 40px;
    padding: 8px 12px;
    font-size: 1em;
    min-width: 40px;
}

.nemo-prompt-navigator-content-wrapper .nemo-header-buttons {
    gap: 8px;
}

.nemo-prompt-navigator-content-wrapper .nemo-header-buttons .menu_button {
    min-height: 42px;
    padding: 10px 14px;
    font-size: 1.05em;
}

.nemo-prompt-navigator-content-wrapper #prompt-navigator-search-clear {
    padding: 8px;
    font-size: 1em;
}

.nemo-prompt-navigator-content-wrapper #prompt-navigator-load-btn {
    padding: 12px 20px;
    font-size: 1.1em;
    font-weight: 500;
}

.nemo-prompt-navigator-content-wrapper #prompt-navigator-search-input {
    padding: 8px 40px 8px 12px;
    font-size: 1em;
}
.grid-item { min-height: 160px; background-color: var(--nemo-tertiary-bg); border-radius: 8px; border: 2px solid transparent; display: flex; flex-direction: column; cursor: pointer; transition: all 0.2s ease-in-out; user-select: none; position: relative; overflow: hidden; }
.grid-item:hover { transform: translateY(-4px); box-shadow: 0 6px 12px var(--nemo-shadow-color); border-color: var(--nemo-border-color); }
@keyframes pulse-glow { 0% { box-shadow: 0 0 5px var(--nemo-glow-color), 0 0 10px var(--nemo-glow-color); } 50% { box-shadow: 0 0 10px var(--nemo-glow-color), 0 0 20px var(--nemo-glow-color); } 100% { box-shadow: 0 0 5px var(--nemo-glow-color), 0 0 10px var(--nemo-glow-color); } }
.grid-item.selected { border-color: var(--nemo-primary-accent); background-color: var(--nemo-item-hover-bg); animation: pulse-glow 2s infinite ease-in-out; }
.grid-item .item-icon { height: 100px; width: 100%; flex-shrink: 0; display: flex; justify-content: center; align-items: center; font-size: 3.5em; color: var(--nemo-secondary-accent); border-top-left-radius: 6px; border-top-right-radius: 6px; background-size: cover; background-position: center; background-repeat: no-repeat; }
.grid-item.folder .item-icon { color: var(--nemo-folder-color); }
.grid-item.preset .item-icon { color: var(--nemo-secondary-accent); }
.grid-item .item-name { flex-grow: 1; padding: 8px; text-align: center; font-size: 0.9em; background-color: rgba(0,0,0,0.2); border-bottom-left-radius: 6px; border-bottom-right-radius: 6px; white-space: normal; word-break: break-word; line-height: 1.3; color: var(--text-primary); min-height: auto; }

/* List View Mode */
.view-mode-list { display: flex; flex-direction: column; gap: 5px; }
.list-item { min-height: auto; flex-direction: row; align-items: center; padding: 5px 10px; }
.list-item:hover { transform: none; box-shadow: none; background-color: var(--nemo-item-hover-bg); }
.list-item .item-icon { height: 40px; width: 40px; font-size: 1.2em; background-size: cover; background-position: center; background-repeat: no-repeat; border-radius: 4px; }
.list-item .item-name { background: none; text-align: left; flex-grow: 1; padding: 0 10px; white-space: normal; word-break: break-word; color: var(--nemo-text-high-contrast); }
.list-item .item-date { font-size: 0.9em; color: var(--nemo-text-muted); flex-shrink: 0; }

/* Item Menu Button (Three Dots) - WCAG 2.1 compliant touch targets */
.nemo-item-menu-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    z-index: var(--z-controls);
    background-color: rgba(0, 0, 0, 0.4);
    border: none;
    border-radius: 50%;
    /* WCAG 2.1 AAA minimum touch target: 44px × 44px */
    width: 44px;
    height: 44px;
    padding: 0;
    font-size: 1.1em;
    color: var(--nemo-text-color);
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s ease-in-out, background-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}
.grid-item:hover .nemo-item-menu-btn,
.list-item:hover .nemo-item-menu-btn,
.grid-item:focus-within .nemo-item-menu-btn,
.list-item:focus-within .nemo-item-menu-btn {
    opacity: 1;
}
.nemo-item-menu-btn:hover {
    background-color: rgba(0, 0, 0, 0.7);
}
.list-item .nemo-item-menu-btn {
    position: static;
    margin-left: auto;
    flex-shrink: 0;
}
@media (pointer: coarse), (max-width: 768px) {
    .grid-item .nemo-item-menu-btn,
    .list-item .nemo-item-menu-btn {
        opacity: 1;
        background-color: rgba(0, 0, 0, 0.3);
    }
}

/* Navigator Footer (inside popup) */
.nemo-preset-navigator-content-wrapper .modal-footer { border-top: 1px solid var(--nemo-border-color); padding-top: 15px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
.nemo-preset-navigator-content-wrapper .modal-footer .action-controls { display: flex; gap: 10px; align-items: center; }

/* Drag, Drop, and Selection Styles */
/* Enhanced drag-drop visual feedback */
.grid-item.dragging-source {
    opacity: 0.4;
    transform: scale(0.95);
    transition: opacity 0.2s, transform 0.2s;
}

.grid-item.dragging {
    position: fixed;
    z-index: var(--z-drag);
    pointer-events: none;
    opacity: 0.9;
    transform: rotate(2deg);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    cursor: grabbing !important;
}

.grid-item.folder.drag-over {
    border: 3px dashed var(--nemo-primary-accent);
    background-color: var(--nemo-item-hover-bg);
    transform: scale(1.08);
    box-shadow: 0 0 20px var(--SmartThemeQuoteColor, #4a9eff);
    animation: nemo-pulse-glow 1s ease-in-out infinite;
}

@keyframes nemo-pulse-glow {
    0%, 100% { box-shadow: 0 0 15px var(--SmartThemeQuoteColor, #4a9eff); }
    50% { box-shadow: 0 0 30px var(--SmartThemeQuoteColor, #4a9eff); }
}

.grid-item.bulk-selected {
    outline: 2px solid var(--nemo-primary-accent);
    outline-offset: 2px;
    background-color: var(--nemo-item-hover-bg);
}

/* Context Menu & Color Picker */
.nemo-context-menu { display: none; position: absolute; background-color: var(--nemo-primary-bg); border: 1px solid var(--nemo-border-color); z-index: var(--z-context-menu); list-style: none; padding: 5px 0; margin: 0; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
.nemo-extension .nemo-context-menu li { padding: 8px 12px; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 8px; }
.nemo-context-menu li:hover { background-color: var(--nemo-item-hover-bg); }
.nemo-context-menu li.active { background-color: var(--nemo-primary-accent); color: var(--nemo-text-color); }
.nemo-context-menu i { width: 1em; text-align: center; }

.nemo-color-picker-popup {
    padding: 10px;
    position: relative;
    z-index: 10003; /* Higher than other modals to appear on top */
}
.nemo-color-picker-popup h4 { margin-top: 0; margin-bottom: 15px; text-align: center; color: var(--nemo-secondary-accent); }
.nemo-color-swatches { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; justify-content: center; }
.nemo-color-swatch { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid var(--nemo-border-color); transition: transform 0.1s ease, box-shadow 0.1s ease; }
.nemo-color-swatch:hover { transform: scale(1.1); box-shadow: 0 0 5px var(--nemo-glow-color); }
.nemo-color-swatch.selected { border-color: var(--nemo-primary-accent); transform: scale(1.1); box-shadow: 0 0 8px var(--nemo-glow-color); }
#nemo-clear-folder-color { display: block; margin: 10px auto 0; }

/* === MOBILE RESPONSIVENESS IMPROVEMENTS === */

/* Large tablets and small desktops */
@media (max-width: 1024px) {
    :root {
        --wi-left-panel-width: 250px;
        --wi-toggle-offset: 230px;
    }
    .nemo-world-info-left-column { width: var(--wi-left-panel-width); }
    #navigator-search-input, #char-manager-search-input { width: 180px; }
    .view-mode-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; }
}

/* Small tablets */
@media (max-width: 768px) {
    /* Navigator and Grid Headers */
    #navigator-grid-header, #char-manager-grid-header { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 10px; 
    }
    
    /* Search controls */
    #navigator-header-controls, #char-manager-header-controls { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 10px; 
    }
    
    #navigator-search-controls, #char-manager-search-controls { 
        order: -1; /* Move search to top */
    }
    
    #navigator-search-input, #char-manager-search-input { 
        width: 100%; 
    }
    
    /* Button groups */
    .nemo-header-buttons { 
        justify-content: center; 
        flex-wrap: wrap; 
    }
    
    /* Grid layout improvements */
    .view-mode-grid { 
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); 
        gap: 10px; 
    }
    
    .grid-item { 
        min-height: 140px; 
    }
    
    .grid-item .item-icon { 
        height: 80px; 
        font-size: 3em; 
    }
    
    .grid-item .item-name {
        font-size: 0.8em;
        padding: 5px;
        color: #ffffff !important;
        opacity: 1 !important;
        visibility: visible !important;
        text-shadow: 0 0 2px rgba(0, 0, 0, 0.8) !important;
    }
    
    /* Modal footer */
    .nemo-preset-navigator-content-wrapper .modal-footer,
    .nemo-character-manager-content-wrapper .modal-footer { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 10px; 
    }
    
    /* World Info specific improvements */
    .nemo-world-info-container { 
        flex-direction: column; 
    }
    
    .nemo-world-info-left-column { 
        width: 100%; 
        max-height: 300px; 
        border-right: none; 
        border-bottom: 1px solid var(--nemo-border-color); 
    }
    
    .nemo-world-info-list-header { 
        flex-wrap: wrap; 
        gap: 5px; 
    }
    
    .nemo-world-info-list-header > input { 
        flex-basis: 100%; 
        margin-bottom: 5px; 
    }
    
    /* Preset controls */
    .nemo-world-info-preset-controls { 
        flex-wrap: wrap; 
    }
    
    .nemo-world-info-preset-controls > select { 
        flex-basis: 100%; 
        margin-bottom: 5px; 
    }
    
    /* Entries header */
    .nemo-world-info-entries-header { 
        flex-wrap: wrap; 
        gap: 3px; 
    }
    
    .nemo-world-info-entries-header > input,
    .nemo-world-info-entries-header > select { 
        flex-basis: 100%; 
        margin-bottom: 5px; 
    }
    
    /* Pagination controls */
    .nemo-pagination-controls { 
        flex-wrap: wrap; 
        gap: 5px; 
    }
    
    .pagination-info { 
        order: -1; 
        flex-basis: 100%; 
        text-align: center; 
        padding: 5px 0; 
    }
}

/* Mobile phones */
@media (max-width: 480px) {
    /* Even smaller grid items */
    .view-mode-grid { 
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); 
        gap: 8px; 
    }
    
    .grid-item { 
        min-height: 120px; 
    }
    
    .grid-item .item-icon { 
        height: 70px; 
        font-size: 2.5em; 
    }
    
    .grid-item .item-name {
        font-size: 0.75em;
        padding: 4px;
        color: #ffffff !important;
        opacity: 1 !important;
        visibility: visible !important;
        text-shadow: 0 0 2px rgba(0, 0, 0, 0.8) !important;
    }
    
    /* Stack all controls vertically */
    .nemo-search-controls,
    .nemo-header-buttons {
        justify-content: center;
    }
    
    /* World Info specific mobile improvements */
    .nemo-world-info-left-column { 
        max-height: 250px; 
    }
    
    .nemo-world-info-tabs { 
        flex-wrap: wrap; 
    }
    
    .nemo-world-info-tab { 
        flex: 1; 
        text-align: center; 
        min-width: 80px; 
        padding: 8px 5px; 
        font-size: 0.9em; 
    }
    
    
    /* Improve touch targets */
    .nemo-item-menu-btn { 
        opacity: 1; /* Always visible on mobile */
    }
    
    /* Pagination improvements */
    .pagination-btn { 
    }
    
    .pagination-goto { 
        font-size: 16px; /* Prevent zoom on iOS */
    }
    
    /* Preset search mobile improvements */
    #nemoPresetSearchContainer {
        flex-direction: row !important;
        width: 100% !important;
        max-width: 100% !important;
    }
    
    #nemoPresetSearchContainer .text_pole { 
        min-width: unset; 
        width: 100%; 
    }
    
    .nemo-search-controls { 
        justify-content: center; 
    }
    
    /* Context menu mobile improvements */
    .nemo-context-menu { 
        min-width: 160px; 
        font-size: 16px; /* Prevent zoom on iOS */
    }
    
    .nemo-context-menu li { 
        padding: 12px 16px; /* Larger touch targets */
        display: flex !important; 
        align-items: center; 
    }
    
    /* Triggers settings mobile */
    .nemo-triggers-settings { 
        flex-direction: column; 
        align-items: stretch; 
    }
    
    /* Preset selector mobile */
    .nemo-preset-selector-wrapper { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 8px; 
    }
    
    /* Reasoning section mobile */
    #nemoReasoningSection .flex-container.alignItemsBaseline { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 8px; 
    }
    
    #nemoReasoningSection .oneline-dropdown { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 5px; 
    }
    
    #nemoReasoningSection .oneline-dropdown label { 
        min-width: unset; 
    }
    
    #nemoReasoningSection select, 
    #nemoReasoningSection input[type="number"], 
    #nemoReasoningSection textarea { 
        font-size: 16px; /* Prevent zoom on iOS */
    }
    
    #nemoReasoningSection .inline-drawer .flex-container { 
        flex-direction: column; 
        gap: 8px; 
    }
    
    /* Start Reply With mobile */
    .nemo-start-reply-block { 
        margin-top: 8px; 
        padding: 8px; 
    }
    
    .nemo-start-reply-content { 
        gap: 6px; 
    }
    
    .nemo-start-reply-textarea-container textarea { 
        font-size: 16px; /* Prevent zoom on iOS */
    }
}

/* Extra small screens */
@media (max-width: 320px) {
    .view-mode-grid { 
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); 
        gap: 5px; 
    }
    
    .grid-item { 
        min-height: 100px; 
    }
    
    .grid-item .item-icon { 
        height: 60px; 
        font-size: 2em; 
    }
    
    .nemo-world-info-tab { 
        font-size: 0.8em; 
        padding: 6px 3px; 
    }
    
    
    .nemo-search-divider { 
        display: none; /* Hide dividers on very small screens */
    }
}

/* Portrait orientation specific adjustments */
@media (orientation: portrait) and (max-width: 768px) {
    .nemo-world-info-left-column { 
        max-height: 250px; 
        overflow-y: auto; 
    }
    
    .navigator-body { 
        min-height: 70vh; 
    }
}

/* Landscape orientation specific adjustments */
@media (orientation: landscape) and (max-height: 500px) {
    :root {
        --wi-left-panel-width: 200px;
        --wi-toggle-offset: 180px;
    }

    .nemo-world-info-container {
        flex-direction: row;
    }

    .nemo-world-info-left-column {
        width: var(--wi-left-panel-width);
        max-height: none;
        border-right: 1px solid var(--nemo-border-color);
        border-bottom: none;
    }
    
    .navigator-body { 
        min-height: 60vh; 
    }
}

/* === GENERAL MOBILE TOUCH IMPROVEMENTS === */
/* Apply to all mobile devices regardless of screen size */
@media (pointer: coarse) {
    /* Ensure all input fields have proper font size for iOS */
    input[type="text"], 
    input[type="search"], 
    input[type="number"], 
    textarea, 
    select { 
        font-size: 16px !important; 
    }
    
    /* Improve tap targets for all interactive elements */
    .menu_button, 
    button, 
    .inline-drawer-toggle, 
    .completion_prompt_manager_prompt_controls > *, 
    .nemo-section-master-toggle { 
    }
    
    /* Improve checkbox and radio button tap targets */
    input[type="checkbox"], 
    input[type="radio"] { 
        min-width: 20px; 
        min-height: 20px; 
        transform: scale(1.2); 
    }
    
    /* Better touch scrolling */
    .nemo-world-info-list, 
    #navigator-grid-view, 
    #char-manager-grid-view, 
    .nemo-panel-content-wrapper { 
        -webkit-overflow-scrolling: touch; 
        overscroll-behavior: contain; 
    }
    
    /* Improve drag handle visibility and size */
    .drag-handle, 
    .nemo-drag-handle { 
        display: flex; 
        align-items: center; 
        justify-content: center; 
    }
}

/* Header items in the prompt list are not draggable */
.nemo-header-item { cursor: default; }

/* Drag and Drop for Prompt List */
.drag-handle {
    cursor: grab;
    padding: 0 10px;
    margin-left: -10px; /* Keep alignment neat */
    font-size: 1.2em;
    color: var(--nemo-text-muted);
    position: relative; /* Ensure it's on top */
    z-index: var(--z-base);
}

.drag-handle:hover {
    color: var(--nemo-text-color);
}

.drag-handle:active {
    cursor: grabbing;
}

li.completion_prompt_manager_prompt[draggable="true"] {
    cursor: default;
} /* Remove grab cursor from the whole item */

li.completion_prompt_manager_prompt.nemo-dragging {
    opacity: 0.5;
    cursor: grabbing;
}

#nemo-drop-indicator {
    position: absolute;
    height: 2px;
    background-color: var(--nemo-primary-accent);
    width: 100%;
    pointer-events: none;
    z-index: var(--z-controls);
    box-shadow: 0 0 5px var(--nemo-glow-color);
    display: none;
}

/* Prevent dropping into summary/header elements */
.nemo-engine-section summary {
    position: relative;
}

/* Make summary a non-droppable zone using pseudo-element overlay during drag */
.sortable-fallback ~ .nemo-engine-section summary::before,
body.sortable-dragging .nemo-engine-section summary::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: var(--z-sidebar);
    pointer-events: auto;
    background: transparent;
}

/* Ensure header item inside summary is not a valid drop container */
.nemo-engine-section summary .nemo-header-item {
    pointer-events: none;
}

.nemo-engine-section summary .nemo-header-item * {
    pointer-events: auto; /* Re-enable for buttons/controls */
}

/* Visual feedback for invalid drop zones */
.nemo-engine-section summary.sortable-over {
    background: rgba(255, 107, 107, 0.2) !important;
    border-left-color: var(--nemo-error) !important;
}

/* Improve dragging visual feedback */
.sortable-ghost {
    opacity: 0.4 !important;
    background-color: rgba(74, 158, 255, 0.3) !important;
    border: 2px dashed var(--nemo-info) !important;
}

.sortable-drag {
    opacity: 1 !important;
    box-shadow: var(--nemo-shadow-xl) !important;
}

/* Ensure section content areas are valid drop zones */
.nemo-section-content {
    min-height: 40px; /* Ensure there's always a drop zone even if empty */
    position: relative;
}

.nemo-sub-section > .nemo-section-content {
    min-height: 0; /* Remove min-height for sub-sections to reduce spacing */
}

/* === NEMO CHARACTER MANAGER ENHANCEMENTS === */
/* All styles removed as the button is now injected into the standard button bar. */

/* === NEMO GLOBAL UI TWEAKS === */
@keyframes nemo-pulsing-stop-animation { 0% { box-shadow: 0 0 0 0px var(--nemo-glow-color); border-color: var(--nemo-border-color); } 50% { box-shadow: 0 0 10px 4px var(--nemo-glow-color); border-color: var(--nemo-primary-accent); } 100% { box-shadow: 0 0 0 0px var(--nemo-glow-color); border-color: var(--nemo-border-color); } }
#send_form_stop_button.nemo-generating-animation { border: 2px solid var(--nemo-border-color) !important; border-radius: 50%; animation: nemo-pulsing-stop-animation 1.5s infinite ease-in-out; }

.inline-drawer.nemo-converted-drawer .inline-drawer-header { background-color: var(--nemo-tertiary-bg); padding: 8px 10px; margin-bottom: 5px; border-radius: 4px; }
.inline-drawer.nemo-converted-drawer .inline-drawer-header b { color: var(--nemo-secondary-accent); }
.inline-drawer.nemo-converted-drawer .inline-drawer-content { padding: 0 10px 10px 20px; border-left: 2px solid var(--nemo-border-color); margin-left: 5px; }

/* Styles for the new standalone prompt header */
.nemo-standalone-prompt-header {
    background-color: var(--nemo-tertiary-bg);
    padding: 8px 10px;
    margin-top: 15px; /* Add some space above the header */
    margin-bottom: 5px;
    border-radius: 4px;
    color: var(--nemo-secondary-accent);
    font-weight: bold;
}

/* === CHARACTER MANAGER (Pop-out) === */
.nemo-character-manager-content-wrapper .navigator-body { display: flex; flex-grow: 1; overflow: hidden; min-height: 60vh; }
.nemo-character-manager-content-wrapper .navigator-main-panel { flex-grow: 1; display: flex; flex-direction: column; background-color: var(--nemo-secondary-bg); padding: 15px; border-radius: 8px; }

/* Grid Header & Search */
#char-manager-grid-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px solid var(--nemo-border-color); flex-shrink: 0; gap: 20px; flex-wrap: wrap; }
#char-manager-breadcrumbs { font-size: 1.1em; color: var(--nemo-text-color); flex-shrink: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#char-manager-breadcrumbs .link { color: var(--nemo-secondary-accent); cursor: pointer; text-decoration: none; border-bottom: 1px dotted var(--nemo-secondary-accent); transition: color 0.2s; }
#char-manager-breadcrumbs .link:hover { color: var(--nemo-text-color); }
#char-manager-header-controls { display: flex; align-items: center; gap: 15px; flex-shrink: 0; }
#char-manager-search-controls { display: flex; align-items: center; position: relative; }
#char-manager-search-input { width: 220px; padding-right: 30px; }
#char-manager-search-clear { position: absolute; right: 0; top: 0; bottom: 0; background: transparent; border: none; cursor: pointer; color: var(--nemo-text-muted); padding: 0 10px; }
#char-manager-search-clear:hover { color: var(--nemo-text-color); }

/* Main View Area */
#char-manager-grid-view {
    overflow-y: auto;
    flex-grow: 1;
    padding: 10px;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    min-height: 0; /* Critical: allows flex child to shrink and scroll */
    height: 100%; /* Ensures scrollable area */
}
.char-manager-empty-state { text-align: center; color: var(--nemo-text-muted); padding: 40px; }
.char-manager-empty-state h3 { margin: 0 0 10px; }
.char-manager-empty-state p { margin: 0; }

/* Grid View Mode */
.view-mode-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 20px;
    align-content: flex-start;
    width: 100%;
    min-width: 0;
}
.grid-item .item-icon {
    height: 100px;
    width: 100%;
    flex-shrink: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3.5em;
    color: var(--nemo-secondary-accent);
    border-top-left-radius: 6px;
    border-top-right-radius: 6px;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}
.grid-item.folder .item-icon { color: var(--nemo-folder-color); }
.grid-item.character .item-icon { color: var(--nemo-secondary-accent); }

/* List View Mode */
.view-mode-list { display: flex; flex-direction: column; gap: 5px; }
.list-item { min-height: auto; flex-direction: row; align-items: center; padding: 5px 10px; }
.list-item:hover { transform: none; box-shadow: none; background-color: var(--nemo-item-hover-bg); }
.list-item .item-icon { height: 40px; width: 40px; font-size: 1.2em; background-size: cover; background-position: center; background-repeat: no-repeat; border-radius: 4px; }
.list-item .item-name { background: none; text-align: left; flex-grow: 1; padding: 0 10px; white-space: normal; word-break: break-word; color: var(--nemo-text-high-contrast); }
.list-item .item-date { font-size: 0.9em; color: var(--nemo-text-muted); flex-shrink: 0; }

/* Item Menu Button (Three Dots) */
.nemo-item-menu-btn { position: absolute; top: 4px; right: 4px; z-index: var(--z-controls); background-color: rgba(0, 0, 0, 0.4); border: none; border-radius: 50%; width: 28px; height: 28px; padding: 0; font-size: 1em; color: var(--nemo-text-color); cursor: pointer; opacity: 0; transition: opacity 0.2s ease-in-out, background-color 0.2s; display: flex; align-items: center; justify-content: center; }
.grid-item:hover .nemo-item-menu-btn, .list-item:hover .nemo-item-menu-btn, .grid-item:focus-within .nemo-item-menu-btn, .list-item:focus-within .nemo-item-menu-btn { opacity: 1; }
.nemo-item-menu-btn:hover { background-color: rgba(0, 0, 0, 0.7); }
.list-item .nemo-item-menu-btn { position: static; margin-left: auto; flex-shrink: 0; }

/* Footer */
.nemo-character-manager-content-wrapper .modal-footer { border-top: 1px solid var(--nemo-border-color); padding-top: 15px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
.nemo-character-manager-content-wrapper .modal-footer .action-controls { display: flex; gap: 10px; align-items: center; }

/* Drag, Drop, and Selection Styles */
.grid-item.dragging-source { opacity: 0.4; transform: scale(0.95); }
.grid-item.folder.drag-over { border: 2px dashed var(--nemo-primary-accent); background-color: var(--nemo-item-hover-bg); transform: scale(1.05); }
.grid-item.bulk-selected { outline: 2px solid var(--nemo-primary-accent); outline-offset: 2px; background-color: var(--nemo-item-hover-bg); }

/* === EXTENSION SORTING STYLES === */
.nemo-sortable-ghost { opacity: 0.4; background-color: var(--nemo-item-hover-bg); border: 1px dashed var(--nemo-primary-accent); }
.nemo-sortable-drag { opacity: 0.9; background-color: var(--nemo-tertiary-bg); box-shadow: 0 5px 15px var(--nemo-shadow-color); }
#extensions_settings .inline-drawer-header, #extensions_settings2 .inline-drawer-header { cursor: grab; }
#extensions_settings .inline-drawer-header:active, #extensions_settings2 .inline-drawer-header:active { cursor: grabbing; }

/* === GROUPING STYLES === */
.nemo-group-container { padding: 5px; background-color: rgba(0,0,0,0.2); border-radius: 5px; margin-bottom: 10px; }
.nemo-group-header { display: flex; justify-content: space-between; align-items: center; padding: 8px; background-color: var(--nemo-tertiary-bg); border-radius: 4px; }
.nemo-group-title { font-weight: bold; color: var(--nemo-secondary-accent); }
.nemo-group-controls { display: flex; gap: 10px; }
.nemo-group-controls i { cursor: pointer; }
.nemo-group-content { min-height: 20px; padding: 10px 5px 5px; }
#nemo-add-group-button { margin-left: auto; }
.nemo-hidden-by-script {
    display: none !important;
}

/* === NEMO WORLD INFO UI === */
/* CSS Variables for maintainability */
:root {
    --wi-left-panel-width: 300px;
    --wi-toggle-offset: 280px;
    /* UI chrome height: header (~60px) + tabs (~50px) + padding (~40px) + margins (~50px) = ~200px */
    --wi-ui-chrome-height: 200px;
}

.nemo-world-info-container {
    display: flex;
    height: 100vh;
    width: 100%;
    background-color: var(--nemo-secondary-bg);
    color: var(--nemo-text-color);
    position: relative;
    overflow: hidden;
    overscroll-behavior: contain;
}

.nemo-world-info-left-column {
    width: var(--wi-left-panel-width);
    border-right: 1px solid var(--nemo-border-color);
    display: flex;
    flex-direction: column;
    transition: width 0.3s ease, margin-left 0.3s ease;
    height: 100vh;
    overflow: hidden;
}

/* Hidden left panel state */
.nemo-world-info-container.left-panel-hidden .nemo-world-info-left-column {
    width: 0;
    min-width: 0;
    margin-left: calc(var(--wi-left-panel-width) * -1);
    overflow: hidden;
}

.nemo-world-info-container.left-panel-hidden .nemo-world-info-right-column {
    left: 30px;
}

/* Mobile header for close button */
.nemo-world-info-mobile-header {
    display: none;
    justify-content: flex-end;
    padding: 10px;
    border-bottom: 1px solid var(--nemo-border-color);
}

#nemo-world-info-close-left-panel {
    background: var(--SmartThemeBodyColor);
    border: 1px solid var(--SmartThemeBorderColor);
    color: var(--SmartThemeQuoteColor);
}

.nemo-world-info-list-header {
    padding: 10px;
    border-bottom: 1px solid var(--nemo-border-color);
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

.nemo-world-info-list-header > input {
    flex-basis: 100%;
}

.nemo-folder-header {
    display: flex;
    align-items: center;
    padding: 10px;
    cursor: pointer;
    background-color: var(--black10a, rgba(0, 0, 0, 0.15));
    font-weight: bold;
    position: relative;
    border: 1px solid var(--nemo-border-color);
    border-left: 3px solid var(--nemo-primary-accent, #6eb5ff);
    margin-top: -1px; /* Collapse borders */
    user-select: none; /* Prevent text selection when clicking to expand/collapse */
}

.nemo-delete-folder-button {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 1.2em;
    display: none; /* Hidden by default */
}

.nemo-folder-header:hover .nemo-delete-folder-button {
    display: block; /* Show on hover */
}

.sortable-drag .nemo-folder-header {
    background-color: var(--nemo-primary-accent-light);
}

.nemo-folder-header:hover {
    background-color: var(--nemo-hover-bg);
}

.nemo-folder-toggle {
    margin-right: 8px;
    transition: transform 0.2s;
}

/* World Info folder content - scoped to avoid conflicts with other folder UIs */
.nemo-world-info-list .nemo-folder-content {
    padding-left: 20px;
    /* Initially hidden, shown on toggle */
    display: none;
    min-height: 20px; /* Ensure a drop area even when empty */
    flex-direction: column; /* Stack items vertically */
}

.nemo-world-info-list .nemo-folder.open > .nemo-folder-header > .nemo-folder-toggle {
    transform: rotate(90deg);
}

.nemo-world-info-list .nemo-folder.open > .nemo-folder-content {
    display: flex;
    flex-direction: column;
}

/* Empty folder visual indicator */
.nemo-world-info-list .nemo-folder.open > .nemo-folder-content:empty::after {
    content: 'Drop lorebooks here';
    display: block;
    text-align: center;
    color: var(--nemo-text-color-secondary, #888);
    font-style: italic;
    font-size: 0.9em;
    padding: 10px;
    opacity: 0.7;
}

/* Unassigned lorebooks container styling for better visual hierarchy */
#nemo-unassigned-lorebooks-container {
    margin-top: 10px;
    border-top: 1px solid var(--nemo-border-color);
    padding-top: 5px;
}

/* Add subtle indicator for unassigned section when it's not empty */
#nemo-unassigned-lorebooks-container:not(:empty)::before {
    content: 'Unassigned Lorebooks';
    display: block;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--nemo-text-color-secondary, #888);
    padding: 5px 10px;
    font-weight: 600;
    opacity: 0.8;
}

.nemo-world-info-active-section {
    padding: 15px 10px;
    border-bottom: 1px solid var(--nemo-border-color);
    background: var(--black10a, rgba(0, 0, 0, 0.1));
}

.nemo-world-info-active-header {
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--nemo-text-high-contrast, #fff);
}

.nemo-world-info-active-list {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

.nemo-world-info-preset-section {
    padding: 15px 10px;
    border-bottom: 1px solid var(--nemo-border-color);
    background: var(--black10a, rgba(0, 0, 0, 0.1));
}

.nemo-world-info-preset-header {
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--nemo-text-high-contrast, #fff);
}

.nemo-world-info-preset-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    align-items: center;
}

.nemo-world-info-preset-controls > select {
    flex-grow: 1;
    min-width: 120px;
    margin-bottom: 5px;
}

.nemo-active-lorebook-item {
    background-color: var(--nemo-primary-accent);
    color: var(--nemo-text-color);
    padding: 5px 10px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    white-space: normal;
    word-break: break-word; /* Break at word boundaries, not mid-word */
    max-width: 100%;
}

.nemo-remove-lorebook-button {
    margin-left: 10px;
    cursor: pointer;
}

.nemo-lorebook-item {
    padding: 10px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid var(--nemo-border-color);
    margin-top: -1px; /* Collapse borders */
    background-color: var(--nemo-bg-color);
    transition: background-color 0.2s ease;
}

/* Lorebooks inside folders have subtle visual distinction */
.nemo-folder-content > .nemo-lorebook-item {
    background-color: var(--black5a, rgba(0, 0, 0, 0.05));
}

.nemo-lorebook-item:hover {
    background-color: var(--nemo-hover-bg, rgba(255, 255, 255, 0.05));
}

.nemo-drag-handle {
    cursor: grab;
    margin-right: 10px;
    font-size: 1.2em;
    display: none; /* Hidden by default */
}

/* Show drag handle on hover or in move mode for better discoverability */
.nemo-lorebook-item:hover .nemo-drag-handle,
.nemo-move-mode .nemo-drag-handle {
    display: block; /* Visible on hover or in move mode */
}

.nemo-move-toggle-container {
    display: flex;
    align-items: center;
    gap: 5px;
}

.sortable-ghost {
    opacity: 0.4;
    background-color: var(--nemo-primary-accent);
}

.nemo-lorebook-item-text {
    white-space: normal;
    word-break: break-word;
    margin-right: 10px;
}

.nemo-lorebook-item:hover {
    background-color: var(--nemo-hover-bg);
}

.nemo-add-lorebook-button {
    font-size: 1.2em;
    font-weight: bold;
}

.nemo-world-info-list {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    max-height: calc(100vh - var(--wi-ui-chrome-height));
    scroll-behavior: smooth;
}

.nemo-world-info-right-column {
    position: absolute;
    top: 0;
    left: var(--wi-left-panel-width);
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    transition: left 0.3s ease;
    overflow: hidden;
}

/* Header controls no longer needed - button is now fixed positioned */

/* Use higher specificity instead of !important */
.nemo-extension #nemo-world-info-toggle-left-panel {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-left: none;
    color: white;
    transition: all 0.2s ease;
    font-weight: bold;
    width: 24px;
    height: 100%;
    border-radius: 0 4px 4px 0;
    position: fixed;
    top: 0;
    left: var(--wi-toggle-offset);
    z-index: var(--z-panel-toggle);
    opacity: 0.9;
    display: flex;
    align-items: center;
    justify-content: center;
    visibility: visible;
    writing-mode: vertical-rl;
    text-orientation: mixed;
}

.nemo-extension #nemo-world-info-toggle-left-panel:hover {
    opacity: 1;
    color: var(--SmartThemeEmColor, #4CAF50);
}

#nemo-world-info-toggle-left-panel:active {
    transform: scale(0.95);
}

/* Visual state when panel is hidden - peek from left edge without covering content */
.nemo-extension .nemo-world-info-container.left-panel-hidden #nemo-world-info-toggle-left-panel {
    left: 0;
    width: 16px;
    color: white;
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-left: none;
    opacity: 0.6;
    border-radius: 0 4px 4px 0;
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
    font-size: 11px;
}

.nemo-extension .nemo-world-info-container.left-panel-hidden #nemo-world-info-toggle-left-panel:hover {
    opacity: 1;
    width: 24px;
    color: #ffffff;
    background: rgba(0, 0, 0, 0.8);
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
    box-shadow: 2px 0 12px rgba(74, 158, 255, 0.3);
}

/* When panel is visible, position button on the panel edge with subtle styling */
.nemo-extension .nemo-world-info-container:not(.left-panel-hidden) #nemo-world-info-toggle-left-panel {
    left: var(--wi-toggle-offset);
    opacity: 0.7;
    background: rgba(0, 0, 0, 0.3);
    border-right: 1px solid rgba(255, 255, 255, 0.2);
}

.nemo-extension .nemo-world-info-container:not(.left-panel-hidden) #nemo-world-info-toggle-left-panel:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.5);
    border-right-color: var(--SmartThemeQuoteColor, #4a9eff);
}

.nemo-world-info-tabs {
    display: flex;
    border-bottom: 1px solid var(--nemo-border-color);
}

.nemo-world-info-tab {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
}

.nemo-world-info-tab.active {
    border-bottom-color: var(--nemo-primary-accent);
    color: var(--nemo-primary-accent);
}

.nemo-world-info-panel {
    display: none;
    flex-grow: 1;
    overflow: hidden; /* Let the inner wrapper handle scrolling */
    height: 100%;
}

.nemo-panel-content-wrapper {
    padding: 15px;
    height: 100%;
    overflow: auto;
    box-sizing: border-box;
    position: relative; /* Ensure proper positioning for child elements */
    scroll-behavior: smooth;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
}

.nemo-world-info-panel.active {
    display: block;
}

#world_popup_entries_list {
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    max-height: calc(100vh - var(--wi-ui-chrome-height));
    scroll-behavior: smooth;
}


.nemo-world-info-entries-header {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 10px;
}

.pagination-container {
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nemo-world-info-entries-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 10px;
}

.nemo-lorebook-item.selected {
    background-color: var(--nemo-primary-accent-light);
    border-color: var(--nemo-primary-accent);
}

#nemo-wi-context-menu {
    position: fixed;
    background-color: var(--nemo-bg-color);
    border: 1px solid var(--nemo-border-color);
    border-radius: 5px;
    padding: 5px;
    z-index: var(--z-popup);
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.nemo-context-menu-item {
    padding: 8px 12px;
    cursor: pointer;
    position: relative;
}

.nemo-context-menu-item:hover {
    background-color: var(--nemo-hover-bg);
}

.nemo-context-menu-item:hover .nemo-context-submenu {
    display: block;
}

.nemo-context-submenu {
    display: none;
    position: absolute;
    left: 100%;
    top: -5px; /* Align with parent item */
    background-color: var(--nemo-bg-color);
    border: 1px solid var(--nemo-border-color);
    border-radius: 5px;
    padding: 5px;
    min-width: 150px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.nemo-context-submenu-item {
    padding: 8px 12px;
    cursor: pointer;
}

.nemo-context-submenu-item:hover {
    background-color: var(--nemo-hover-bg);
}

.nemo-context-submenu-item.disabled {
    color: var(--nemo-text-color-secondary);
    cursor: default;
}

/* === ACCESSIBILITY IMPROVEMENTS === */
/* Focus indicators for keyboard navigation */
.nemo-lorebook-item:focus-visible,
.nemo-folder-header:focus-visible,
.nemo-world-info-tab:focus-visible,
button:focus-visible,
input:focus-visible,
select:focus-visible {
    outline: 2px solid var(--nemo-primary-accent, #6eb5ff);
    outline-offset: 2px;
}

.nemo-context-menu-item:focus-visible,
.nemo-context-submenu-item:focus-visible {
    outline: 2px solid var(--nemo-primary-accent, #6eb5ff);
    outline-offset: -2px;
    background-color: var(--nemo-hover-bg);
}

/* Ensure sufficient contrast for disabled items */
button:disabled,
input:disabled,
select:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Improve touch targets on mobile */
@media (max-width: 768px) {
    .nemo-world-info-tab {
        min-height: 44px; /* WCAG minimum touch target */
        padding: 10px 8px;
    }

    button {
        min-height: 44px;
        min-width: 44px;
    }
}

.nemo-world-info-order-helper-header {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
    margin-bottom: 15px;
}

.nemo-world-info-order-helper-header label {
    display: flex;
    align-items: center;
    gap: 5px;
}

.nemo-world-info-order-helper-header input[type="number"] {
    width: 80px;
    color: var(--nemo-text-color);
    background-color: var(--nemo-primary-bg);
    border: 1px solid var(--nemo-border-color);
}

#nemo-world-info-order-helper-panel .nemo-panel-content-wrapper,
#nemo-world-info-settings-panel .nemo-panel-content-wrapper {
    white-space: normal; /* Ensure content wraps */
}

.nemo-extension #nemo-world-info-settings-panel #wiActivationSettings {
    display: block;
}

.nemo-extension #nemo-world-info-settings-panel #wiSliders,
.nemo-extension #nemo-world-info-settings-panel #wiCheckboxes {
    display: block;
    width: 100%;
    flex: none;
}

#nemo-world-info-order-helper-panel .nemo-panel-content-wrapper {
    padding-left: 20px; /* Add some padding to align with the other tabs */
}

.nemo-lore-simulator-results-header {
    margin-top: 15px;
    border-bottom: 1px solid var(--nemo-border-color);
    padding-bottom: 5px;
    margin-bottom: 10px;
}

#nemo-lore-simulator-results .list-group-item {
    background-color: var(--nemo-tertiary-bg);
    padding: 8px 12px;
    border-radius: 4px;
    margin-bottom: 5px;
}

/* === PAGINATION CONTROLS === */

.nemo-pagination-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 10px 0;
    border-top: 1px solid var(--nemo-border-color);
    border-bottom: 1px solid var(--nemo-border-color);
    margin: 10px 0;
    background-color: var(--nemo-primary-bg);
    border-radius: 4px;
}

.nemo-pagination-controls.hidden {
    display: none;
}

.nemo-extension .pagination-btn {
    min-width: 32px;
    height: 32px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    border: 1px solid var(--nemo-border-color);
    background-color: var(--nemo-secondary-bg);
    color: var(--nemo-text-color);
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.pagination-btn:hover:not(:disabled) {
    background-color: var(--nemo-item-hover-bg);
    border-color: var(--nemo-primary-accent);
    color: var(--nemo-primary-accent);
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: var(--nemo-primary-bg);
}

.pagination-info {
    padding: 0 15px;
    font-size: 14px;
    color: var(--nemo-text-color);
    white-space: nowrap;
}

.nemo-extension .pagination-goto {
    width: 80px;
    height: 32px;
    padding: 4px 8px;
    text-align: center;
    font-size: 14px;
    border: 1px solid var(--nemo-border-color);
    background-color: var(--nemo-secondary-bg);
    color: var(--nemo-text-color);
    border-radius: 4px;
}

.pagination-goto:focus {
    border-color: var(--nemo-primary-accent);
    outline: none;
    box-shadow: 0 0 0 2px var(--nemo-glow-color);
}

/* Infinite scroll toggle */
#nemo-world-info-infinite-scroll {
    margin-right: 5px;
}

/* Entries per page selector */
#nemo-world-info-entries-per-page {
    min-width: 60px;
}

/* Update buffer size select styling */
#nemo-world-info-buffer-size {
    min-width: 100px;
}

/* === MOBILE-FRIENDLY WORLD INFO STYLES === */
@media (max-width: 768px) {
    .nemo-world-info-container {
        flex-direction: column;
        height: auto;
    }
    
    .nemo-extension .nemo-world-info-left-column {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--nemo-border-color);
        max-height: 300px;
        order: 2; /* Move to bottom on mobile */
    }
    
    .nemo-world-info-right-column {
        position: relative;
        left: 0;
        width: 100%;
        height: auto;
        order: 1; /* Move to top on mobile */
    }
    
    /* Always show left panel toggle button on mobile */
    .nemo-extension #nemo-world-info-toggle-left-panel {
        display: block;
        top: 60px;
        left: 10px;
    }
    
    /* On mobile, hide left panel by default */
    .nemo-world-info-container:not(.mobile-left-panel-visible) .nemo-world-info-left-column {
        display: none;
    }
    
    .nemo-world-info-container.mobile-left-panel-visible .nemo-world-info-left-column {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: var(--z-sidebar);
        background: var(--nemo-secondary-bg);
        max-height: none;
        border-bottom: none;
    }
    
    /* Show mobile header on mobile devices */
    .nemo-extension .nemo-world-info-mobile-header {
        display: flex;
    }
    
    /* Compact tabs for mobile */
    .nemo-world-info-tabs {
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .nemo-world-info-tab {
        padding: 8px 12px;
        font-size: 0.9em;
        flex: 1;
        text-align: center;
        min-width: 80px;
    }
    
    /* Compact entries header on mobile */
    .nemo-world-info-entries-header {
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .nemo-world-info-entries-header > input,
    .nemo-world-info-entries-header > select {
        min-width: 120px;
        flex: 1;
    }
    
    /* Compact preset controls */
    .nemo-world-info-preset-controls {
        flex-direction: column;
        gap: 8px;
    }
    
    .nemo-world-info-preset-controls > select {
        width: 100%;
    }
    
    /* Compact active lorebooks */
    .nemo-active-lorebook-item {
        font-size: 0.9em;
        padding: 4px 8px;
    }
    
    /* Stack folder controls vertically on mobile */
    .nemo-world-info-list-header {
        flex-direction: column;
        gap: 8px;
    }
    
    .nemo-world-info-list-header > input {
        order: -1;
    }
}

/* Small mobile devices */
@media (max-width: 480px) {
    .nemo-world-info-tab {
        padding: 6px 8px;
        font-size: 0.8em;
        min-width: 60px;
    }
    
    .nemo-world-info-header-controls {
        margin-bottom: 5px;
    }
    
    .nemo-world-info-entries-header > .menu_button {
        padding: 6px;
        font-size: 0.9em;
    }
}
/* Favorite Preset Button Styles */
.nemo-favorite-btn {
    color: #ccc;
    cursor: pointer;
    transition: color 0.2s;
}

.nemo-favorite-btn:hover {
    color: #ffeb3b;
}

.nemo-favorite-btn.favorited {
    color: #ffeb3b;
}

.nemo-favorites-container {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 5px;
}

.nemo-favorite-preset-button {
    background-color: #444;
    border: 1px solid #555;
    border-radius: 5px;
    padding: 5px 10px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.nemo-favorite-preset-button:hover {
    background-color: #555;
}

/* === LOREBOOK MANAGEMENT STYLES === */

/* Lorebook entry display */
.nemo-active-lorebooks-list {
    margin-top: 8px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 4px;
    background-color: var(--nemo-secondary-bg);
    max-height: 200px;
    overflow-y: auto;
}

.nemo-lorebook-entry {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    border-bottom: 1px solid var(--nemo-border-color);
    transition: background-color 0.2s ease;
}

.nemo-lorebook-entry:last-child {
    border-bottom: none;
}

.nemo-lorebook-entry:hover {
    background-color: var(--nemo-item-hover-bg);
}

.nemo-lorebook-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    flex-grow: 1;
    min-width: 0;
}

.nemo-lorebook-name {
    font-weight: 500;
    color: var(--nemo-text-color);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}

.nemo-lorebook-details {
    font-size: 0.85em;
    color: var(--nemo-text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}

.nemo-remove-lorebook {
    flex-shrink: 0;
    background-color: var(--nemo-tertiary-bg);
    border: 1px solid var(--nemo-border-color);
    color: var(--nemo-text-color);
    padding: 4px 8px;
    font-size: 0.9em;
    transition: all 0.2s ease;
}

.nemo-remove-lorebook:hover {
    background-color: var(--SmartThemeQuoteColor);
    border-color: var(--SmartThemeQuoteColor);
    color: white;
}

.nemo-no-lorebooks {
    padding: 16px;
    text-align: center;
    color: var(--nemo-text-muted);
    font-style: italic;
}

/* Add lorebook controls */
#nemo-add-lorebook-btn {
    background-color: var(--nemo-primary-accent);
    border-color: var(--nemo-primary-accent);
    color: white;
    transition: all 0.2s ease;
}

#nemo-add-lorebook-btn:hover {
    background-color: var(--nemo-secondary-accent);
    border-color: var(--nemo-secondary-accent);
    box-shadow: 0 0 5px var(--nemo-glow-color);
}

#nemo-add-lorebook-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Mobile responsiveness for lorebook section */
@media (max-width: 768px) {
    .nemo-active-lorebooks-list {
        max-height: 150px;
    }
    
    .nemo-lorebook-entry {
        padding: 12px;
    }
    
    
    .nemo-lorebook-details {
        font-size: 0.8em;
    }
}

@media (max-width: 480px) {
    .nemo-active-lorebooks-list {
        max-height: 120px;
    }
    
    /* Mobile-friendly lorebook management */
    .nemo-lorebook-entry {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
    }
    
    .nemo-lorebook-info {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .nemo-remove-lorebook {
        align-self: flex-end;
    }
}

/* === MESSAGE THEMES === */

/* --- Generic Message Styling --- */
body[class*="theme-"] .mes_block {
    font-family: var(--panel-font) !important;
    border: 1px solid var(--panel-border) !important;
    background-color: var(--panel-bg-primary) !important;
    box-shadow: 0 2px 5px var(--panel-shadow) !important;
    color: var(--text-primary) !important;
    border-radius: 8px !important;
    margin-bottom: 10px !important;
    overflow: hidden !important;
}

body[class*="theme-"] .mes_block .ch_name {
    background: var(--header-bg-primary) !important;
    color: var(--header-text) !important;
    border-bottom: 1px solid var(--panel-border) !important;
    padding: 8px 12px !important;
}

/* Ensure name text has high contrast */
body[class*="theme-"] .mes_block .ch_name .name_text {
    color: var(--header-text) !important;
    font-weight: 600 !important;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
}

/* Timestamp and other header elements */
body[class*="theme-"] .mes_block .ch_name .timestamp,
body[class*="theme-"] .mes_block .ch_name small {
    color: var(--header-text) !important;
    opacity: 0.8 !important;
}

/* Icons and other header elements */
body[class*="theme-"] .mes_block .ch_name i,
body[class*="theme-"] .mes_block .ch_name svg {
    color: var(--header-text) !important;
    fill: var(--header-text) !important;
    opacity: 0.7 !important;
}

body[class*="theme-"] .mes_block .mes_text {
    color: var(--text-primary) !important;
    padding: 12px !important;
    background-color: var(--panel-bg-primary) !important;
    border-radius: 0 0 8px 8px !important;
}

/* Ensure all text elements within mes_text inherit the theme colors */
body[class*="theme-"] .mes_block .mes_text p,
body[class*="theme-"] .mes_block .mes_text div,
body[class*="theme-"] .mes_block .mes_text span,
body[class*="theme-"] .mes_block .mes_text q,
body[class*="theme-"] .mes_block .mes_text em,
body[class*="theme-"] .mes_block .mes_text strong {
    color: var(--text-primary) !important;
}

/* Code blocks need high contrast for readability */
body[class*="theme-"] .mes_block .mes_text code {
    background-color: rgba(0, 0, 0, 0.8) !important;
    color: #ffffff !important;
    padding: 2px 6px !important;
    border-radius: 3px !important;
    font-family: 'Courier New', Courier, monospace !important;
    font-weight: bold !important;
}

/* User message differentiation */
body[class*="theme-"] .mes_block.is_user {
    background-color: var(--panel-bg-secondary) !important;
    border-color: var(--panel-border) !important;
}

body[class*="theme-"] .mes_block.is_user .ch_name {
    background: var(--header-bg-primary) !important;
    color: var(--header-text) !important;
    opacity: 0.8 !important;
}

body[class*="theme-"] .mes_block.is_user .mes_text {
    background-color: var(--panel-bg-secondary) !important;
}

/* Additional reasoning header elements */
body[class*="theme-"] .mes_block .mes_reasoning_summary * {
    color: var(--header-text, #333333) !important;
}

body[class*="theme-"] .mes_block .mes_reasoning_summary .mes_reasoning_arrow {
    color: var(--header-text, #333333) !important;
}

body[class*="theme-"] .mes_block .mes_reasoning_summary svg {
    fill: var(--header-text, #333333) !important;
}

/* Emergency contrast fix for reasoning title */
body[class*="theme-"] .mes_block .mes_reasoning_summary {
    background-color: var(--header-bg-primary) !important;
    color: var(--header-text) !important;
}

/* Ensure reasoning content is readable */
body[class*="theme-"] .mes_block .mes_reasoning p,
body[class*="theme-"] .mes_block .mes_reasoning li,
body[class*="theme-"] .mes_block .mes_reasoning span,
body[class*="theme-"] .mes_block .mes_reasoning div,
body[class*="theme-"] .mes_block .mes_reasoning ol,
body[class*="theme-"] .mes_block .mes_reasoning ul {
    color: var(--text-primary) !important;
    background-color: transparent !important;
}

/* Main reasoning block container */
body[class*="theme-"] .mes_block .mes_reasoning_details {
    background-color: var(--panel-bg-secondary) !important;
    border: 1px solid var(--panel-border) !important;
    border-radius: 4px !important;
    margin: 8px 0 !important;
    opacity: 0.95 !important;
}

/* Reasoning content area */
body[class*="theme-"] .mes_block .mes_reasoning {
    color: var(--text-primary) !important;
    background-color: var(--panel-bg-primary) !important;
    padding: 12px !important;
    font-size: 0.9em !important;
}

/* Fix for specific reasoning elements when expanded */
body[class*="theme-"] .mes_block .mes_reasoning_details[open] .mes_reasoning {
    background-color: var(--panel-bg-primary) !important;
    border-top: 1px solid var(--panel-border) !important;
}

body[class*="theme-"] .main-container {
    background-color: var(--panel-bg-secondary);
}

/* === DIALOGUE AND ITALICS STYLING FOR ALL THEMES === */

/* Dialogue styling - text within quotes */
body[class*="theme-"] .mes_block .mes_text q,
body[class*="theme-"] .mes_block .mes_text q::before,
body[class*="theme-"] .mes_block .mes_text q::after {
    color: var(--dialogue-color, #0066cc) !important;
    font-style: italic !important;
    font-weight: 500 !important;
}

/* Italics styling */
body[class*="theme-"] .mes_block .mes_text em,
body[class*="theme-"] .mes_block .mes_text i {
    color: var(--italics-color, #666666) !important;
    font-style: italic !important;
}

/* Reasoning block dialogue and italics */
body[class*="theme-"] .mes_block .mes_reasoning q {
    color: var(--dialogue-color, #0066cc) !important;
    font-style: italic !important;
    font-weight: 500 !important;
}

body[class*="theme-"] .mes_block .mes_reasoning em,
body[class*="theme-"] .mes_block .mes_reasoning i {
    color: var(--italics-color, #666666) !important;
    font-style: italic !important;
}

/* --- Theme Definitions --- */

body.theme-cheerful {
  --panel-font: 'Verdana', 'Geneva', sans-serif;
  --panel-border: #FFC107;
  --panel-bg-primary: #FFFDE7;
  --panel-bg-secondary: #FFF8E1;
  --panel-shadow: rgba(255,193,7,0.3);
  --header-bg-primary: #FFF9C4;
  --header-text: #424242;
  --text-primary: #5D4037;
  --dialogue-color: #2E7D32;
  --italics-color: #E65100;
}

body.theme-divine {
  --panel-font: 'Garamond', 'Palatino', serif;
  --panel-border: #FFD700;
  --panel-bg-primary: #FFFFFF;
  --panel-bg-secondary: #F8F8FF;
  --panel-shadow: rgba(255,215,0,0.3);
  --header-bg-primary: #F0F8FF;
  --header-text: #1a3a3a;
  --text-primary: #2F4F4F;
  --dialogue-color: #8B4513;
  --italics-color: #4B0082;
}

body.theme-fantasy {
  --panel-font: 'Georgia', 'Times New Roman', serif;
  --panel-border: #8B4513;
  --panel-bg-primary: #2F1B14;
  --panel-bg-secondary: #3d2518;
  --panel-shadow: rgba(0,0,0,0.7);
  --header-bg-primary: #6b3e1a;
  --header-text: #F4E4BC;
  --text-primary: #E8DCC6;
  --dialogue-color: #90EE90;
  --italics-color: #DDA0DD;
}

body.theme-royal {
  --panel-font: 'Garamond', 'Book Antiqua', serif;
  --panel-border: #C0C0C0;
  --panel-bg-primary: #4B0082;
  --panel-bg-secondary: #6a1fb3;
  --panel-shadow: rgba(0,0,0,0.5);
  --header-bg-primary: #8B6914;
  --header-text: #FFFFFF;
  --text-primary: #F8F8FF;
  --dialogue-color: #FFD700;
  --italics-color: #FF69B4;
}

body.theme-steampunk {
  --panel-font: 'Times New Roman', 'Baskerville', serif;
  --panel-border: #B8860B;
  --panel-bg-primary: #5D4037;
  --panel-bg-secondary: #6d4c41;
  --panel-shadow: rgba(0,0,0,0.6);
  --header-bg-primary: #1a4480;
  --header-text: #F5DEB3;
  --text-primary: #F5DEB3;
  --dialogue-color: #87CEEB;
  --italics-color: #CD853F;
}

body.theme-solarpunk {
  --panel-font: 'Nunito', 'Segoe UI', sans-serif;
  --panel-border: #228B22;
  --panel-bg-primary: #F0FFF0;
  --panel-bg-secondary: #E8F5E8;
  --panel-shadow: rgba(34,139,34,0.2);
  --header-bg-primary: #FFF3CD;
  --header-text: #2c5530;
  --text-primary: #2c5530;
  --dialogue-color: #FF6347;
  --italics-color: #9932CC;
}

body.theme-goth {
  --panel-font: 'Georgia', 'Times New Roman', serif;
  --panel-border: #444444;
  --panel-bg-primary: #1a1a1a;
  --panel-bg-secondary: #2a2a2a;
  --panel-shadow: rgba(0,0,0,0.8);
  --header-bg-primary: #4a1a1a;
  --header-text: #E0E0E0;
  --text-primary: #CCCCCC;
  --dialogue-color: #DC143C;
  --italics-color: #8A2BE2;
}

body.theme-pastel {
  --panel-font: 'Segoe UI', 'Candara', sans-serif;
  --panel-border: #D1C4E9;
  --panel-bg-primary: #FFFFFF;
  --panel-bg-secondary: #F8F6FF;
  --panel-shadow: rgba(0,0,0,0.1);
  --header-bg-primary: #E1F5FE;
  --header-text: #1a1a1a;
  --text-primary: #2c3e50;
  --dialogue-color: #FF69B4;
  --italics-color: #9370DB;
}

body.theme-passionate {
  --panel-font: 'Arial Black', 'Impact', sans-serif;
  --panel-border: #B22222;
  --panel-bg-primary: #1A1A1A;
  --panel-bg-secondary: #2a2a2a;
  --panel-shadow: rgba(178,34,34,0.5);
  --header-bg-primary: #8B1538;
  --header-text: #FFFFFF;
  --text-primary: #F5F5F5;
  --dialogue-color: #FF4500;
  --italics-color: #FFA500;
}

body.theme-horror {
  --panel-font: 'Georgia', 'Times New Roman', serif;
  --panel-border: #4B0082;
  --panel-bg-primary: #1A0B1A;
  --panel-bg-secondary: #2a1a2a;
  --panel-shadow: rgba(0,0,0,0.9);
  --header-bg-primary: #3a1a5a;
  --header-text: #D8BFD8;
  --text-primary: #C8B8C8;
  --dialogue-color: #FF6B6B;
  --italics-color: #DDA0DD;
}

body.theme-melancholy {
  --panel-font: 'Garamond', 'Palatino', serif;
  --panel-border: #78909C;
  --panel-bg-primary: #37474F;
  --panel-bg-secondary: #455a64;
  --panel-shadow: rgba(0,0,0,0.4);
  --header-bg-primary: #546e7a;
  --header-text: #ECEFF1;
  --text-primary: #CFD8DC;
  --dialogue-color: #81C784;
  --italics-color: #BA68C8;
}

body.theme-romance {
  --panel-font: 'Candara', 'Calibri', sans-serif;
  --panel-border: #d8bfd8;
  --panel-bg-primary: #4a3f56;
  --panel-bg-secondary: #5a4f66;
  --panel-shadow: rgba(0,0,0,0.3);
  --header-bg-primary: #8B4B8B;
  --header-text: #f0e8f8;
  --text-primary: #f0e8f8;
  --dialogue-color: #FFB6C1;
  --italics-color: #DDA0DD;
}

body.theme-cyberpunk {
  --panel-font: 'Courier New', 'Monaco', monospace;
  --panel-border: #00FFFF;
  --panel-bg-primary: #001122;
  --panel-bg-secondary: #002233;
  --panel-shadow: rgba(0,255,255,0.4);
  --header-bg-primary: #004466;
  --header-text: #E0FFFF;
  --text-primary: #E0FFFF;
  --dialogue-color: #FF00FF;
  --italics-color: #00FF00;
}

body.theme-dyslexia {
  --panel-font: 'OpenDyslexic', 'Verdana', 'Arial', sans-serif;
  --panel-border: #8B7355;
  --panel-bg-primary: #FFFEF7;
  --panel-bg-secondary: #F8F5E8;
  --panel-shadow: rgba(139,115,85,0.2);
  --header-bg-primary: #F0E6C8;
  --header-text: #2d2d2d;
  --text-primary: #2d2d2d;
  --dialogue-color: #CC0000;
  --italics-color: #0066CC;
}

body.theme-dyslexia-dark {
  --panel-font: 'OpenDyslexic', 'Verdana', 'Arial', sans-serif;
  --panel-border: #8B7355;
  --panel-bg-primary: #1a1a1a;
  --panel-bg-secondary: #2a2a2a;
  --panel-shadow: rgba(0,0,0,0.6);
  --header-bg-primary: #3a3a3a;
  --header-text: #f0f0f0;
  --text-primary: #f0f0f0;
  --dialogue-color: #87CEEB;
  --italics-color: #FFA500;
}

/* === DYSLEXIA-FRIENDLY ENHANCEMENTS === */

/* Enhanced text styling for dyslexia readability */
body.theme-dyslexia .mes_block .mes_text {
    line-height: 1.6 !important;
    font-size: 20px !important;
    letter-spacing: 0.05em !important;
    word-spacing: 0.15em !important;
}

body.theme-dyslexia-dark .mes_block .mes_text {
    line-height: 1.8 !important;
    font-size: 20px !important;
    letter-spacing: 0.08em !important;
    word-spacing: 0.18em !important;
}

body.theme-dyslexia .mes_block .mes_text p {
    margin-bottom: 1.2em !important;
    text-align: left !important;
    font-size: 20px !important;
}

body.theme-dyslexia-dark .mes_block .mes_text p {
    margin-bottom: 1.4em !important;
    text-align: left !important;
    font-size: 20px !important;
}

/* Improved header readability */
body.theme-dyslexia .mes_block .ch_name .name_text {
    font-size: 22px !important;
    font-weight: 700 !important;
    letter-spacing: 0.03em !important;
}

body.theme-dyslexia-dark .mes_block .ch_name .name_text {
    font-size: 22px !important;
    font-weight: 700 !important;
    letter-spacing: 0.06em !important;
}

/* Timestamp and small elements */
body.theme-dyslexia .mes_block .ch_name .timestamp,
body.theme-dyslexia .mes_block .ch_name small,
body.theme-dyslexia-dark .mes_block .ch_name .timestamp,
body.theme-dyslexia-dark .mes_block .ch_name small {
    font-size: 16px !important;
}

/* Enhanced reasoning block readability */
body.theme-dyslexia .mes_block .mes_reasoning {
    line-height: 1.7 !important;
    font-size: 19px !important;
    letter-spacing: 0.04em !important;
}

body.theme-dyslexia-dark .mes_block .mes_reasoning {
    line-height: 1.9 !important;
    font-size: 19px !important;
    letter-spacing: 0.07em !important;
}

body.theme-dyslexia .mes_block .mes_reasoning p,
body.theme-dyslexia .mes_block .mes_reasoning li {
    margin-bottom: 1em !important;
    font-size: 19px !important;
}

body.theme-dyslexia-dark .mes_block .mes_reasoning p,
body.theme-dyslexia-dark .mes_block .mes_reasoning li {
    margin-bottom: 1.3em !important;
    font-size: 19px !important;
}

/* Reasoning header title */
body.theme-dyslexia .mes_block .mes_reasoning_summary .mes_reasoning_header_title,
body.theme-dyslexia-dark .mes_block .mes_reasoning_summary .mes_reasoning_header_title {
    font-size: 18px !important;
    font-weight: 600 !important;
}

/* Dyslexia-friendly code blocks with higher contrast */
body.theme-dyslexia .mes_block .mes_text code {
    background-color: #2F2F2F !important;
    color: #FDF6E3 !important;
    font-family: 'OpenDyslexic Mono', 'Courier New', monospace !important;
    font-size: 19px !important;
    letter-spacing: 0.02em !important;
    padding: 4px 8px !important;
    border-radius: 4px !important;
}

body.theme-dyslexia-dark .mes_block .mes_text code {
    background-color: #404040 !important;
    color: #E0E0E0 !important;
    font-family: 'OpenDyslexic Mono', 'Courier New', monospace !important;
    font-size: 19px !important;
    letter-spacing: 0.02em !important;
    padding: 4px 8px !important;
    border-radius: 4px !important;
}

/* Reduced visual clutter - simpler borders */
body.theme-dyslexia .mes_block,
body.theme-dyslexia-dark .mes_block {
    border-width: 2px !important;
    border-style: solid !important;
}

/* Enhanced focus indicators */
body.theme-dyslexia .mes_block .mes_text *:focus,
body.theme-dyslexia-dark .mes_block .mes_text *:focus {
    outline: 3px solid #8B7355 !important;
    outline-offset: 2px !important;
}

/* Additional contrast enhancements for dyslexia light theme */
body.theme-dyslexia .mes_block .mes_text,
body.theme-dyslexia .mes_block .mes_text p,
body.theme-dyslexia .mes_block .mes_text div,
body.theme-dyslexia .mes_block .mes_text span,
body.theme-dyslexia .mes_block .mes_text q,
body.theme-dyslexia .mes_block .mes_text em,
body.theme-dyslexia .mes_block .mes_text strong {
    color: #2d2d2d !important;
    text-shadow: 0 0 1px rgba(255, 255, 255, 0.5) !important;
}

/* Additional contrast enhancements for dyslexia dark theme */
body.theme-dyslexia-dark .mes_block .mes_text,
body.theme-dyslexia-dark .mes_block .mes_text p,
body.theme-dyslexia-dark .mes_block .mes_text div,
body.theme-dyslexia-dark .mes_block .mes_text span,
body.theme-dyslexia-dark .mes_block .mes_text q,
body.theme-dyslexia-dark .mes_block .mes_text em,
body.theme-dyslexia-dark .mes_block .mes_text strong {
    color: #f0f0f0 !important;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.8) !important;
}

/* Enhanced header contrast - light theme */
body.theme-dyslexia .mes_block .ch_name .name_text {
    color: #1d1d1d !important;
    text-shadow: 0 0 2px rgba(255, 255, 255, 0.8) !important;
}

/* Enhanced header contrast - dark theme */
body.theme-dyslexia-dark .mes_block .ch_name .name_text {
    color: #f0f0f0 !important;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.8) !important;
}

/* Reasoning block text contrast - light theme */
body.theme-dyslexia .mes_block .mes_reasoning,
body.theme-dyslexia .mes_block .mes_reasoning p,
body.theme-dyslexia .mes_block .mes_reasoning li,
body.theme-dyslexia .mes_block .mes_reasoning span,
body.theme-dyslexia .mes_block .mes_reasoning div {
    color: #2d2d2d !important;
    text-shadow: 0 0 1px rgba(255, 255, 255, 0.4) !important;
}

/* Reasoning block text contrast - dark theme */
body.theme-dyslexia-dark .mes_block .mes_reasoning,
body.theme-dyslexia-dark .mes_block .mes_reasoning p,
body.theme-dyslexia-dark .mes_block .mes_reasoning li,
body.theme-dyslexia-dark .mes_block .mes_reasoning span,
body.theme-dyslexia-dark .mes_block .mes_reasoning div {
    color: #f0f0f0 !important;
    text-shadow: 0 0 1px rgba(0, 0, 0, 0.6) !important;
}

/* High contrast code blocks - light theme */
body.theme-dyslexia .mes_block .mes_text code {
    background-color: #000000 !important;
    color: #FFFFFF !important;
    text-shadow: none !important;
    border: 1px solid #333333 !important;
}

/* High contrast code blocks - dark theme */
body.theme-dyslexia-dark .mes_block .mes_text code {
    background-color: #FFFFFF !important;
    color: #000000 !important;
    text-shadow: none !important;
    border: 1px solid #CCCCCC !important;
}

/* === USER SETTINGS TABBED INTERFACE === */

/* Tab navigation styles */
.nemo-user-settings-tabs {
    display: flex;
    border-bottom: 2px solid var(--nemo-border-color);
    margin-bottom: 20px;
    background-color: var(--nemo-secondary-bg);
    border-radius: 8px 8px 0 0;
    overflow: hidden;
}

.nemo-user-settings-tab {
    flex: 1;
    padding: 12px 20px;
    background-color: var(--nemo-tertiary-bg);
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--nemo-text-color);
    border-right: 1px solid var(--nemo-border-color);
    transition: all 0.3s ease;
    position: relative;
    text-align: center;
}

.nemo-user-settings-tab:last-child {
    border-right: none;
}

.nemo-user-settings-tab:hover {
    background-color: var(--nemo-item-hover-bg);
    color: var(--nemo-primary-accent);
}

.nemo-user-settings-tab.active {
    background-color: var(--nemo-primary-bg);
    color: var(--nemo-primary-accent);
    border-bottom: 3px solid var(--nemo-primary-accent);
}

.nemo-user-settings-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--nemo-primary-bg);
}

/* Tab content styles */
.nemo-user-settings-tab-content {
    display: none;
    padding: 20px 0;
}

.nemo-user-settings-tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease-in;
}

/* Ensure proper layout within tabs */
.nemo-user-settings-tab-content > div {
    max-width: 100%;
}

/* UI Theme tab specific styling */
#nemo-tab-ui-theme {
    display: none;
}

#nemo-tab-ui-theme.active {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
}

/* Theme selector section - full width */
#nemo-tab-ui-theme #UI-presets-block {
    width: 100%;
    margin-bottom: 20px;
}

/* Main content area - two columns */
.nemo-ui-theme-main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    align-items: start;
    width: 100%;
    grid-template-rows: auto;
}

/* Force grid positioning - left column (theme elements) */
.nemo-ui-theme-main-content > [name="themeElements"] {
    grid-column: 1 !important;
    grid-row: 1 !important;
    width: 100% !important;
    min-width: 0 !important;
}

/* Force grid positioning - right column (Custom CSS) */
.nemo-ui-theme-main-content > #CustomCSS-block {
    grid-column: 2 !important;
    grid-row: 1 !important;
    width: 100% !important;
    min-width: 0 !important;
}

/* Left column: All theme elements except Custom CSS */
#nemo-tab-ui-theme .nemo-ui-theme-main-content [name="themeElements"] {
    width: 100%;
    min-width: 0;
    grid-column: 1;
    grid-row: 1;
}

/* Right column: Custom CSS block */
#nemo-tab-ui-theme .nemo-ui-theme-main-content #CustomCSS-block {
    width: 100%;
    min-width: 0;
    grid-column: 2;
    grid-row: 1;
}

/* Make sure elements inside themeElements use full width */
#nemo-tab-ui-theme [name="themeElements"] > * {
    width: 100%;
}

/* Form elements should expand but buttons shouldn't stretch */
#nemo-tab-ui-theme select,
#nemo-tab-ui-theme input[type="range"],
#nemo-tab-ui-theme input[type="number"],
#nemo-tab-ui-theme textarea {
    width: 100%;
    box-sizing: border-box;
}

/* Buttons should not stretch - keep natural size */
#nemo-tab-ui-theme .menu_button {
    width: auto;
    flex-shrink: 0;
}

/* Flex containers should distribute space, not stretch content */
#nemo-tab-ui-theme .flex-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

#nemo-tab-ui-theme .flex-container.alignItemsBaseline {
    align-items: baseline;
}

/* For select elements in flex containers, only the select should grow */
#nemo-tab-ui-theme .flex-container select.flex1 {
    flex: 1;
}

#nemo-tab-ui-theme .flex-container select:not(.flex1) {
    width: auto;
    flex-shrink: 0;
}

/* Fix specific theme elements */
#nemo-tab-ui-theme [name="FontBlurChatWidthBlock"] {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    width: 100%;
}

#nemo-tab-ui-theme [name="FontBlurChatWidthBlock"] .flex-container {
    flex: 1;
    min-width: 200px;
}

#nemo-tab-ui-theme .neo-range-slider {
    width: 100%;
}

/* Fix color picker block */
#nemo-tab-ui-theme #color-picker-block .flex-container {
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

/* Ensure inline drawers expand */
#nemo-tab-ui-theme .inline-drawer {
    width: 100%;
}

/* Make Custom CSS textarea resizable */
#nemo-tab-ui-theme #customCSS {
    resize: both !important;
    min-height: 200px !important;
    max-height: 800px !important;
    min-width: 200px !important;
}

/* Theme toggles multi-column layout */
#nemo-tab-ui-theme [name="themeToggles"] {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px 20px;
    width: 100%;
    margin-top: 10px;
}

#nemo-tab-ui-theme [name="themeToggles"] .checkbox_label {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background-color: var(--nemo-tertiary-bg, rgba(255, 255, 255, 0.05));
    border-radius: 6px;
    border: 1px solid var(--nemo-border-color, rgba(255, 255, 255, 0.1));
    transition: background-color 0.2s ease;
    cursor: pointer;
    margin: 0;
    width: 100%;
    box-sizing: border-box;
}

#nemo-tab-ui-theme [name="themeToggles"] .checkbox_label:hover {
    background-color: var(--nemo-item-hover-bg, rgba(255, 255, 255, 0.08));
}

#nemo-tab-ui-theme [name="themeToggles"] .checkbox_label input[type="checkbox"] {
    margin: 0;
    flex-shrink: 0;
}

#nemo-tab-ui-theme [name="themeToggles"] .checkbox_label small {
    flex: 1;
    font-size: 13px;
    line-height: 1.3;
}

#nemo-tab-ui-theme [name="themeToggles"] .checkbox_label i {
    margin-left: auto;
    flex-shrink: 0;
    opacity: 0.7;
}

/* Responsive adjustment for theme toggles */
@media (max-width: 768px) {
    #nemo-tab-ui-theme [name="themeToggles"] {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    #nemo-tab-ui-theme [name="themeToggles"] .checkbox_label {
        padding: 10px;
    }
}

/* Chat Messages tab specific styling */
#nemo-tab-chat-messages {
    display: none;
}

#nemo-tab-chat-messages.active {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
}

#nemo-tab-chat-messages > div {
    width: 100%;
}

#nemo-tab-chat-messages .menu_button {
    width: auto;
    flex-shrink: 0;
}

#nemo-tab-chat-messages select,
#nemo-tab-chat-messages input[type="range"],
#nemo-tab-chat-messages input[type="number"],
#nemo-tab-chat-messages textarea {
    width: 100%;
    box-sizing: border-box;
}

/* Character Handling tab specific styling */
#nemo-tab-character-handling {
    display: none;
}


/* Responsive design for mobile devices */
@media (max-width: 768px) {
    .nemo-ui-theme-main-content {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
    }
    
    .nemo-ui-theme-main-content > [name="themeElements"] {
        grid-column: 1 !important;
        grid-row: 1 !important;
    }
    
    .nemo-ui-theme-main-content > #CustomCSS-block {
        grid-column: 1 !important;
        grid-row: 2 !important;
    }
    
    .nemo-user-settings-tab {
        font-size: 12px;
        padding: 10px 15px;
    }
}

#nemo-tab-character-handling.active {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    align-items: start;
    width: 100%;
    align-content: start;
}

#nemo-tab-character-handling [name="CharacterHandlingToggles"] {
    width: 100%;
    min-width: 0;
    grid-column: 1;
}

#nemo-tab-character-handling [name="MiscellaneousToggles"] {
    width: 100%;
    min-width: 0;
    grid-column: 2;
}

/* Form elements should expand properly but buttons shouldn't stretch */
#nemo-tab-character-handling select,
#nemo-tab-character-handling input[type="range"],
#nemo-tab-character-handling input[type="number"],
#nemo-tab-character-handling textarea {
    width: 100%;
    box-sizing: border-box;
}

#nemo-tab-character-handling .flex-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

#nemo-tab-character-handling .flex-container.flexGap2 {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* Buttons should maintain natural size */
#nemo-tab-character-handling .menu_button {
    width: auto;
    flex-shrink: 0;
}

/* Miscellaneous section specific styling */
#nemo-tab-character-handling [name="MiscellaneousToggles"] {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

#nemo-tab-character-handling [name="MiscellaneousToggles"] h4 {
    margin-bottom: 10px;
    margin-top: 0;
}

/* Organize miscellaneous checkboxes in a more compact layout */
#nemo-tab-character-handling [name="MiscellaneousToggles"] .checkbox_label {
    margin-bottom: 8px;
    padding: 6px 0;
}

/* Make the button container more compact */
#nemo-tab-character-handling [name="MiscellaneousToggles"] .flex-container.flexGap2 {
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 15px;
}

/* Smooth streaming control styling */
#nemo-tab-character-handling [name="MiscellaneousToggles"] #smooth_streaming_speed_control {
    margin-top: 2px;
    margin-left: 20px;
    align-self: flex-start;
}

/* MovingUI section styling */
#nemo-tab-character-handling [name="MiscellaneousToggles"] #MovingUI-presets-block {
    margin-top: 8px;
    margin-left: 20px;
}

/* Ensure streaming FPS and message load controls are aligned */
#nemo-tab-character-handling .flex-container .flexFlowColumn {
    align-items: flex-start;
}

#nemo-tab-character-handling .flex-container .flexFlowColumn small:first-child {
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 5px;
    min-height: 20px;
}

/* Align the actual slider elements by targeting the neo-range-slider specifically */
#nemo-tab-character-handling .flex-container .neo-range-slider {
    margin-top: 0;
    align-self: stretch;
}

/* Hide the "(0 = All)" text to fix alignment - multiple selectors for better targeting */
#nemo-tab-character-handling small[data-i18n="(0 = All)"],
small[data-i18n="(0 = All)"],
.flexFlowColumn small[data-i18n="(0 = All)"] {
    display: none !important;
    visibility: hidden !important;
}

/* Also target it by content if data-i18n doesn't work */
#nemo-tab-character-handling .flexFlowColumn small:last-child {
    display: none !important;
}

/* Only allow flex growth for elements marked with flex1 */
#nemo-tab-character-handling .flex1 {
    flex: 1;
}

/* === SEARCH RESULTS STYLING === */

.nemo-search-results-container {
    padding: 20px 0;
    max-height: 70vh;
    overflow-y: auto;
}

.nemo-search-results-header {
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--nemo-border-color);
}

.nemo-search-results-header h4 {
    color: var(--nemo-primary-accent);
    margin: 0;
    font-size: 16px;
}

.nemo-search-result-item {
    margin-bottom: 20px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    background-color: var(--nemo-tertiary-bg);
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.nemo-search-result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 15px;
    background-color: var(--nemo-secondary-bg);
    border-bottom: 1px solid var(--nemo-border-color);
    font-size: 12px;
}

.nemo-search-result-tab {
    font-weight: 600;
    color: var(--nemo-primary-accent);
    letter-spacing: 0.5px;
}

.nemo-search-result-relevance {
    color: var(--nemo-text-color);
    opacity: 0.7;
}

.nemo-search-result-item > *:not(.nemo-search-result-header) {
    padding: 15px;
}

.nemo-search-result-item label,
.nemo-search-result-item .flex-container {
    margin-bottom: 0;
}

.nemo-no-results {
    text-align: center;
    padding: 40px 20px;
    color: var(--nemo-text-color);
    opacity: 0.7;
}

.nemo-no-results i {
    font-size: 24px;
    margin-bottom: 10px;
    display: block;
}

.nemo-no-results p {
    margin: 0;
    font-size: 14px;
}

/* Search input styling */
.nemo-user-settings-search {
    margin-bottom: 15px;
}

#nemo-user-settings-search {
    transition: all 0.2s ease;
}

#nemo-user-settings-search:focus {
    outline: none;
    border-color: var(--nemo-primary-accent) !important;
    box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
}

/* Responsive search results */
@media (max-width: 768px) {
    .nemo-search-results-container {
        padding: 15px 0;
        max-height: 60vh;
    }
    
    .nemo-search-result-item > *:not(.nemo-search-result-header) {
        padding: 12px;
    }
    
    .nemo-search-result-header {
        padding: 6px 12px;
    }
}

/* === PROMPT CONTEXT MENU & DIALOG STYLING === */

/* Context Menu */
.nemo-context-menu {
    position: absolute;
    background-color: var(--nemo-secondary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: var(--z-popup);
    min-width: 150px;
    padding: 6px 0;
}

.nemo-context-menu-item {
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--nemo-text-color);
    font-size: 14px;
    transition: background-color 0.2s ease;
}

.nemo-context-menu-item:hover {
    background-color: var(--nemo-item-hover-bg);
}

.nemo-context-menu-item i {
    width: 14px;
    text-align: center;
    opacity: 0.7;
}

.nemo-context-menu-separator {
    height: 1px;
    background-color: var(--nemo-border-color);
    margin: 6px 0;
}

/* Tray Context Menu (Move prompts) */
.nemo-tray-context-menu {
    position: fixed;
    z-index: 10000;
    min-width: 180px;
    max-width: 280px;
    max-height: 300px;
    overflow-y: auto;
}

.nemo-context-menu-header {
    padding: 8px 12px;
    font-weight: 600;
    font-size: 0.85em;
    color: var(--SmartThemeQuoteColor, #888);
    border-bottom: 1px solid var(--nemo-border-color);
    display: flex;
    align-items: center;
    gap: 8px;
    position: sticky;
    top: 0;
    background: var(--nemo-secondary-bg);
}

.nemo-context-menu-header i {
    font-size: 0.9em;
    opacity: 0.7;
}

.nemo-tray-context-menu .nemo-context-menu-item {
    padding: 10px 14px;
}

.nemo-tray-context-menu .nemo-context-menu-item span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
}

/* Dialog Overlay */
.nemo-dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: var(--z-notification);
    padding: 20px;
}

.nemo-dialog {
    background-color: var(--nemo-primary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.nemo-dialog-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--nemo-border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: var(--nemo-secondary-bg);
}

.nemo-dialog-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: var(--nemo-text-color);
}

.nemo-dialog-close {
    background: none;
    border: none;
    font-size: 18px;
    color: var(--nemo-text-color);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    position: relative;
    z-index: var(--z-sidebar);
}

.nemo-dialog-close:hover {
    background-color: var(--nemo-item-hover-bg);
}

.nemo-dialog-content {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.nemo-dialog-content p {
    margin: 0 0 20px 0;
    color: var(--nemo-text-color);
    font-size: 14px;
}

.nemo-headers-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 300px;
    overflow-y: auto;
}

.nemo-header-option {
    padding: 16px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    background-color: var(--nemo-tertiary-bg);
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-header-option:hover {
    background-color: var(--nemo-item-hover-bg);
    border-color: var(--nemo-primary-accent);
}

.nemo-header-name {
    font-weight: 600;
    font-size: 14px;
    color: var(--nemo-primary-accent);
    margin-bottom: 4px;
}

.nemo-header-preview {
    font-size: 12px;
    color: var(--nemo-text-color);
    opacity: 0.8;
}

.nemo-dialog-actions {
    padding: 20px 24px;
    border-top: 1px solid var(--nemo-border-color);
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.nemo-btn-secondary {
    padding: 8px 16px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    background-color: var(--nemo-tertiary-bg);
    color: var(--nemo-text-color);
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-btn-secondary:hover {
    background-color: var(--nemo-item-hover-bg);
    border-color: var(--nemo-primary-accent);
}

/* Responsive dialog */
@media (max-width: 768px) {
    .nemo-dialog {
        margin: 0;
        border-radius: 0;
        max-height: 100vh;
        height: 100vh;
    }
    
    .nemo-dialog-overlay {
        padding: 0;
    }
    
    .nemo-dialog-header,
    .nemo-dialog-content,
    .nemo-dialog-actions {
        padding: 16px;
    }
}

/* === PROMPT LIBRARY SYSTEM STYLING === */

/* Dialog variations */
.nemo-dialog-large {
    max-width: 700px;
    max-height: 85vh;
}

/* Form styling */
.nemo-form-group {
    margin-bottom: 20px;
}

.nemo-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--nemo-text-color);
    font-size: 14px;
}

.nemo-form-group input[type="text"] {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    background-color: var(--nemo-tertiary-bg);
    color: var(--nemo-text-color);
    font-size: 14px;
    box-sizing: border-box;
}

.nemo-form-group input[type="text"]:focus {
    outline: none;
    border-color: var(--nemo-primary-accent);
    box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
}

.nemo-prompt-preview {
    background-color: var(--nemo-secondary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    padding: 12px;
    font-size: 13px;
    line-height: 1.4;
}

/* Saved prompts list */
.nemo-saved-prompts-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-height: 400px;
    overflow-y: auto;
    padding-right: 8px;
}

.nemo-saved-prompt-item {
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    background-color: var(--nemo-tertiary-bg);
    padding: 16px;
    transition: all 0.2s ease;
}

.nemo-saved-prompt-item:hover {
    border-color: var(--nemo-primary-accent);
    background-color: var(--nemo-item-hover-bg);
}

.nemo-saved-prompt-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.nemo-saved-prompt-title {
    font-weight: 600;
    font-size: 15px;
    color: var(--nemo-primary-accent);
    flex: 1;
}

.nemo-saved-prompt-date {
    font-size: 12px;
    color: var(--nemo-text-color);
    opacity: 0.7;
    margin-left: 12px;
}

.nemo-prompt-tags {
    margin-bottom: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.nemo-tag {
    background-color: var(--nemo-primary-accent);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
}

.nemo-saved-prompt-preview {
    margin-bottom: 12px;
    color: var(--nemo-text-color);
    opacity: 0.8;
    font-size: 12px;
}

.nemo-saved-prompt-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}

/* Button variations */
.nemo-btn-primary {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    background-color: var(--nemo-primary-accent);
    color: white;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-btn-primary:hover {
    background-color: color-mix(in srgb, var(--nemo-primary-accent) 85%, black);
}

.nemo-btn-small {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 4px;
}

.nemo-btn-danger {
    border: 1px solid #dc3545;
    background-color: transparent;
    color: #dc3545;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-btn-danger:hover {
    background-color: #dc3545;
    color: white;
}

/* Scrollbar styling for prompts list */
.nemo-saved-prompts-list::-webkit-scrollbar {
    width: 6px;
}

.nemo-saved-prompts-list::-webkit-scrollbar-track {
    background: var(--nemo-tertiary-bg);
    border-radius: 3px;
}

.nemo-saved-prompts-list::-webkit-scrollbar-thumb {
    background: var(--nemo-border-color);
    border-radius: 3px;
}

.nemo-saved-prompts-list::-webkit-scrollbar-thumb:hover {
    background: var(--nemo-primary-accent);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .nemo-dialog-large {
        max-width: 100vw;
        max-height: 100vh;
        margin: 0;
        border-radius: 0;
    }
    
    .nemo-saved-prompt-header {
        flex-direction: column;
        gap: 4px;
    }
    
    .nemo-saved-prompt-date {
        margin-left: 0;
    }
    
    .nemo-saved-prompt-actions {
        flex-direction: column;
    }
    
}

/* Chat Messages tab specific styling */
#nemo-tab-chat-messages {
    display: none;
}

#nemo-tab-chat-messages.active {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
    align-items: start;
    width: 100%;
}

/* Organize chat message sections - ensure they fill space properly */
#nemo-tab-chat-messages > * {
    width: 100%;
    min-width: 0;
}

#nemo-tab-chat-messages [name="ChatMessageHandlingToggles"] {
    width: 100%;
    min-width: 0;
}

#nemo-tab-chat-messages [name="AutoCompleteToggle"] {
    width: 100%;
    min-width: 0;
}

#nemo-tab-chat-messages [name="STscriptToggles"] {
    width: 100%;
    min-width: 0;
}

/* Form elements should expand properly but buttons shouldn't stretch */
#nemo-tab-chat-messages select,
#nemo-tab-chat-messages input[type="range"],
#nemo-tab-chat-messages input[type="number"],
#nemo-tab-chat-messages textarea {
    width: 100%;
    box-sizing: border-box;
}

#nemo-tab-chat-messages .flex-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Buttons should maintain natural size */
#nemo-tab-chat-messages .menu_button {
    width: auto;
    flex-shrink: 0;
}

/* Only allow flex growth for elements marked with flex1 */
#nemo-tab-chat-messages .flex1 {
    flex: 1;
}

/* Fix the range sliders in chat messages */
#nemo-tab-chat-messages .flex-container.flexBasis48p {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

#nemo-tab-chat-messages .neo-range-slider {
    width: 100%;
}

#nemo-tab-chat-messages .auto_swipe textarea {
    width: 100%;
    min-height: 80px;
}

/* Fix checkbox containers */
#nemo-tab-chat-messages .checkbox_label {
    display: flex;
    align-items: center;
    gap: 8px;
    width: fit-content;
}

/* Enhanced section styling within tabs */
.nemo-user-settings-tab-content h4 {
    color: var(--nemo-primary-accent);
    border-bottom: 2px solid var(--nemo-border-color);
    padding-bottom: 8px;
    margin-bottom: 15px;
    margin-top: 25px;
}

.nemo-user-settings-tab-content h4:first-child {
    margin-top: 0;
}

/* Improve spacing for form elements in tabs */
.nemo-user-settings-tab-content .flex-container {
    margin-bottom: 12px;
}

.nemo-user-settings-tab-content .checkbox_label {
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Better organization for inline drawers in tabs */
.nemo-user-settings-tab-content .inline-drawer {
    margin: 15px 0;
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    background-color: var(--nemo-secondary-bg);
}

.nemo-user-settings-tab-content .inline-drawer-header {
    background-color: var(--nemo-tertiary-bg);
    border-radius: 6px 6px 0 0;
}

/* Improved button and control spacing */
.nemo-user-settings-tab-content .menu_button {
    margin: 2px;
}

/* Better range slider layout in tabs */
.nemo-user-settings-tab-content .neo-range-slider,
.nemo-user-settings-tab-content .neo-range-input {
    margin: 5px 0;
}

/* Ensure all container elements expand to fill available space */
.nemo-user-settings-tab-content > * {
    width: 100%;
}

/* Specific width fixes for form elements */
.nemo-user-settings-tab-content select,
.nemo-user-settings-tab-content input[type="text"],
.nemo-user-settings-tab-content input[type="number"],
.nemo-user-settings-tab-content textarea {
    max-width: 100%;
    box-sizing: border-box;
}

/* Fix flex containers in tabs */
.nemo-user-settings-tab-content .flex-container {
    width: 100%;
    box-sizing: border-box;
}

/* Ensure textarea in Custom CSS expands properly */
#nemo-tab-ui-theme #customCSS {
    width: 100%;
    min-height: 200px;
    resize: vertical;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Mobile responsive tabs and layouts */
@media (max-width: 768px) {
    .nemo-user-settings-tabs {
        flex-direction: column;
    }
    
    .nemo-user-settings-tab {
        border-right: none;
        border-bottom: 1px solid var(--nemo-border-color);
        padding: 10px 15px;
    }
    
    .nemo-user-settings-tab:last-child {
        border-bottom: none;
    }
    
    /* Mobile: Single column layouts for all tabs */
    #nemo-tab-ui-theme.active {
        gap: 20px;
    }
    
    .nemo-ui-theme-main-content {
        grid-template-columns: 1fr !important;
        gap: 20px;
    }
    
    #nemo-tab-ui-theme [name="FontBlurChatWidthBlock"] {
        flex-direction: column;
    }
    
    #nemo-tab-ui-theme [name="FontBlurChatWidthBlock"] .flex-container {
        min-width: unset;
        width: 100%;
    }
    
    #nemo-tab-character-handling.active {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    #nemo-tab-character-handling [name="CharacterHandlingToggles"] {
        grid-column: 1;
    }
    
    #nemo-tab-character-handling [name="MiscellaneousToggles"] {
        grid-column: 1;
    }
    
    #nemo-tab-chat-messages.active {
        grid-template-columns: 1fr;
        gap: 20px;
    }
}

/* Tablet responsive design */
@media (min-width: 769px) and (max-width: 1024px) {
    /* Tablet: Keep two columns but with smaller gaps */
    #nemo-tab-ui-theme.active {
        gap: 20px;
    }
    
    .nemo-ui-theme-main-content {
        gap: 20px;
    }
    
    #nemo-tab-character-handling.active {
        gap: 20px;
    }
    
    #nemo-tab-chat-messages.active {
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
    }
}

/* Large screen optimizations */
@media (min-width: 1200px) {
    /* Large screens: Allow more columns for chat messages */
    #nemo-tab-chat-messages.active {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 40px;
    }
    
    #nemo-tab-ui-theme.active {
        gap: 30px;
    }
    
    .nemo-ui-theme-main-content {
        gap: 40px;
    }
    
    #nemo-tab-character-handling.active {
        gap: 40px;
    }
}

/* === ADDITIONAL THEME VARIATIONS === */

/* --- Classic Theme --- */
body.theme-classic .mes_block {
    border-radius: 15px;
    border: 1px solid var(--nemo-border-color);
    background-color: var(--nemo-secondary-bg);
    padding: 10px 15px;
    margin-bottom: 10px;
    box-shadow: 0 2px 4px var(--nemo-shadow-color);
}

body.theme-classic .mes_block.is_user {
    background-color: var(--nemo-tertiary-bg);
}

body.theme-classic .mes_block .ch_name {
    padding-bottom: 5px;
    border-bottom: 1px solid var(--nemo-border-color);
    margin-bottom: 10px;
}

/* --- Terminal Theme --- */
body.theme-terminal #chat {
    background-color: #0a0a0a;
    font-family: 'Courier New', Courier, monospace;
    border: 2px solid #333;
    border-radius: 5px;
    padding: 10px;
}

body.theme-terminal .mes_block {
    background-color: transparent;
    border: none;
    border-radius: 0;
    padding: 2px 5px;
    margin-bottom: 0;
    box-shadow: none;
}

body.theme-terminal .mes_block .ch_name .name_text {
    color: #00ff00;
}
body.theme-terminal .mes_block .ch_name .name_text::after {
    content: ':~#';
    margin-left: 5px;
}

body.theme-terminal .mes_block.is_user .ch_name .name_text {
    color: #00ffff;
}

body.theme-terminal .mes_block .mes_text {
    color: #f0f0f0;
}

body.theme-terminal .mes_block .ch_name .timestamp {
    color: #888;
}

body.theme-terminal .mes_block .avatar {
    display: none;
}

/* === ARCHIVE NAVIGATOR STYLES === */

/* Archive Navigator Dialog */
.nemo-archive-overlay {
    background-color: rgba(0, 0, 0, 0.8);
    z-index: var(--z-notification);
}

.nemo-archive-dialog {
    background: var(--nemo-primary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    max-width: 90vw;
    max-height: 90vh;
    width: 1200px;
    height: 800px;
    margin: 5vh auto;
    display: flex;
    flex-direction: column;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    position: relative;
}

.nemo-archive-header {
    background: var(--nemo-secondary-bg);
    padding: 15px 20px;
    border-bottom: 1px solid var(--nemo-border-color);
    border-radius: 8px 8px 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    z-index: var(--z-controls);
}

.nemo-archive-header h2 {
    margin: 0;
    font-size: 18px;
    color: var(--nemo-text-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.nemo-archive-header h2 i {
    color: var(--nemo-primary-accent);
}

.nemo-archive-stats {
    font-size: 12px;
    color: var(--nemo-text-muted);
}

.nemo-archive-toolbar {
    padding: 15px 20px;
    border-bottom: 1px solid var(--nemo-border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    background: var(--nemo-tertiary-bg);
}

.nemo-archive-toolbar-left,
.nemo-archive-toolbar-right {
    display: flex;
    align-items: center;
    gap: 10px;
}

.nemo-archive-toolbar-center {
    flex: 1;
    display: flex;
    justify-content: center;
}

.nemo-archive-search {
    width: 300px;
    padding: 8px 12px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 4px;
    background: var(--nemo-primary-bg);
    color: var(--nemo-text-color);
    font-size: 14px;
}

.nemo-archive-sort {
    padding: 6px 10px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 4px;
    background: var(--nemo-primary-bg);
    color: var(--nemo-text-color);
    font-size: 13px;
}

.nemo-archive-body {
    flex: 1;
    display: flex;
    overflow: hidden;
}

.nemo-archive-sidebar {
    width: 250px;
    background: var(--nemo-secondary-bg);
    border-right: 1px solid var(--nemo-border-color);
    overflow-y: auto;
    padding: 15px 0;
}

.nemo-archive-main {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: var(--nemo-primary-bg);
}

/* Folder Sidebar */
.nemo-folder-list {
    padding: 0 15px;
}

.nemo-folder-item {
    padding: 10px 12px;
    margin-bottom: 2px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background-color 0.2s;
    position: relative;
}

.nemo-folder-item:hover {
    background-color: var(--nemo-tertiary-bg);
}

.nemo-folder-item.active {
    background-color: var(--nemo-primary-accent);
    color: white;
}

.nemo-folder-content {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}

.nemo-folder-name {
    font-size: 14px;
    flex: 1;
}

.nemo-folder-count {
    background: rgba(255, 255, 255, 0.2);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    min-width: 16px;
    text-align: center;
}

.nemo-folder-item.active .nemo-folder-count {
    background: rgba(255, 255, 255, 0.3);
}

.nemo-folder-star {
    color: #ffd700;
    font-size: 10px;
}

.nemo-folder-actions {
    display: none;
    gap: 4px;
}

.nemo-folder-item:hover .nemo-folder-actions {
    display: flex;
}

.nemo-folder-action {
    padding: 4px;
    background: none;
    border: none;
    color: var(--nemo-text-muted);
    cursor: pointer;
    border-radius: 3px;
    font-size: 12px;
    opacity: 0.7;
}

.nemo-folder-action:hover {
    opacity: 1;
    background: rgba(255, 255, 255, 0.1);
}

.nemo-folder-divider {
    height: 1px;
    background: var(--nemo-border-color);
    margin: 10px 0;
}

/* Prompt Grid - OLD STYLES scoped to .nemo-prompt-grid only to avoid conflict with tray cards */
.nemo-prompt-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 15px;
}

.nemo-prompt-grid .nemo-prompt-card {
    background: var(--nemo-secondary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    padding: 15px;
    transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
    cursor: pointer;
}

.nemo-prompt-grid .nemo-prompt-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    border-color: var(--nemo-primary-accent);
}

.nemo-prompt-grid .nemo-prompt-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 10px;
}

.nemo-prompt-grid .nemo-prompt-card-title {
    font-weight: 600;
    font-size: 14px;
    color: var(--nemo-text-color);
    flex: 1;
    line-height: 1.3;
}

.nemo-prompt-grid .nemo-prompt-card-actions {
    display: flex;
    gap: 4px;
    margin-left: 10px;
}

.nemo-prompt-grid .nemo-prompt-action {
    padding: 6px;
    background: none;
    border: none;
    color: var(--nemo-text-muted);
    cursor: pointer;
    border-radius: 4px;
    font-size: 12px;
    opacity: 0.7;
    transition: all 0.2s;
}

.nemo-prompt-grid .nemo-prompt-action:hover {
    opacity: 1;
    background: var(--nemo-tertiary-bg);
}

.nemo-prompt-grid .nemo-prompt-card .nemo-favorite-btn {
    position: relative;
    background: none;
    border: none;
    color: #ccc;
    cursor: pointer;
    transition: color 0.2s;
    z-index: var(--z-base);
}

.nemo-prompt-grid .nemo-prompt-card .nemo-favorite-btn.active {
    color: #ffd700;
    opacity: 1;
}

.nemo-prompt-grid .nemo-prompt-card .nemo-favorite-btn:hover {
    color: #ffd700;
}

.nemo-prompt-grid .nemo-prompt-tags {
    margin-bottom: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.nemo-prompt-grid .nemo-tag {
    background: var(--nemo-tertiary-bg);
    color: var(--nemo-text-color);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    border: 1px solid var(--nemo-border-color);
}

.nemo-prompt-grid .nemo-prompt-card-preview {
    color: var(--nemo-text-muted);
    font-size: 12px;
    line-height: 1.4;
    margin-bottom: 10px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}

.nemo-prompt-grid .nemo-prompt-card-meta {
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: 10px;
    color: var(--nemo-text-muted);
    border-top: 1px solid var(--nemo-border-color);
    padding-top: 8px;
}

.nemo-empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--nemo-text-muted);
}

.nemo-empty-state i {
    font-size: 48px;
    margin-bottom: 15px;
    color: var(--nemo-primary-accent);
}

.nemo-empty-state h3 {
    margin: 0 0 10px 0;
    color: var(--nemo-text-color);
}

/* Dialog styles for forms */
.nemo-form-group {
    margin-bottom: 15px;
}

.nemo-form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: var(--nemo-text-color);
}

.nemo-dialog-note {
    background: var(--nemo-tertiary-bg);
    padding: 10px 12px;
    border-radius: 4px;
    border: 1px solid var(--nemo-border-color);
    margin-top: 10px;
    font-size: 12px;
    color: var(--nemo-text-muted);
}

.nemo-dialog-note code {
    background: var(--nemo-secondary-bg);
    padding: 2px 4px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 11px;
}

/* Button styles */
.nemo-btn-small {
    padding: 6px 12px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 4px;
    background: var(--nemo-secondary-bg);
    color: var(--nemo-text-color);
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.nemo-btn-small:hover {
    background: var(--nemo-tertiary-bg);
    border-color: var(--nemo-primary-accent);
}

.nemo-btn-primary {
    background: var(--nemo-primary-accent);
    color: white;
    border-color: var(--nemo-primary-accent);
}

.nemo-btn-primary:hover {
    background: var(--nemo-accent-hover);
    border-color: var(--nemo-accent-hover);
}

.nemo-btn-secondary {
    background: var(--nemo-secondary-bg);
    border-color: var(--nemo-border-color);
}

#nemo-toggle-favorites.active {
    background: var(--nemo-primary-accent);
    color: white;
    border-color: var(--nemo-primary-accent);
}

/* Mobile responsive archive navigator */
@media (max-width: 768px) {
    .nemo-archive-dialog {
        width: 95vw;
        height: 95vh;
        margin: 2.5vh auto;
    }

    .nemo-archive-body {
        flex-direction: column;
    }

    .nemo-archive-sidebar {
        width: 100%;
        max-height: 200px;
        border-right: none;
        border-bottom: 1px solid var(--nemo-border-color);
    }

    .nemo-folder-list {
        display: flex;
        overflow-x: auto;
        padding: 10px 15px;
        gap: 10px;
    }

    .nemo-folder-item {
        flex-shrink: 0;
        white-space: nowrap;
    }

    .nemo-archive-toolbar {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
    }

    .nemo-archive-toolbar-left,
    .nemo-archive-toolbar-center,
    .nemo-archive-toolbar-right {
        justify-content: center;
    }

    .nemo-archive-search {
        width: 100%;
    }

    .nemo-prompt-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
}

/* === NAVIGATOR FAVORITES SIDEBAR === */

.navigator-body {
    display: flex;
    flex: 1;
}

.navigator-sidebar {
    width: 200px;
    background: var(--nemo-secondary-bg);
    border-right: 1px solid var(--nemo-border-color);
    padding: 15px;
    overflow-y: auto;
}

.navigator-favorites-section h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: var(--nemo-text-color);
    display: flex;
    align-items: center;
    gap: 8px;
}

.navigator-favorites-section h4 i {
    color: #ffd700;
}

.navigator-favorites-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.navigator-favorite-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: 14px;
    position: relative;
}

.navigator-favorite-item:hover {
    background: var(--nemo-tertiary-bg);
}

.favorite-item-icon {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    background: var(--nemo-tertiary-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: var(--nemo-text-muted);
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
}

.favorite-item-name {
    flex: 1;
    color: var(--nemo-text-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    line-height: 1.3;
    margin-right: 8px;
}

.no-favorites {
    text-align: center;
    color: var(--nemo-text-muted);
    font-size: 11px;
    padding: 20px 10px;
    font-style: italic;
}

.favorite-remove-btn {
    position: absolute;
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--nemo-danger-bg, #dc2626);
    color: white;
    border: none;
    border-radius: 3px;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 10px;
    opacity: 0;
    transition: all 0.2s;
}

.navigator-favorite-item:hover .favorite-remove-btn {
    opacity: 1;
}

.favorite-remove-btn:hover {
    background: var(--nemo-danger-hover, #b91c1c);
    transform: translateY(-50%) scale(1.1);
}

/* Favorite toggle buttons */
.grid-item .nemo-favorite-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7) !important;
    border: none !important;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.2s;
}

.grid-item:hover .nemo-favorite-btn {
    opacity: 1;
}

.nemo-favorite-btn .fa-star.favorite-active {
    color: #ffd700;
}

.nemo-favorite-btn .fa-star {
    color: #ccc;
    font-size: 14px;
}

.nemo-favorite-btn:hover {
    background: rgba(0, 0, 0, 0.9) !important;
    transform: scale(1.1);
}

/* Folder Selection Dialog */
.nemo-folder-selection-dialog .nemo-dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: var(--z-popup);
}

.nemo-folder-selection-dialog .nemo-dialog-content {
    background: var(--nemo-secondary-bg);
    border-radius: 8px;
    width: 400px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.nemo-folder-selection-dialog .nemo-dialog-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--nemo-border-color);
}

.nemo-folder-selection-dialog .nemo-dialog-header h3 {
    margin: 0;
    color: var(--nemo-text-color);
}

.nemo-folder-selection-dialog .nemo-dialog-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--nemo-text-color);
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nemo-folder-selection-dialog .nemo-dialog-body {
    padding: 20px;
}

.nemo-folder-list {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
}

.nemo-folder-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    cursor: pointer;
    transition: background-color 0.2s;
    border-bottom: 1px solid var(--nemo-border-color);
}

.nemo-folder-option:last-child {
    border-bottom: none;
}

.nemo-folder-option:hover {
    background: var(--nemo-item-hover-bg);
}

.nemo-folder-option.selected {
    background: var(--nemo-primary-accent);
    color: white;
}

.nemo-folder-option i:first-child {
    width: 16px;
    text-align: center;
}

.nemo-folder-option span {
    flex: 1;
}

.nemo-custom-badge {
    background: var(--nemo-primary-accent);
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.75em;
    font-weight: bold;
}

.nemo-folder-option .fa-check {
    color: white;
    margin-left: auto;
}

/* Update existing folder badge styles */
.nemo-card-folder {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.nemo-folder-badge {
    background: var(--nemo-tertiary-bg);
    color: var(--nemo-text-color);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75em;
    border: 1px solid var(--nemo-border-color);
}

.nemo-folder-badge.nemo-custom-folder {
    background: var(--nemo-primary-accent);
    color: white;
    border-color: var(--nemo-primary-accent);
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
    .nemo-folder-selection-dialog .nemo-dialog-content {
        width: 90%;
        max-width: 350px;
    }
    
    .navigator-sidebar {
        width: 150px;
        padding: 10px;
    }
    
    .navigator-favorites-section h4 {
        font-size: 12px;
    }
    
    .navigator-favorite-item {
        font-size: 12px;
        padding: 6px 8px;
    }
    
    .favorite-remove-btn {
        width: 18px;
        height: 18px;
        font-size: 9px;
    }
    
    .favorite-item-icon {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }
}

/* === ADVANCED FORMATTING TABS === */

/* Search container */
.nemo-advanced-formatting-search {
    margin-bottom: 10px;
    padding: 10px;
    background: var(--nemo-secondary-bg);
    border-radius: 8px;
    border: 1px solid var(--nemo-border-color);
}

/* Extensions Tab Overhaul */
.nemo-extensions-search .text_pole {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid var(--nemo-border-color);
    border-radius: 4px;
    background: var(--nemo-tertiary-bg);
    color: var(--nemo-text-color);
    font-size: 14px;
}

.nemo-extension-category-drawer .inline-drawer-header {
    background-color: var(--nemo-secondary-bg);
    border-radius: 4px;
    margin-bottom: 10px;
}

.nemo-extension-category-drawer .inline-drawer-content {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
}

/* Tab navigation */
.nemo-advanced-formatting-tabs {
    display: flex;
    background: var(--nemo-primary-bg);
    border-radius: 8px 8px 0 0;
    border: 1px solid var(--nemo-border-color);
    border-bottom: none;
    overflow-x: auto;
    scrollbar-width: thin;
    margin-bottom: 0;
}

.nemo-advanced-formatting-tabs::-webkit-scrollbar {
    height: 4px;
}

.nemo-advanced-formatting-tabs::-webkit-scrollbar-track {
    background: var(--nemo-tertiary-bg);
}

.nemo-advanced-formatting-tabs::-webkit-scrollbar-thumb {
    background: var(--nemo-border-color);
    border-radius: 2px;
}

.nemo-advanced-formatting-tab {
    flex: 1;
    min-width: 150px;
    padding: 12px 16px;
    background: transparent;
    border: none;
    color: var(--nemo-text-muted);
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 3px solid transparent;
    position: relative;
}

.nemo-advanced-formatting-tab:hover {
    background: var(--nemo-item-hover-bg);
    color: var(--nemo-text-color);
}

.nemo-advanced-formatting-tab.active {
    color: var(--nemo-primary-accent);
    border-bottom-color: var(--nemo-primary-accent);
    background: var(--nemo-tertiary-bg);
    font-weight: 500;
}

.nemo-advanced-formatting-tab i {
    font-size: 16px;
}

/* Tab content */
.nemo-advanced-formatting-tab-content {
    display: none;
    padding: 20px;
    background: var(--nemo-tertiary-bg);
    border: 1px solid var(--nemo-border-color);
    border-top: none;
    border-radius: 0 0 8px 8px;
    min-height: 200px;
}

.nemo-advanced-formatting-tab-content.active {
    display: block;
}

/* Make tab content columns use full width */
.nemo-advanced-formatting-tab-content > #ContextSettings,
.nemo-advanced-formatting-tab-content > #InstructSettingsColumn,
.nemo-advanced-formatting-tab-content > #SystemPromptColumn {
    flex: 1;
    width: 100%;
    max-width: 100%;
}

/* Search results */
.nemo-search-results-container {
    display: none;
    padding: 15px;
    background: var(--nemo-tertiary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 8px;
    max-height: 600px;
    overflow-y: auto;
}

.nemo-search-results-header {
    padding-bottom: 15px;
    border-bottom: 1px solid var(--nemo-border-color);
    margin-bottom: 15px;
}

.nemo-search-results-header h4 {
    margin: 0;
    color: var(--nemo-text-color);
    font-size: 16px;
    font-weight: 500;
}

.nemo-search-result-item {
    margin-bottom: 20px;
    padding: 15px;
    background: var(--nemo-secondary-bg);
    border: 1px solid var(--nemo-border-color);
    border-radius: 6px;
    border-left: 4px solid var(--nemo-primary-accent);
}

.nemo-search-result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--nemo-border-color);
}

.nemo-search-result-tab {
    font-weight: 600;
    font-size: 11px;
    color: var(--nemo-primary-accent);
    letter-spacing: 0.5px;
}

.nemo-search-result-relevance {
    font-size: 11px;
    color: var(--nemo-text-muted);
    background: var(--nemo-primary-bg);
    padding: 2px 6px;
    border-radius: 10px;
}

.nemo-no-results {
    text-align: center;
    padding: 40px 20px;
    color: var(--nemo-text-muted);
}

.nemo-no-results i {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
}

.nemo-no-results p {
    font-size: 16px;
    margin: 0;
}

/* Mobile responsiveness for Advanced Formatting tabs */
@media (max-width: 768px) {
    .nemo-advanced-formatting-tabs {
        flex-wrap: wrap;
    }
    
    .nemo-advanced-formatting-tab {
        min-width: calc(50% - 1px);
        font-size: 12px;
        padding: 10px 12px;
    }
    
    .nemo-advanced-formatting-tab i {
        font-size: 14px;
    }
    
    .nemo-advanced-formatting-tab-content {
        padding: 15px;
    }
    
    .nemo-search-result-item {
        padding: 12px;
    }
    
    .nemo-search-results-container {
        padding: 12px;
        max-height: 400px;
    }
}

/* === CUSTOM FOLDER DELETE ICON === */
.nemo-folder-delete {
    transition: all 0.2s ease;
    padding: 2px;
    border-radius: 3px;
}

.nemo-folder-delete:hover {
    opacity: 1 !important;
    color: #ff4757 !important;
    background-color: rgba(255, 71, 87, 0.1);
    transform: scale(1.1);
}

/* === PRESET SEARCH CONTAINER STYLING === */
/* Removed conflicting styles - now handled in main search controls section */

#nemo-drawer-openai_sampling_specific > div:nth-child(1) {
    margin: 5px 0px 0px 0px !important;
}

/* === FOLDER BUTTON STYLING === */
.nemo-folder-button {
    background: var(--SmartThemeBotMesBlurTintColor, #2a2a2a);
    border: 1px solid var(--SmartThemeBorderColor, #444);
    color: var(--SmartThemeBodyColor, #ffffff);
    padding: 6px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85em;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    min-height: 28px;
}

.nemo-folder-button:hover {
    background: var(--SmartThemeQuoteColor, #4a9eff);
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.nemo-folder-button:active {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.nemo-folder-button i {
    font-size: 14px;
}

/* === PROMPT RESTORATION TOAST NOTIFICATION === */
.nemo-prompt-restoration-toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--SmartThemeBotMesBlurTintColor, #2a2a2a);
    border: 1px solid var(--SmartThemeQuoteColor, #4a9eff);
    border-left: 4px solid var(--SmartThemeQuoteColor, #4a9eff);
    color: var(--SmartThemeBodyColor, #ffffff);
    padding: 14px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 0 20px rgba(74, 158, 255, 0.2);
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 0.95em;
    z-index: var(--z-popup);
    opacity: 0;
    transform: translateX(400px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    max-width: 400px;
    backdrop-filter: blur(10px);
}

.nemo-prompt-restoration-toast.show {
    opacity: 1;
    transform: translateX(0);
}

.nemo-prompt-restoration-toast i {
    font-size: 1.3em;
    color: var(--SmartThemeQuoteColor, #4a9eff);
    flex-shrink: 0;
}

.nemo-prompt-restoration-toast span {
    line-height: 1.4;
}

/* Animation for multiple toasts */
.nemo-prompt-restoration-toast:not(:first-of-type) {
    margin-bottom: 10px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .nemo-prompt-restoration-toast {
        bottom: 20px;
        right: 20px;
        left: 20px;
        max-width: none;
    }
}

/* === PROMPT TOOLTIP STYLING === */
/* Enhanced tooltips for prompt descriptions */
.nemo-has-tooltip {
    cursor: help;
    position: relative;
    border-bottom: 1px dotted var(--SmartThemeQuoteColor, #4a9eff);
}

.nemo-has-tooltip:hover {
    color: var(--SmartThemeQuoteColor, #4a9eff);
    transition: color 0.2s ease;
}

/* === WORLD INFO MODAL STYLING === */
.nemo-modal {
    display: none;
    position: fixed;
    z-index: var(--z-modal);
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
}

.nemo-modal-content {
    background-color: var(--SmartThemeBodyColor, #222);
    margin: 5% auto;
    padding: 20px;
    border: 1px solid var(--nemo-border-color, #444);
    border-radius: 8px;
    width: 80%;
    max-width: 800px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.nemo-modal-close {
    color: var(--nemo-text-medium-contrast, #aaa);
    float: right;
    font-size: 28px;
    font-weight: bold;
    line-height: 20px;
    cursor: pointer;
    transition: color 0.2s;
}

.nemo-modal-close:hover,
.nemo-modal-close:focus {
    color: var(--SmartThemeQuoteColor, #4a9eff);
}

#nemo-macro-picker-list {
    margin-top: 20px;
}

.nemo-macro-picker-group {
    margin-bottom: 20px;
}

.nemo-macro-picker-group-header {
    color: var(--SmartThemeQuoteColor, #4a9eff);
    font-weight: bold;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--nemo-border-color, #444);
}

.nemo-macro-picker-item {
    padding: 8px 12px;
    margin: 5px 0;
    background: var(--black30a, rgba(0, 0, 0, 0.3));
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.2s;
}

.nemo-macro-picker-item:hover {
    background: var(--black50a, rgba(0, 0, 0, 0.5));
}

/* === DIRECTIVE SYSTEM UI === */

/* Visual Directive Features - Colors */
.completion_prompt_manager_prompt.nemo-has-color {
    border-left: 4px solid var(--nemo-prompt-color) !important;
    padding-left: 8px !important;
}

/* Toast Notifications */
.nemo-directive-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    min-width: 350px;
    max-width: 500px;
    background: linear-gradient(135deg, rgba(40, 40, 50, 0.98) 0%, rgba(30, 30, 40, 0.98) 100%);
    border: 2px solid rgba(74, 158, 255, 0.6);
    border-radius: 8px;
    padding: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    z-index: var(--z-directive-toast, 9999);
    animation: nemo-toast-slide-in 0.3s ease-out;
}

@keyframes nemo-toast-slide-in {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.nemo-toast-removing {
    animation: nemo-toast-slide-out 0.3s ease-out forwards;
}

@keyframes nemo-toast-slide-out {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}

.nemo-toast-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.nemo-toast-icon {
    font-size: 20px;
}

.nemo-toast-error {
    color: #ff6b6b;
}

.nemo-toast-warning {
    color: #ffa500;
}

.nemo-toast-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--nemo-text-high-contrast, #ffffff);
}

.nemo-toast-body {
    margin-bottom: 16px;
    max-height: 300px;
    overflow-y: auto;
}

.nemo-toast-issue {
    padding: 8px 12px;
    margin-bottom: 8px;
    border-radius: 4px;
    font-size: 14px;
    line-height: 1.5;
}

.nemo-toast-issue-error {
    background: rgba(255, 107, 107, 0.15);
    border-left: 3px solid #ff6b6b;
    color: var(--nemo-text-medium-contrast, #e0e0e0);
}

.nemo-toast-issue-warning {
    background: rgba(255, 165, 0, 0.15);
    border-left: 3px solid #ffa500;
    color: var(--nemo-text-medium-contrast, #e0e0e0);
}

.nemo-toast-issue strong {
    color: var(--nemo-text-high-contrast, #ffffff);
}

.nemo-toast-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}

.nemo-toast-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-toast-btn-primary {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.8) 0%, rgba(74, 158, 255, 0.6) 100%);
    color: #ffffff;
}

.nemo-toast-btn-primary:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 1) 0%, rgba(74, 158, 255, 0.8) 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
}

.nemo-toast-btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--nemo-text-medium-contrast, #e0e0e0);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.nemo-toast-btn-secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
}

/* Message Trigger Toast */
.nemo-message-trigger-toast {
    border-color: rgba(100, 200, 255, 0.6) !important;
}

.nemo-message-trigger-toast .nemo-toast-header {
    border-bottom-color: rgba(100, 200, 255, 0.3);
}

.nemo-toast-dismiss {
    background: none;
    border: none;
    color: var(--nemo-text-medium-contrast, #aaa);
    cursor: pointer;
    font-size: 18px;
    padding: 0;
    margin-left: auto;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.nemo-toast-dismiss:hover {
    opacity: 1;
}

.nemo-trigger-section {
    margin-bottom: 8px;
}

.nemo-trigger-section:last-child {
    margin-bottom: 0;
}

.nemo-trigger-enabled {
    color: #51cf66;
}

.nemo-trigger-disabled {
    color: #ff6b6b;
}

.nemo-trigger-list {
    list-style: none;
    padding: 4px 0 0 12px;
    margin: 0;
}

.nemo-trigger-list li {
    padding: 2px 0;
    font-size: 13px;
    color: var(--nemo-text-medium-contrast, #ccc);
    cursor: help;
}

.nemo-trigger-list li::before {
    content: "•";
    margin-right: 6px;
    opacity: 0.5;
}

/* Directive Help Icon */
.nemo-directive-help {
    display: inline;
    margin-left: 4px;
}

.nemo-help-icon {
    display: inline-block;
    font-size: 14px;
    text-decoration: none;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.nemo-help-icon:hover {
    opacity: 1;
}

/* Directive Help Button (fallback if label not found) */
.nemo-directive-help-button {
    display: block;
    margin-bottom: 8px;
    padding: 6px 12px;
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.2) 0%, rgba(74, 158, 255, 0.1) 100%);
    border: 1px solid rgba(74, 158, 255, 0.4);
    border-radius: 4px;
    color: var(--nemo-text-high-contrast, #ffffff);
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.nemo-directive-help-button:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.3) 0%, rgba(74, 158, 255, 0.15) 100%);
    border-color: rgba(74, 158, 255, 0.6);
    transform: translateY(-1px);
}

/* Directive Help Modal */
.nemo-directive-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: var(--z-directive-modal, 10000);
    animation: nemo-modal-fade-in 0.3s ease-out;
}

@keyframes nemo-modal-fade-in {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.nemo-modal-removing {
    animation: nemo-modal-fade-out 0.3s ease-out forwards;
}

@keyframes nemo-modal-fade-out {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

.nemo-modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
}

.nemo-directive-modal .nemo-modal-content {
    position: relative;
    margin: 5% auto;
    width: 90%;
    max-width: 900px;
    max-height: 85vh;
    background: linear-gradient(135deg, rgba(40, 40, 50, 0.98) 0%, rgba(30, 30, 40, 0.98) 100%);
    border: 2px solid rgba(74, 158, 255, 0.4);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.nemo-directive-modal .nemo-modal-header {
    padding: 20px 24px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(74, 158, 255, 0.05) 100%);
}

.nemo-directive-modal .nemo-modal-header h3 {
    margin: 0;
    color: var(--nemo-text-high-contrast, #ffffff);
    font-size: 20px;
    font-weight: 600;
}

.nemo-directive-modal .nemo-modal-close {
    position: absolute;
    top: 16px;
    right: 20px;
    font-size: 32px;
    font-weight: bold;
    color: var(--nemo-text-medium-contrast, #aaa);
    background: none;
    border: none;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s, transform 0.2s;
    float: none;
}

.nemo-directive-modal .nemo-modal-close:hover {
    color: var(--SmartThemeQuoteColor, #4a9eff);
    transform: scale(1.1);
}

.nemo-directive-modal .nemo-modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.nemo-directive-modal .nemo-modal-body h1 {
    color: var(--SmartThemeQuoteColor, #4a9eff);
    font-size: 24px;
    margin-top: 24px;
    margin-bottom: 12px;
}

.nemo-directive-modal .nemo-modal-body h2 {
    color: var(--nemo-text-high-contrast, #ffffff);
    font-size: 20px;
    margin-top: 20px;
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.nemo-directive-modal .nemo-modal-body h3 {
    color: var(--nemo-text-medium-contrast, #e0e0e0);
    font-size: 16px;
    margin-top: 16px;
    margin-bottom: 8px;
}

.nemo-directive-modal .nemo-modal-body code {
    background: rgba(0, 0, 0, 0.3);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    color: #88c0d0;
}

.nemo-directive-modal .nemo-modal-body pre {
    background: rgba(0, 0, 0, 0.4);
    padding: 12px;
    border-radius: 6px;
    border-left: 3px solid rgba(74, 158, 255, 0.6);
    overflow-x: auto;
    margin: 12px 0;
}

.nemo-directive-modal .nemo-modal-body pre code {
    background: none;
    padding: 0;
    color: #d8dee9;
}

.nemo-directive-modal .nemo-modal-body strong {
    color: var(--nemo-text-high-contrast, #ffffff);
    font-weight: 600;
}

.nemo-directive-modal .nemo-modal-body hr {
    border: none;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin: 20px 0;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .nemo-directive-toast {
        right: 10px;
        left: 10px;
        min-width: unset;
    }

    .nemo-directive-modal .nemo-modal-content {
        width: 95%;
        margin: 2% auto;
        max-height: 95vh;
    }

    .nemo-toast-actions {
        flex-direction: column;
    }

    .nemo-toast-btn {
        width: 100%;
    }
}

/* === DIRECTIVE AUTOCOMPLETE === */

.nemo-autocomplete-dropdown {
    position: fixed;
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.98) 0%, rgba(20, 20, 30, 0.98) 100%);
    border: 2px solid rgba(74, 158, 255, 0.5);
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
    max-height: 400px;
    min-width: 300px;
    max-width: 500px;
    overflow-y: auto;
    z-index: var(--z-directive-modal, 10000);
    backdrop-filter: blur(8px);
    animation: nemo-ac-fade-in 0.15s ease-out;
}

@keyframes nemo-ac-fade-in {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.nemo-autocomplete-item {
    padding: 10px 12px;
    cursor: pointer;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    transition: background 0.1s ease;
}

.nemo-autocomplete-item:hover {
    background: rgba(74, 158, 255, 0.15);
}

.nemo-autocomplete-item.selected {
    background: linear-gradient(90deg, rgba(74, 158, 255, 0.25) 0%, rgba(74, 158, 255, 0.15) 100%);
    border-left: 3px solid rgba(74, 158, 255, 0.8);
    padding-left: 9px;
}

.nemo-ac-item-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
}

.nemo-ac-icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
    flex-shrink: 0;
}

.nemo-ac-icon-directive {
    color: rgba(74, 158, 255, 0.9);
    font-weight: bold;
}

.nemo-ac-icon-prompt {
    opacity: 0.7;
}

.nemo-ac-icon-macro {
    color: rgba(100, 200, 100, 0.9);
    font-weight: bold;
    font-size: 14px;
}

.nemo-ac-icon-variable {
    color: rgba(255, 200, 100, 0.9);
    font-weight: bold;
}

.nemo-ac-icon-value {
    color: rgba(150, 255, 150, 0.9);
    font-weight: bold;
}

.nemo-ac-text {
    font-family: 'Courier New', monospace;
    font-size: 13px;
    color: var(--nemo-text-high-contrast, #ffffff);
    font-weight: 500;
}

.nemo-ac-description {
    font-size: 12px;
    color: var(--nemo-text-medium-contrast, #b0b0b0);
    margin-left: 28px;
    line-height: 1.3;
}

.nemo-ac-footer {
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 11px;
    color: var(--nemo-text-low-contrast, #888);
    display: flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
}

.nemo-ac-footer kbd {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 3px;
    padding: 2px 6px;
    font-family: monospace;
    font-size: 10px;
    color: var(--nemo-text-medium-contrast, #e0e0e0);
}

/* Scrollbar styling for autocomplete */
.nemo-autocomplete-dropdown::-webkit-scrollbar {
    width: 8px;
}

.nemo-autocomplete-dropdown::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.nemo-autocomplete-dropdown::-webkit-scrollbar-thumb {
    background: rgba(74, 158, 255, 0.4);
    border-radius: 4px;
}

.nemo-autocomplete-dropdown::-webkit-scrollbar-thumb:hover {
    background: rgba(74, 158, 255, 0.6);
}

/* ===== ADVANCED DIRECTIVE FEATURES STYLES ===== */

/* Tag Filter */
.nemo-tag-filter {
    margin: 15px 0;
    padding: 15px;
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.95) 0%, rgba(20, 20, 30, 0.95) 100%);
    border-radius: 8px;
    border: 1px solid rgba(74, 158, 255, 0.3);
}

.nemo-search-input {
    width: 100%;
    padding: 12px 16px;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(74, 158, 255, 0.4);
    border-radius: 6px;
    color: #ffffff;
    font-size: 14px;
    transition: all 0.3s ease;
}

.nemo-search-input:focus {
    outline: none;
    border-color: rgba(74, 158, 255, 0.8);
    background: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 15px rgba(74, 158, 255, 0.3);
}

.nemo-search-input::placeholder {
    color: rgba(255, 255, 255, 0.4);
}

.nemo-tag-list {
    margin-top: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.nemo-tag-button {
    padding: 6px 12px;
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.2) 0%, rgba(100, 180, 255, 0.2) 100%);
    border: 1px solid rgba(74, 158, 255, 0.4);
    border-radius: 20px;
    color: #ffffff;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.nemo-tag-button:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.4) 0%, rgba(100, 180, 255, 0.4) 100%);
    border-color: rgba(74, 158, 255, 0.6);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
}

.nemo-tag-button .tag-count {
    background: rgba(255, 255, 255, 0.2);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: bold;
}

.nemo-filter-stats {
    margin-top: 10px;
    text-align: center;
    color: rgba(255, 255, 255, 0.6);
    font-size: 12px;
    font-style: italic;
}

/* Group Collapse */
.nemo-group-header {
    margin: 20px 0 10px 0;
    padding: 12px;
    background: linear-gradient(135deg, rgba(50, 50, 70, 0.9) 0%, rgba(40, 40, 60, 0.9) 100%);
    border-radius: 8px;
    border-left: 4px solid rgba(74, 158, 255, 0.6);
}

.nemo-group-toggle {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
    background: none;
    border: none;
    color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    padding: 0;
    transition: all 0.3s ease;
}

.nemo-group-toggle:hover {
    color: rgba(74, 158, 255, 1);
}

.nemo-group-icon {
    font-size: 14px;
    transition: transform 0.3s ease;
}

.nemo-group-name {
    flex: 1;
    text-align: left;
}

.nemo-group-count {
    color: rgba(255, 255, 255, 0.5);
    font-size: 14px;
    font-weight: normal;
}

.nemo-group-description {
    margin-top: 8px;
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 13px;
    line-height: 1.5;
}

.nemo-group-container {
    max-height: 10000px;
    overflow: hidden;
    transition: max-height 0.5s ease, opacity 0.3s ease;
    opacity: 1;
}

.nemo-group-container.collapsed {
    max-height: 0;
    opacity: 0;
}

/* Token Cost Tracker */
.nemo-token-tracker {
    margin: 15px 0;
    padding: 15px;
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.95) 0%, rgba(20, 20, 30, 0.95) 100%);
    border-radius: 8px;
    border: 1px solid rgba(74, 158, 255, 0.3);
}

.nemo-token-display {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.nemo-token-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 13px;
}

.nemo-token-value {
    color: #44ff88;
    font-size: 18px;
    font-weight: bold;
    font-family: 'Courier New', monospace;
}

.nemo-token-warn {
    color: #ff4444;
    font-size: 12px;
    font-weight: bold;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.nemo-token-bar {
    width: 100%;
    height: 8px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    overflow: hidden;
}

.nemo-token-fill {
    height: 100%;
    background: #44ff88;
    transition: width 0.5s ease, background 0.5s ease;
    border-radius: 4px;
}

/* Profile System */
.nemo-profile-manager {
    margin: 15px 0;
    padding: 15px;
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.95) 0%, rgba(20, 20, 30, 0.95) 100%);
    border-radius: 8px;
    border: 1px solid rgba(74, 158, 255, 0.3);
}

.nemo-profile-header {
    margin-bottom: 10px;
}

.nemo-profile-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: bold;
}

.nemo-profile-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.nemo-profile-button {
    padding: 10px 20px;
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.3) 0%, rgba(100, 180, 255, 0.3) 100%);
    border: 2px solid rgba(74, 158, 255, 0.5);
    border-radius: 6px;
    color: #ffffff;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.nemo-profile-button:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.5) 0%, rgba(100, 180, 255, 0.5) 100%);
    border-color: rgba(74, 158, 255, 0.8);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
}

.nemo-profile-button:active {
    transform: translateY(0);
}

/* Help Panel */
.nemo-help-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.nemo-help-panel.hidden {
    opacity: 0;
    pointer-events: none;
}

.nemo-help-content {
    max-width: 800px;
    max-height: 80vh;
    width: 90%;
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.98) 0%, rgba(20, 20, 30, 0.98) 100%);
    border: 2px solid rgba(74, 158, 255, 0.5);
    border-radius: 12px;
    padding: 30px;
    position: relative;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.nemo-help-close {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 40px;
    height: 40px;
    background: rgba(255, 70, 70, 0.3);
    border: 2px solid rgba(255, 70, 70, 0.5);
    border-radius: 50%;
    color: #ffffff;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nemo-help-close:hover {
    background: rgba(255, 70, 70, 0.5);
    border-color: rgba(255, 70, 70, 0.8);
    transform: rotate(90deg);
}

.nemo-help-body h2 {
    color: rgba(74, 158, 255, 1);
    font-size: 24px;
    margin-bottom: 20px;
}

.nemo-help-body h3 {
    color: rgba(100, 200, 255, 1);
    font-size: 18px;
    margin-top: 20px;
    margin-bottom: 10px;
}

.nemo-help-section {
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    border-left: 3px solid rgba(74, 158, 255, 0.5);
}

.nemo-help-section p {
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.6;
    margin: 0;
}

.nemo-help-section pre {
    background: rgba(0, 0, 0, 0.5);
    padding: 15px;
    border-radius: 6px;
    overflow-x: auto;
    color: #44ff88;
    font-family: 'Courier New', monospace;
}

.nemo-help-link {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.3) 0%, rgba(100, 180, 255, 0.3) 100%);
    border: 2px solid rgba(74, 158, 255, 0.5);
    border-radius: 6px;
    color: #ffffff;
    text-decoration: none;
    font-weight: bold;
    transition: all 0.3s ease;
}

.nemo-help-link:hover {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.5) 0%, rgba(100, 180, 255, 0.5) 100%);
    border-color: rgba(74, 158, 255, 0.8);
    transform: translateY(-2px);
}

.nemo-help-tag {
    display: inline-block;
    padding: 4px 10px;
    background: rgba(74, 158, 255, 0.2);
    border: 1px solid rgba(74, 158, 255, 0.4);
    border-radius: 12px;
    font-size: 12px;
    margin-right: 6px;
}

/* Visual Customizations */
.nemo-prompt-icon {
    font-size: 16px;
    margin-right: 4px;
}

.nemo-prompt-badge {
    display: inline-block;
    padding: 2px 8px;
    margin-left: 8px;
    background: rgba(74, 158, 255, 0.8);
    border-radius: 10px;
    font-size: 10px;
    font-weight: bold;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.nemo-highlighted-prompt {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(100, 180, 255, 0.1) 100%);
    border: 2px solid rgba(74, 158, 255, 0.4) !important;
    box-shadow: 0 0 20px rgba(74, 158, 255, 0.2);
}

.nemo-advanced-prompt {
    border-right: 4px solid rgba(255, 100, 100, 0.6);
}

.nemo-beginner-prompt {
    border-right: 4px solid rgba(100, 255, 100, 0.6);
}

/* Conditional Visibility */
.nemo-conditionally-hidden {
    display: none !important;
}

/* Toast Notifications */
.nemo-toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 15px 25px;
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.98) 0%, rgba(20, 20, 30, 0.98) 100%);
    border: 2px solid rgba(74, 158, 255, 0.5);
    border-radius: 8px;
    color: #ffffff;
    font-size: 14px;
    font-weight: bold;
    z-index: 10002;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.nemo-toast.show {
    opacity: 1;
    transform: translateY(0);
}

.nemo-toast-success {
    border-color: rgba(100, 255, 100, 0.5);
}

.nemo-toast-error {
    border-color: rgba(255, 100, 100, 0.5);
}

.nemo-toast-warning {
    border-color: rgba(255, 200, 100, 0.5);
}

.nemo-toast-info {
    border-color: rgba(74, 158, 255, 0.5);
}
/* === SETTINGS UI STYLES === */
/* Force styles to work in extension view */
#nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-card-header-full,
.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-card-header-full,
.nemo-preset-enhancer-settings .nemo-card-header-full {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.25) 100%) !important;
    border-left: 4px solid var(--SmartThemeQuoteColor) !important;
    padding: 15px 20px !important;
}

#nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-features-grid,
.nemo-extension-view-content .nemo-preset-enhancer-settings .nemo-features-grid,
.nemo-preset-enhancer-settings .nemo-features-grid {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 20px !important;
    margin: 0 !important;
}

@media (max-width: 1024px) {
    .nemo-preset-enhancer-settings .nemo-features-grid {
        grid-template-columns: 1fr !important;
    }
}

/* ==========================================================================
   CONNECTION PROFILE TAB VISUAL ENHANCEMENTS
   ========================================================================== */

/* Main container styling */
#api_button {
    background: linear-gradient(135deg,
        rgba(var(--SmartThemeBotMesColorRGB, 42, 42, 42), 0.6) 0%,
        rgba(var(--SmartThemeBotMesColorRGB, 42, 42, 42), 0.3) 100%);
    border-radius: var(--nemo-radius-lg);
    padding: var(--nemo-space-md);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: var(--nemo-shadow-sm);
    transition: all 0.3s ease;
}

#api_button:hover {
    border-color: rgba(255, 255, 255, 0.12);
    box-shadow: var(--nemo-shadow-md);
}

/* === CONNECTION PROFILE BLOCK === */
#api_connection_profile_block {
    background: linear-gradient(135deg,
        rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.08) 0%,
        rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.02) 100%);
    border: 1px solid rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.2);
    border-radius: var(--nemo-radius-md);
    padding: var(--nemo-space-md);
    margin-bottom: var(--nemo-space-md);
    position: relative;
    overflow: hidden;
}

#api_connection_profile_block::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg,
        var(--SmartThemeQuoteColor, #4a9eff),
        transparent);
    opacity: 0.7;
}

#api_connection_profile_block h4 {
    font-size: var(--nemo-text-lg);
    font-weight: 600;
    margin-bottom: var(--nemo-space-sm);
    display: flex;
    align-items: center;
    gap: var(--nemo-space-sm);
}

#api_connection_profile_block h4 .fa-plug-circle-check {
    color: var(--SmartThemeQuoteColor, #4a9eff);
    filter: drop-shadow(0 0 4px rgba(74, 158, 255, 0.4));
}

/* Connection Profile Buttons */
#api_connection_profile_block .flex-container {
    gap: var(--nemo-space-sm);
}

#api_connection_profile_block .menu_button {
    flex: 1;
    justify-content: center;
    padding: var(--nemo-space-sm) var(--nemo-space-md);
    border-radius: var(--nemo-radius-sm);
    font-size: var(--nemo-text-sm);
    transition: all 0.2s ease;
}

#api_connection_profile_block .menu_button:hover {
    background: rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.15);
}

/* Rename button icon */
#api_connection_profile_block .menu_button .fa-pencil {
    margin-right: var(--nemo-space-xs);
}

/* === API TYPE BUTTONS === */
#api_buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--nemo-space-xs);
    padding: var(--nemo-space-sm);
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--nemo-radius-md);
    margin-bottom: var(--nemo-space-md);
}

#api_buttons .api_button {
    position: relative;
    padding: var(--nemo-space-sm) var(--nemo-space-md);
    border-radius: var(--nemo-radius-sm);
    font-size: var(--nemo-text-sm);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid transparent;
    background: rgba(255, 255, 255, 0.05);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

#api_buttons .api_button:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px);
}

#api_buttons .api_button.selected,
#api_buttons .api_button[data-selected="true"] {
    background: linear-gradient(135deg,
        rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.3) 0%,
        rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.15) 100%);
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
    color: var(--nemo-text-high-contrast);
    box-shadow: 0 0 10px rgba(74, 158, 255, 0.2);
}

#api_buttons .api_button.selected::after,
#api_buttons .api_button[data-selected="true"]::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 2px;
    background: var(--SmartThemeQuoteColor, #4a9eff);
    border-radius: 2px;
}

/* === API SETTINGS CONTAINERS === */
#kobold_api,
#novel_api,
#textgenerationwebui_api,
#openai_api,
#openrouter_api,
#horde_api,
#ollamaAPI,
#mistralAI_api {
    animation: fadeInUp 0.3s ease-out;
    background: rgba(var(--SmartThemeBotMesColorRGB, 42, 42, 42), 0.3);
    border-radius: var(--nemo-radius-md);
    padding: var(--nemo-space-md);
    margin-top: var(--nemo-space-sm);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* === SECTION HEADERS === */
#api_button h4,
#kobold_api h4,
#novel_api h4,
#textgenerationwebui_api h4,
#openai_api h4,
#openrouter_api h4,
#horde_api h4,
#ollamaAPI h4,
#mistralAI_api h4 {
    font-size: var(--nemo-text-base);
    font-weight: 600;
    color: var(--nemo-text-high-contrast);
    padding-bottom: var(--nemo-space-sm);
    margin-bottom: var(--nemo-space-sm);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: var(--nemo-space-sm);
}

#api_button h4 i,
#kobold_api h4 i,
#novel_api h4 i,
#textgenerationwebui_api h4 i,
#openai_api h4 i,
#openrouter_api h4 i,
#horde_api h4 i,
#ollamaAPI h4 i,
#mistralAI_api h4 i {
    color: var(--SmartThemeQuoteColor, #4a9eff);
    opacity: 0.8;
}

/* === MODEL SELECTION BLOCKS === */
#model_openrouter_select,
#model_openai_select,
#model_novel_select,
#model_kobold_select,
#model_ollama_select,
#model_mistral_select,
#model_horde_select {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-md);
    padding: var(--nemo-space-md);
    margin-bottom: var(--nemo-space-md);
    transition: all 0.2s ease;
}

#model_openrouter_select:hover,
#model_openai_select:hover,
#model_novel_select:hover,
#model_kobold_select:hover,
#model_ollama_select:hover,
#model_mistral_select:hover,
#model_horde_select:hover {
    border-color: rgba(255, 255, 255, 0.2);
    background: rgba(0, 0, 0, 0.25);
}

/* === URL INPUT STYLING === */
#api_url_text,
#api_key_text,
#novel_api_key_openai,
#openai_reverse_proxy,
#horde_api_key {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--nemo-radius-sm);
    padding: var(--nemo-space-sm) var(--nemo-space-md);
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: var(--nemo-text-sm);
    color: var(--nemo-text-high-contrast);
    transition: all 0.2s ease;
    width: 100%;
}

#api_url_text:focus,
#api_key_text:focus,
#novel_api_key_openai:focus,
#openai_reverse_proxy:focus,
#horde_api_key:focus {
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
    box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.15);
    outline: none;
}

#api_url_text::placeholder,
#api_key_text::placeholder,
#novel_api_key_openai::placeholder,
#openai_reverse_proxy::placeholder,
#horde_api_key::placeholder {
    color: var(--nemo-text-low-contrast);
    font-style: italic;
}

/* === CONNECT BUTTON === */
#api_button_connect,
.api_button_connect {
    background: linear-gradient(135deg,
        var(--SmartThemeQuoteColor, #4a9eff) 0%,
        rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.7) 100%);
    color: white;
    font-weight: 600;
    padding: var(--nemo-space-sm) var(--nemo-space-lg);
    border-radius: var(--nemo-radius-md);
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: var(--nemo-text-sm);
    box-shadow: 0 2px 8px rgba(74, 158, 255, 0.3);
}

#api_button_connect:hover,
.api_button_connect:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
    background: linear-gradient(135deg,
        rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 1.2) 0%,
        var(--SmartThemeQuoteColor, #4a9eff) 100%);
}

#api_button_connect:active,
.api_button_connect:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(74, 158, 255, 0.3);
}

/* Connected state */
#api_button_connect.connected,
.api_button_connect.connected {
    background: linear-gradient(135deg,
        var(--nemo-success, #51cf66) 0%,
        rgba(81, 207, 102, 0.7) 100%);
    box-shadow: 0 2px 8px rgba(81, 207, 102, 0.3);
}

/* === SELECT/DROPDOWN ENHANCEMENTS === */
#api_button select,
#api_button .select2-selection {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--nemo-radius-sm);
    padding: var(--nemo-space-sm);
    color: var(--nemo-text-high-contrast);
    transition: all 0.2s ease;
}

#api_button select:hover,
#api_button .select2-selection:hover {
    border-color: rgba(255, 255, 255, 0.25);
    background: rgba(0, 0, 0, 0.35);
}

#api_button select:focus,
#api_button .select2-selection--single.select2-selection--focus {
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
    box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.15);
}

/* Select2 specific styling */
#api_button .select2-container--default .select2-selection--single {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--nemo-radius-sm);
    height: auto;
    padding: var(--nemo-space-xs) var(--nemo-space-sm);
}

#api_button .select2-container--default .select2-selection--single .select2-selection__rendered {
    color: var(--nemo-text-high-contrast);
    padding-left: var(--nemo-space-xs);
}

#api_button .select2-container--default .select2-selection--single .select2-selection__arrow {
    right: var(--nemo-space-sm);
}

/* === CHECKBOX/TOGGLE STYLING === */
#api_button input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--nemo-radius-sm);
    background: rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

#api_button input[type="checkbox"]:hover {
    border-color: rgba(255, 255, 255, 0.5);
}

#api_button input[type="checkbox"]:checked {
    background: var(--SmartThemeQuoteColor, #4a9eff);
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
}

#api_button input[type="checkbox"]:checked::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 12px;
    font-weight: bold;
}

#api_button input[type="checkbox"]:focus {
    box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.2);
    outline: none;
}

/* === LABELS === */
#api_button label {
    color: var(--nemo-text-medium-contrast);
    font-size: var(--nemo-text-sm);
    transition: color 0.2s ease;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--nemo-space-xs);
}

#api_button label:hover {
    color: var(--nemo-text-high-contrast);
}

/* === RANGE/SLIDER INPUTS === */
#api_button input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: rgba(255, 255, 255, 0.1);
    outline: none;
    transition: all 0.2s ease;
}

#api_button input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--SmartThemeQuoteColor, #4a9eff);
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(74, 158, 255, 0.4);
    transition: all 0.2s ease;
}

#api_button input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.15);
    box-shadow: 0 2px 10px rgba(74, 158, 255, 0.6);
}

#api_button input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--SmartThemeQuoteColor, #4a9eff);
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 6px rgba(74, 158, 255, 0.4);
}

/* === NUMBERS/STAT VALUES === */
#api_button .value_text,
#api_button .stat-value,
#api_button input[type="number"] {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-sm);
    padding: var(--nemo-space-xs) var(--nemo-space-sm);
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: var(--nemo-text-sm);
    color: var(--SmartThemeQuoteColor, #4a9eff);
    text-align: center;
    min-width: 60px;
}

/* === INFO/HELP TEXT === */
#api_button small,
#api_button .help-text,
#api_button .subtext {
    color: var(--nemo-text-low-contrast);
    font-size: var(--nemo-text-xs);
    font-style: italic;
    display: block;
    margin-top: var(--nemo-space-xs);
}

/* === FLEX CONTAINER IMPROVEMENTS === */
#api_button .flex-container {
    gap: var(--nemo-space-sm);
}

#api_button .flex-container.flexFlowColumn {
    gap: var(--nemo-space-md);
}

/* === SEPARATOR/DIVIDER STYLING === */
#api_button hr {
    border: none;
    height: 1px;
    background: linear-gradient(90deg,
        transparent,
        rgba(255, 255, 255, 0.1) 20%,
        rgba(255, 255, 255, 0.1) 80%,
        transparent);
    margin: var(--nemo-space-md) 0;
}

/* === OPENROUTER SPECIFIC ENHANCEMENTS === */
#openrouter_api .openrouter_model_sorting_block {
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--nemo-radius-sm);
    padding: var(--nemo-space-sm);
    margin-bottom: var(--nemo-space-sm);
}

#openrouter_api .openrouter-model-sorting-pill {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--nemo-radius-full);
    padding: var(--nemo-space-xs) var(--nemo-space-sm);
    font-size: var(--nemo-text-xs);
    transition: all 0.2s ease;
}

#openrouter_api .openrouter-model-sorting-pill:hover,
#openrouter_api .openrouter-model-sorting-pill.selected {
    background: rgba(var(--SmartThemeQuoteColorRGB, 74, 158, 255), 0.2);
    border-color: var(--SmartThemeQuoteColor, #4a9eff);
}

/* === HORDE SPECIFIC ENHANCEMENTS === */
#horde_api .horde_model_block {
    max-height: 300px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--nemo-radius-md);
    padding: var(--nemo-space-sm);
    scrollbar-width: thin;
    scrollbar-color: var(--SmartThemeQuoteColor, #4a9eff) transparent;
}

#horde_api .horde_model_block::-webkit-scrollbar {
    width: 6px;
}

#horde_api .horde_model_block::-webkit-scrollbar-thumb {
    background: var(--SmartThemeQuoteColor, #4a9eff);
    border-radius: 3px;
}

/* === STATUS INDICATORS === */
.api-status-indicator {
    display: inline-flex;
    align-items: center;
    gap: var(--nemo-space-xs);
    padding: var(--nemo-space-xs) var(--nemo-space-sm);
    border-radius: var(--nemo-radius-full);
    font-size: var(--nemo-text-xs);
    font-weight: 500;
}

.api-status-indicator.connected {
    background: rgba(81, 207, 102, 0.15);
    color: var(--nemo-success);
    border: 1px solid rgba(81, 207, 102, 0.3);
}

.api-status-indicator.disconnected {
    background: rgba(255, 107, 107, 0.15);
    color: var(--nemo-error);
    border: 1px solid rgba(255, 107, 107, 0.3);
}

.api-status-indicator::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* === COLLAPSIBLE SECTIONS === */
#api_button .collapsible-header {
    cursor: pointer;
    padding: var(--nemo-space-sm) var(--nemo-space-md);
    background: rgba(255, 255, 255, 0.03);
    border-radius: var(--nemo-radius-sm);
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

#api_button .collapsible-header:hover {
    background: rgba(255, 255, 255, 0.06);
}

#api_button .collapsible-header .fa-chevron-down,
#api_button .collapsible-header .fa-chevron-right {
    transition: transform 0.2s ease;
    font-size: var(--nemo-text-xs);
    opacity: 0.6;
}

#api_button .collapsible-header.expanded .fa-chevron-down {
    transform: rotate(180deg);
}

/* === TOOLTIP ENHANCEMENTS === */
#api_button [title],
#api_button [data-tooltip] {
    position: relative;
}

/* === LOADING STATES === */
#api_button .loading {
    position: relative;
    pointer-events: none;
}

#api_button .loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid transparent;
    border-top-color: var(--SmartThemeQuoteColor, #4a9eff);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* === RESPONSIVE ADJUSTMENTS === */
@media (max-width: 768px) {
    #api_buttons {
        flex-direction: column;
    }

    #api_buttons .api_button {
        width: 100%;
        text-align: center;
    }

    #api_button .flex-container {
        flex-direction: column;
    }

    #api_connection_profile_block .flex-container {
        flex-wrap: wrap;
    }
}

/* === KEYBOARD NAVIGATION HIGHLIGHT === */
#api_button *:focus-visible {
    outline: 2px solid var(--SmartThemeQuoteColor, #4a9eff);
    outline-offset: 2px;
}

/* === SUBTLE ANIMATIONS FOR ENHANCED UX === */
#api_button .menu_button,
#api_button select,
#api_button input {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Smooth expand/collapse for settings blocks */
#kobold_api,
#novel_api,
#textgenerationwebui_api,
#openai_api,
#openrouter_api,
#horde_api,
#ollamaAPI,
#mistralAI_api {
    transition: opacity 0.3s ease, transform 0.3s ease;
}

/* Hidden state for API sections */
#kobold_api[style*="display: none"],
#novel_api[style*="display: none"],
#textgenerationwebui_api[style*="display: none"],
#openai_api[style*="display: none"],
#openrouter_api[style*="display: none"],
#horde_api[style*="display: none"],
#ollamaAPI[style*="display: none"],
#mistralAI_api[style*="display: none"] {
    opacity: 0;
    transform: translateY(-10px);
}

/* Ensure container maintains height to prevent collapse */
#completion_prompt_manager_list.nemo-hidden-during-update {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.1s ease;
    /* Do NOT set min-height blindly as it might force layout shifts if content is smaller */
}
